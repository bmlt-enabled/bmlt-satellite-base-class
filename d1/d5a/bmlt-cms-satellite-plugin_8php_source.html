<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BMLT Satellite Base Class: /home/runner/work/bmlt-satellite-base-class/bmlt-satellite-base-class/bmlt-cms-satellite-plugin.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BMLT Satellite Base Class
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/runner/work/bmlt-satellite-base-class/bmlt-satellite-base-class/bmlt-cms-satellite-plugin.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/****************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">*   \file   bmlt-cms-satellite-plugin.php                                                   *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">*   \brief  This is a generic CMS plugin class for a BMLT satellite client.                 *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">*   \version 3.10.0                                                                          *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">*   This file is part of the BMLT Common Satellite Base Class Project. The project GitHub   *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">*   page is available here: https://github.com/MAGSHARE/BMLT-Common-CMS-Plugin-Class        *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*   This file is part of the Basic Meeting List Toolbox (BMLT).                             *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">*   Find out more at: https://bmlt.app                                                      *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">*   BMLT is free software: you can redistribute it and/or modify                            *</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">*   it under the terms of the GNU General Public License as published by                    *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">*   the Free Software Foundation, either version 3 of the License, or                       *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">*   (at your option) any later version.                                                     *</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">*   BMLT is distributed in the hope that it will be useful,                                 *</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*   but WITHOUT ANY WARRANTY; without even the implied warranty of                          *</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                           *</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">*   GNU General Public License for more details.                                            *</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">*   You should have received a copy of the GNU General Public License                       *</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">*   along with this code.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                      *</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">********************************************************************************************/</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// define ( &#39;_DEBUG_MODE_&#39;, 1 ); //Uncomment for easier JavaScript debugging.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// Include the satellite driver class.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;ROOTPATH&#39;</span>)) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    require_once(__DIR__.<span class="stringliteral">&#39;/../bmlt-satellite-driver/bmlt_satellite_controller.class.php&#39;</span>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;} <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    require_once(ROOTPATH .<span class="stringliteral">&#39;/vendor/bmlt/bmlt-satellite-driver/bmlt_satellite_controller.class.php&#39;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;global $g_lang_keys;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;global $g_my_languages;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;$g_my_languages = array();</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;$g_lang_keys = array();</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;$dirname = dirname(__FILE__) . <span class="stringliteral">&quot;/lang&quot;</span>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;$dir = <span class="keyword">new</span> DirectoryIterator($dirname);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordflow">foreach</span> ($dir as $fileinfo) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">if</span> (!$fileinfo-&gt;isDot()) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        $fName = $fileinfo-&gt;getFilename();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">if</span> (($fName != <span class="stringliteral">&quot;index.php&quot;</span>) &amp;&amp; preg_match(<span class="stringliteral">&quot;|^lang_|&quot;</span>, $fName)) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            $fPath = $dirname . <span class="stringliteral">&quot;/&quot;</span> . $fName;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <span class="keywordflow">if</span> ($file = fopen($fPath, <span class="stringliteral">&quot;r&quot;</span>)) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                $line0 = fgets($file);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                $line1 = fgets($file);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                $lang_name = trim(substr($line1, 3));</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                $lang_key = trim(substr($fName, 5, -4));</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                <span class="keywordflow">if</span> ($lang_name &amp;&amp; $lang_key) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                    include_once($fPath);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                    $eval_string = <span class="stringliteral">&#39;$lang_instance = new BMLT_Localized_BaseClass_&#39;</span> . $lang_key . <span class="stringliteral">&#39;();&#39;</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                    eval($eval_string);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                    $g_my_languages[$lang_key] = $lang_instance;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">// This is the cookie (and parameter) name used to explicitly set the language used by the client.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">   70</a></span>&#160;<span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;_LANG_COOKIE_NAME&#39;</span>)) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    define(<span class="stringliteral">&#39;_LANG_COOKIE_NAME&#39;</span>, <span class="stringliteral">&#39;bmlt_admin_lang_pref&#39;</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;global <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;  <span class="comment">///&lt; Use this to control the localization.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">   75</a></span>&#160;<span class="comment"></span><a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = <span class="keyword">false</span>;         <span class="comment">///&lt; This will hold the selected language as we test for an explicit one.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">// We can use a cookie to store the language pref. The name is historical, and comes from an existing cookie for the Root Server.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keywordflow">if</span> (isset($_COOKIE) &amp;&amp; isset($_COOKIE[_LANG_COOKIE_NAME]) &amp;&amp; $_COOKIE[_LANG_COOKIE_NAME]) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = $_COOKIE[_LANG_COOKIE_NAME];</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">// GET overpowers cookie.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keywordflow">if</span> (isset($_GET[<span class="stringliteral">&#39;lang_enum&#39;</span>]) &amp;&amp; $_GET[<span class="stringliteral">&#39;lang_enum&#39;</span>]) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = $_GET[<span class="stringliteral">&#39;lang_enum&#39;</span>];</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">// POST overpowers GET.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;lang_enum&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;lang_enum&#39;</span>]) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = $_POST[<span class="stringliteral">&#39;lang_enum&#39;</span>];</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">// This allows us a &quot;superparameter&quot; to override the standard &#39;lang_enum&#39;.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">// GET overpowers cookie.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keywordflow">if</span> (isset($_GET[_LANG_COOKIE_NAME]) &amp;&amp; $_GET[_LANG_COOKIE_NAME]) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = $_GET[_LANG_COOKIE_NAME];</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">// POST overpowers GET.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keywordflow">if</span> (isset($_POST[_LANG_COOKIE_NAME]) &amp;&amp; $_POST[_LANG_COOKIE_NAME]) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = $_POST[_LANG_COOKIE_NAME];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">// If the language is not valid, we fall back on the existing global.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keywordflow">if</span> ((!<a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> || !file_exists(dirname(__FILE__).<span class="stringliteral">&quot;/lang/lang_&quot;</span>.<a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a>.<span class="stringliteral">&quot;.php&quot;</span>)) &amp;&amp; isset(<a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>) &amp;&amp; <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>) {   <span class="comment">// Fall back on a previously set global.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">// If the language is not valid, we fall back on the existing global.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keywordflow">if</span> (!<a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a>) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a> = <span class="stringliteral">&#39;en&#39;</span>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a> = <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/****************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">*   \class BMLTPlugin                                                                       *</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">*   \brief This is the class that implements and encapsulates the plugin functionality.     *</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">*   A single instance of this is created, and manages the plugin.                           *</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">*   This plugin registers errors by echoing HTML comments, so look at the source code of    *</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">*   the page if things aren&#39;t working right.                                                *</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">********************************************************************************************/</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">// phpcs:disable PSR1.Classes.ClassDeclaration.MissingNamespace</span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html">  125</a></span>&#160;<span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html">BMLTPlugin</a></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">// phpcs:enable PSR1.Classes.ClassDeclaration.MissingNamespace</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">    *                           STATIC DATA MEMBERS (SINGLETON)                             *</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">    /// This is a SINGLETON pattern. There can only be one...</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a8de1f3b7c89fbff82df72d9d056b3089">  133</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a8de1f3b7c89fbff82df72d9d056b3089">$g_s_there_can_only_be_one</a> = <span class="keyword">null</span>;                              <span class="comment">///&lt; This is a static variable that holds the single instance.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"></span>    </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">    *                           STATIC DATA MEMBERS (DEFAULTS)                              *</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">    *   In Version 2, these are all ignored:                                                *</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">    *       $default_bmlt_fullscreen                                                        *</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">    *       $default_support_old_browsers                                                   *</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">    *       $default_sb_array                                                               *</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a10900bb92ef1b14d0c40e43a5b075f56">  143</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a10900bb92ef1b14d0c40e43a5b075f56">$adminOptionsName</a> = <span class="stringliteral">&quot;BMLTAdminOptions&quot;</span>;                         <span class="comment">///&lt; The name, in the database, for the version 1 options for this plugin.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac232691e99baa691396dc46376d092ac">  144</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac232691e99baa691396dc46376d092ac">$admin2OptionsName</a> = <span class="stringliteral">&quot;BMLT2AdminOptions&quot;</span>;                       <span class="comment">///&lt; These options are for version 2.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span>    </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// These are the old settings that we still care about.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a92b7166c28594f83df9d8087445d7c18">  147</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a92b7166c28594f83df9d8087445d7c18">$default_rootserver</a> = <span class="stringliteral">&#39;&#39;</span>;                                       <span class="comment">///&lt; This is the default root BMLT server URI.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#af66d0e99ae2f2dc3a23859f7d3d86e98">  148</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#af66d0e99ae2f2dc3a23859f7d3d86e98">$default_map_center_latitude</a> = 29.764377375163125;              <span class="comment">///&lt; This is the default basic search map center latitude</span></div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a367bf4c7007298f8ac943c4ad2c1a380">  149</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a367bf4c7007298f8ac943c4ad2c1a380">$default_map_center_longitude</a> = -95.4931640625;                 <span class="comment">///&lt; This is the default basic search map center longitude</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a5023e053ca1ef2b5016e50f07c0fed86">  150</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a5023e053ca1ef2b5016e50f07c0fed86">$default_map_zoom</a> = 8;                                          <span class="comment">///&lt; This is the default basic search map zoom level</span></div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0594123d2924125ecf24e8b49ce91852">  151</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0594123d2924125ecf24e8b49ce91852">$default_details_map_zoom</a> = 11;                                 <span class="comment">///&lt; This is the default basic search map zoom level</span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a704c863c37fb16b03dcf5ef671e3ff59">  152</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a704c863c37fb16b03dcf5ef671e3ff59">$default_location_checked</a> = 0;                                  <span class="comment">///&lt; If nonzero, then the &quot;This is a location&quot; checkbox will be preselected.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#af84d279510d45450853cf8274b5a9093">  153</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#af84d279510d45450853cf8274b5a9093">$default_location_services</a> = 0;                                 <span class="comment">///&lt; This tells the new default implementation whether or not location services should be available only for mobile devices.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a495f5e900da9c24471eaac9ae9e073d0">  154</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a495f5e900da9c24471eaac9ae9e073d0">$default_gkey</a> = <span class="stringliteral">&#39;&#39;</span>;                                             <span class="comment">///&lt; This is only necessary for older versions.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6b8e0e4b83ca64047b912500fcd76727">  155</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6b8e0e4b83ca64047b912500fcd76727">$default_additional_css</a> = <span class="stringliteral">&#39;&#39;</span>;                                   <span class="comment">///&lt; This is additional CSS that is inserted inline into the &lt;head&gt; section.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a51dfcf21fde4ae106badcf9e07dbc4d5">  156</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a51dfcf21fde4ae106badcf9e07dbc4d5">$default_initial_view</a> = <span class="stringliteral">&#39;&#39;</span>;                                     <span class="comment">///&lt; The initial view for old-style BMLT. It can be &#39;map&#39;, &#39;text&#39;, &#39;advanced&#39;, &#39;advanced map&#39;, &#39;advanced text&#39; or &#39;&#39;.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0ff61c69a2a937d902b7f2d86c92371c">  157</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0ff61c69a2a937d902b7f2d86c92371c">$default_theme</a> = <span class="stringliteral">&#39;default&#39;</span>;                                     <span class="comment">///&lt; This is the default for the &quot;style theme&quot; for the plugin. Different settings can have different themes.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#abbe28db42855eeace180661bf40b4918">  158</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abbe28db42855eeace180661bf40b4918">$default_language</a> = <span class="stringliteral">&#39;en&#39;</span>;                                       <span class="comment">///&lt; The default language is English, but the root server can override.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae57b5388611ba8720d0e096ec9acd5c3">  159</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae57b5388611ba8720d0e096ec9acd5c3">$default_language_string</a> = <span class="stringliteral">&#39;English&#39;</span>;                           <span class="comment">///&lt; The default language is English, and the name is spelled out, here.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#acd15a5856ff8bc70cdd02b2aa2765f4e">  160</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#acd15a5856ff8bc70cdd02b2aa2765f4e">$default_distance_units</a> = <span class="stringliteral">&#39;mi&#39;</span>;                                 <span class="comment">///&lt; The default distance units are miles.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#af5b28d05c383c066153fadc62067bc74">  161</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#af5b28d05c383c066153fadc62067bc74">$default_grace_period</a> = 15;                                     <span class="comment">///&lt; The default grace period for the mobile search (in minutes).</span></div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a44ffa57befc9aca51db2f32efecc4068">  162</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a44ffa57befc9aca51db2f32efecc4068">$default_time_offset</a> = 0;                                       <span class="comment">///&lt; The default time offset from the main server (in hours).</span></div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad6f1e854890aefe25d9f444888038526">  163</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad6f1e854890aefe25d9f444888038526">$default_military_time</a> = <span class="keyword">false</span>;                                 <span class="comment">///&lt; If this is true, then time displays will be in military time.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a59226d4a32381033c24a4ac15da9f03e">  164</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a59226d4a32381033c24a4ac15da9f03e">$default_startWeekday</a> = 1;                                      <span class="comment">///&lt; The default starting weekday (Sunday)</span></div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a82bcc59f466ed90f8c5de413018d114c">  165</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a82bcc59f466ed90f8c5de413018d114c">$default_duration</a> = <span class="stringliteral">&#39;1:30&#39;</span>;                                     <span class="comment">///&lt; The default duration of meetings.</span></div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab13712314eec9bd961712f438a82f9d7">  166</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab13712314eec9bd961712f438a82f9d7">$default_geo_width</a> = <span class="stringliteral">&#39;-10&#39;</span>;                                     <span class="comment">///&lt; The default geo width for searches.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"></span>    </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">    *                               STATIC DATA MEMBERS (MISC)                              *</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    </div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad7b3cc1fba4480fcd2b6b9aa046d72d4">  172</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad7b3cc1fba4480fcd2b6b9aa046d72d4">$local_options_success_time</a> = 2000;                             <span class="comment">///&lt; The number of milliseconds a success message is displayed.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae44e562448d334639fc7fa21c8da20f5">  173</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae44e562448d334639fc7fa21c8da20f5">$local_options_failure_time</a> = 5000;                             <span class="comment">///&lt; The number of milliseconds a failure message is displayed.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">    *                                  DYNAMIC DATA MEMBERS                                 *</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae72e9ecced51ac64784d19f38e41e165">  179</a></span>&#160;    <span class="keyword">public</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae72e9ecced51ac64784d19f38e41e165">$my_driver</a> = <span class="keyword">null</span>;              <span class="comment">///&lt; This will contain an instance of the BMLT satellite driver class.</span></div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">  180</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">$my_params</a> = <span class="keyword">null</span>;              <span class="comment">///&lt; This will contain the $this-&gt;my_http_vars and $_POST query variables.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab1fc65da1604c87720d0733db51d3a7d">  181</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab1fc65da1604c87720d0733db51d3a7d">$my_http_vars</a> = <span class="keyword">null</span>;           <span class="comment">///&lt; This will hold all of the query arguments.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab03a43680a74b12199b2e02ed4a4b373">  182</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab03a43680a74b12199b2e02ed4a4b373">$my_table_next_id</a> = 0;          <span class="comment">///&lt; The next ID to use for the table.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a66422106cb955d5699c87454c7ed63dc">  183</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a66422106cb955d5699c87454c7ed63dc">$my_current_language</a>;           <span class="comment">///&lt; This contains whatever the current localization object is.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"></span>    </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">    *                                    FUNCTIONS/METHODS                                  *</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">    *   \brief Get the instance                                                             *</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">    *   \return An instance  of BMLTPlugin                                                  *</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0376a866aebbdd84d5e0901cf883ae1b">  195</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0376a866aebbdd84d5e0901cf883ae1b">get_plugin_object</a>()</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a8de1f3b7c89fbff82df72d9d056b3089">self::$g_s_there_can_only_be_one</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">    *                           ACCESSORS AND INTERNAL FUNCTIONS                            *</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">    *   \brief Adapts all the static data members to the selected language.                 *</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a9ad4ced6afcdd55144dc7e527d82293f">  209</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a9ad4ced6afcdd55144dc7e527d82293f">adapt_to_lang</a>($in_lang = <span class="stringliteral">&quot;en&quot;</span>) <span class="comment">///&lt; The language code. Default is English.</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        global $g_my_languages;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        $this-&gt;my_current_language = $g_my_languages[$in_lang];</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">    *   \brief Accessor: This gets the driver object.                                       *</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">    *   \returns a reference to the bmlt_satellite_controller driver object                 *</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ade39eb0c967443f9f02c911b5ce41435">  223</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> &amp;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ade39eb0c967443f9f02c911b5ce41435">get_my_driver</a>()</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae72e9ecced51ac64784d19f38e41e165">$this-&gt;my_driver</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">    *   \brief Loads the parameter list.                                                    *</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2398955b048505900af213faad244bbb">  233</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2398955b048505900af213faad244bbb">load_params</a>()</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        $this-&gt;my_params = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9d66d0122d728fc8e728a2dba0a1cbb">self::get_params</a>($this-&gt;my_http_vars);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">    *   \brief Loads a parameter list.                                                      *</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">    *   \returns a string, containing the joined parameters.                                *</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9d66d0122d728fc8e728a2dba0a1cbb">  245</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9d66d0122d728fc8e728a2dba0a1cbb">get_params</a>($in_array)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">$my_params</a> = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">foreach</span> ($in_array as $key =&gt; $value) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">if</span> (($key != <span class="stringliteral">&#39;lang_enum&#39;</span>) &amp;&amp; isset($in_array[<span class="stringliteral">&#39;direct_simple&#39;</span>]) || (!isset($in_array[<span class="stringliteral">&#39;direct_simple&#39;</span>]) &amp;&amp; $key != <span class="stringliteral">&#39;switcher&#39;</span>) &amp;&amp; ($key != <span class="stringliteral">&#39;redirect_ajax_json&#39;</span>)) {    <span class="comment">// We don&#39;t propagate switcher or the language.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keywordflow">if</span> (isset($value) &amp;&amp; is_array($value) &amp;&amp; count($value)) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    <span class="keywordflow">foreach</span> ($value as $val) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        <span class="keywordflow">if</span> (isset($val) &amp;&amp;  is_array($val) &amp;&amp; count($val)) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                            <span class="comment">// This stupid, stupid, kludgy dance, is because Drupal 7</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                            <span class="comment">// Doesn&#39;t seem to acknowledge the existence of the join() or</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                            <span class="comment">// implode() functions, and puts out a notice.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                            $val_ar = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                            </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                            <span class="keywordflow">foreach</span> ($val as $v) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                <span class="keywordflow">if</span> (!is_array($v)) { <span class="comment">// This makes sure that we ignore any nested arrays, which can happen for some CMS implementations.</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                    <span class="keywordflow">if</span> ($val_ar) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                        $val_ar .= <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                    }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                    $val_ar .= $v;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                            }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                            $val = strval($val_ar);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        } elseif (!isset($val)) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                            $val = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">$my_params</a> .= <span class="charliteral">&#39;&amp;&#39;</span>.urlencode($key) .<span class="stringliteral">&quot;[]=&quot;</span>. urlencode($val);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    $key = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="keywordflow">if</span> ($key) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">$my_params</a> .= <span class="charliteral">&#39;&amp;&#39;</span>.urlencode($key);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    <span class="keywordflow">if</span> ($value) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                        <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">$my_params</a> .= <span class="stringliteral">&quot;=&quot;</span>. urlencode($value);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">$my_params</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">    *   This will strip the cruft out of CSS and JS files.                                  *</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">    *   \returns a string, with the stripped CSS.                                           *</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a698d69a99db18b03a83240d11ce52826">  297</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a698d69a99db18b03a83240d11ce52826">stripFile</a>(</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        $in_filename,               <span class="comment">///&lt; The filename to open and optimize. If in a subdirectory (other than themes), then that should be part of the string.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"></span>        $in_theme_dirname = <span class="keyword">null</span>    <span class="comment">///&lt; The dirname of the theme to use. Default is NULL (Looks in the same directory as this file).</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        $pathname = dirname(__FILE__) . ($in_theme_dirname ? <span class="stringliteral">&#39;/themes/&#39;</span> . $in_theme_dirname : <span class="stringliteral">&#39;&#39;</span>) . <span class="charliteral">&#39;/&#39;</span> . $in_filename;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">if</span> (file_exists($pathname)) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            $opt = file_get_contents($pathname);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            $opt = preg_replace(<span class="stringliteral">&quot;|\/\*.*?\*\/|s&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, $opt);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            $opt = preg_replace(<span class="stringliteral">&quot;|[^:]\/\/.*?\n|s&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, $opt);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>)) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                $opt = preg_replace(<span class="stringliteral">&quot;|\s+|s&quot;</span>, <span class="stringliteral">&quot; &quot;</span>, $opt);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">return</span> $opt;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">    /****************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">    *   \brief Checks the UA of the caller, to see if it should return XHTML Strict or WML.     *</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">    *                                                                                           *</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">    *   NOTE: This is very, very basic. It is not meant to be a studly check, like WURFL.       *</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">    *                                                                                           *</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">    *   \returns A string. The supported type (&#39;xhtml&#39;, &#39;xhtml_mp&#39; or &#39;wml&#39;)                    *</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">    ********************************************************************************************/</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9692cb961016e56fb3f601358690402">  324</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9692cb961016e56fb3f601358690402">mobile_sniff_ua</a>($in_http_vars)  <span class="comment">///&lt; The query variables.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">if</span> (isset($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) &amp;&amp; (intval($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) == 1)) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            $language = <span class="stringliteral">&#39;wml&#39;</span>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        } elseif (isset($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) &amp;&amp; (intval($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) == 2)) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            $language = <span class="stringliteral">&#39;xhtml_mp&#39;</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">if</span> (!isset($_SERVER[<span class="stringliteral">&#39;HTTP_ACCEPT&#39;</span>])) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            $http_accept = explode(<span class="charliteral">&#39;,&#39;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_ACCEPT&#39;</span>]);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            $accept = array();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordflow">foreach</span> ($http_accept as $type) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                $type = strtolower(trim(preg_replace(<span class="stringliteral">&#39;/\;.*$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, preg_replace(<span class="stringliteral">&#39;/\s+/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $type))));</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                $accept[$type] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            $language = <span class="stringliteral">&#39;xhtml&#39;</span>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">if</span> (isset($accept[<span class="stringliteral">&#39;text/vnd.wap.wml&#39;</span>])) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                $language = <span class="stringliteral">&#39;wml&#39;</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">if</span> (isset($accept[<span class="stringliteral">&#39;application/xhtml+xml&#39;</span>]) || isset($accept[<span class="stringliteral">&#39;application/vnd.wap.xhtml+xml&#39;</span>])) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    $language = <span class="stringliteral">&#39;xhtml_mp&#39;</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/ipod/i&#39;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>])</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                    ||  preg_match(<span class="stringliteral">&#39;/ipad/i&#39;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>])</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                    ||  preg_match(<span class="stringliteral">&#39;/iphone/i&#39;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>])</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                    ||  preg_match(<span class="stringliteral">&#39;/android/i&#39;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>])</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    ||  preg_match(<span class="stringliteral">&#39;/blackberry/i&#39;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>])</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    ||  preg_match(<span class="stringliteral">&quot;/opera\s+mini/i&quot;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>])</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                    ||  isset($in_http_vars[<span class="stringliteral">&#39;simulate_smartphone&#39;</span>])</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    ) {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    $language = <span class="stringliteral">&#39;smartphone&#39;</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">return</span> $language;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">    *   \brief This will parse the given text, to see if it contains the submitted code.    *</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">    *   The code can be contained in EITHER an HTML comment (&lt;!--CODE--&gt;), OR a double-[[]] *</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">    *   notation.                                                                           *</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">    *   \returns Boolean true if the code is found (1 or more instances), OR an associative *</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">    *   array of data that is associated with the code (anything within parentheses). Null  *</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">    *   is returned if there is no shortcode detected.                                      *</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a575662eeb5c19e4aa99ae34d5e831f44">  381</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a575662eeb5c19e4aa99ae34d5e831f44">get_shortcode</a>(</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        $in_text_to_parse,  <span class="comment">///&lt; The text to search for shortcodes</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"></span>        $in_code            <span class="comment">///&lt; The code that w&#39;re looking for.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        $ret = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        $code_regex_html = <span class="stringliteral">&quot;&lt;\!\-\-\s?&quot;</span>.preg_quote(strtolower(trim($in_code))).<span class="stringliteral">&quot;\s?(\(.*?\))?\s?\-\-&gt;&quot;</span>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        $code_regex_brackets = <span class="stringliteral">&quot;\[\[\s?&quot;</span>.preg_quote(strtolower(trim($in_code))).<span class="stringliteral">&quot;\s?(\(.*?\))?\s?\]\]&quot;</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        $matches = array();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">if</span> (preg_match(<span class="charliteral">&#39;|&#39;</span>.$code_regex_html.<span class="stringliteral">&#39;|i&#39;</span>, $in_text_to_parse, $matches) || preg_match(<span class="charliteral">&#39;|&#39;</span>.$code_regex_brackets.<span class="stringliteral">&#39;|i&#39;</span>, $in_text_to_parse, $matches)) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">if</span> (!isset($matches[1]) || !($ret = trim($matches[1], <span class="stringliteral">&#39;()&#39;</span>))) { <span class="comment">// See if we have any parameters.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                $ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">    *   \brief This will parse the given text, to see if it contains the submitted code.    *</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">    *   The code can be contained in EITHER an HTML comment (&lt;!--CODE--&gt;), OR a double-[[]] *</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">    *   notation.                                                                           *</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">    *   \returns A string, consisting of the new text.                                      *</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#af960dde870b3ff53e61d8e73c24deece">  411</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#af960dde870b3ff53e61d8e73c24deece">replace_shortcode</a>(</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        $in_text_to_parse,      <span class="comment">///&lt; The text to search for shortcodes</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"></span>        $in_code,               <span class="comment">///&lt; The code that w&#39;re looking for.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment"></span>        $in_replacement_text    <span class="comment">///&lt; The text we&#39;ll be replacing the shortcode with.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        $code_regex_html = <span class="stringliteral">&quot;#(&lt;p[^&gt;]*?&gt;)?&lt;\!\-\-\s?&quot;</span>.preg_quote(strtolower(trim($in_code))).<span class="stringliteral">&quot;\s?(\(.*?\))?\s?\-\-&gt;(&lt;\/p&gt;)?#i&quot;</span>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        $code_regex_brackets = <span class="stringliteral">&quot;#(&lt;p[^&gt;]*?&gt;)?\[\[\s?&quot;</span>.preg_quote(strtolower(trim($in_code))).<span class="stringliteral">&quot;\s?(\(.*?\))?\s?\]\](&lt;\/p&gt;)?#i&quot;</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        $ret = preg_replace($code_regex_html, $in_replacement_text, $in_text_to_parse, 1);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        $ret = preg_replace($code_regex_brackets, $in_replacement_text, $ret, 1);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">    *                               OPTIONS MANAGEMENT                                      *</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">    *****************************************************************************************</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">    *   This takes some &#39;splainin&#39;.                                                         *</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">    *   The admin2 options track how many servers we&#39;re tracking, and allow the admin to    *</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">    *   increment by 1. The first options don&#39;t have a number. &quot;Numbered&quot; options begin at  *</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">    *   2. You are allowed to save new options at 1 past the current number of options. You *</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">    *   delete options by decrementing the number in the admin2 options (the index). If you *</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">    *   re-increment the options, you will see the old values. It is possible to reset to   *</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">    *   default, and you do that by specifying an option number less than 0 (-1).           *</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">    *   The reason for this funky, complex game, is so we can have multiple options, and we *</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">    *   don&#39;t ignore old options from previous versions.                                    *</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">    *   I considered setting up an abstracted, object-based system for managing these, but  *</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">    *   it&#39;s complex enough without the added overhead, and, besides, that would give a lot *</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">    *   more room for bugs. It&#39;s kinda hairy already, and the complexity is not great       *</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">    *   enough to justify designing a whole object subsystem for it.                        *</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">    *   \brief This gets the default admin options from the object (not the DB).            *</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">    *   \returns an associative array, with the default option settings.                    *</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae4161b2d54a4ce0ba836994425328266">  452</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae4161b2d54a4ce0ba836994425328266">geDefaultBMLTOptions</a>()</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        global <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="comment">// These are the defaults. If the saved option has a different value, it replaces the ones in here.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        $ret = array (  <span class="stringliteral">&#39;root_server&#39;</span> =&gt; self::$default_rootserver,</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                        <span class="stringliteral">&#39;map_center_latitude&#39;</span> =&gt; self::$default_map_center_latitude,</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                        <span class="stringliteral">&#39;map_center_longitude&#39;</span> =&gt; self::$default_map_center_longitude,</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                        <span class="stringliteral">&#39;map_zoom&#39;</span> =&gt; self::$default_map_zoom,</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                        <span class="stringliteral">&#39;bmlt_initial_view&#39;</span> =&gt; self::$default_initial_view,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                        <span class="stringliteral">&#39;additional_css&#39;</span> =&gt; self::$default_additional_css,</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                        <span class="stringliteral">&#39;id&#39;</span> =&gt; strval(time() + intval(rand(0, 999))),   <span class="comment">// This gives the option a unique slug</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                        <span class="stringliteral">&#39;setting_name&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                        <span class="stringliteral">&#39;bmlt_location_checked&#39;</span>=&gt; self::$default_location_checked,</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                        <span class="stringliteral">&#39;bmlt_location_services&#39;</span> =&gt; self::$default_location_services,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                        <span class="stringliteral">&#39;theme&#39;</span> =&gt; self::$default_theme,</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                        <span class="stringliteral">&#39;distance_units&#39;</span> =&gt; self::$default_distance_units,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                        <span class="stringliteral">&#39;grace_period&#39;</span> =&gt; self::$default_grace_period,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                        <span class="stringliteral">&#39;time_offset&#39;</span> =&gt; self::$default_time_offset,</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                        <span class="stringliteral">&#39;military_time&#39;</span> =&gt; self::$default_military_time,</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        <span class="stringliteral">&#39;startWeekday&#39;</span> =&gt; self::$default_startWeekday,</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                        <span class="stringliteral">&#39;google_api_key&#39;</span> =&gt; <span class="stringliteral">&#39;INVALID&#39;</span>,</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        <span class="stringliteral">&#39;region_bias&#39;</span> =&gt; <span class="stringliteral">&#39;us&#39;</span>,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                        <span class="stringliteral">&#39;lang&#39;</span> =&gt; <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        <span class="stringliteral">&#39;default_geo_width&#39;</span> =&gt; self::$default_geo_width</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        );</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">    *   \brief This gets the admin options from the database.                               *</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">    *   \returns an associative array, with the option settings.                            *</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">    ****************************************************************************************/</span><span class="comment"></span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">    /**&lt;    It is possible to store multiple options.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">    If there is a number here (&gt;=1), that will be used.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">    If &lt;0, a new option will be returned (not saved).</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">  490</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>($in_option_number = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        $BMLTOptions = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae4161b2d54a4ce0ba836994425328266">geDefaultBMLTOptions</a>(); <span class="comment">// Start off with the defaults.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="comment">// Make sure we aren&#39;t resetting to default.</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">if</span> (($in_option_number == <span class="keyword">null</span>) || (intval($in_option_number) &gt; 0)) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            $option_number = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="comment">// If they want a certain option number, then it needs to be greater than 1, and within the number we have assigned.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">if</span> ((intval($in_option_number) &gt; 1) &amp;&amp; (intval($in_option_number) &lt;= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>() )) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                $option_number = <span class="charliteral">&#39;_&#39;</span>.intval($in_option_number);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="comment">// These are the standard options.</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            $old_BMLTOptions = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a812e94daeb7fb59635668fd8e1219ff2">cms_get_option</a>(self::$adminOptionsName.$option_number);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="keywordflow">if</span> (is_array($old_BMLTOptions) &amp;&amp; count($old_BMLTOptions)) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="keywordflow">foreach</span> ($old_BMLTOptions as $key =&gt; $value) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    <span class="keywordflow">if</span> (isset($BMLTOptions[$key])) { <span class="comment">// We deliberately ignore old settings that no longer apply.</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                        $BMLTOptions[$key] = $value;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="comment">// Strip off the trailing slash.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            $BMLTOptions[<span class="stringliteral">&#39;root_server&#39;</span>] = preg_replace(<span class="stringliteral">&quot;#\/$#&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, trim($BMLTOptions[<span class="stringliteral">&#39;root_server&#39;</span>]), 1);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">if</span> (isset($BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>]) || !$BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>]) {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            global <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            $BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>] = <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">if</span> (!$BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>]) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            $BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>] = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abbe28db42855eeace180661bf40b4918">self::$default_language</a>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">return</span> $BMLTOptions;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">    *   \brief This gets the admin options from the database, but by using the option id.   *</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">    *   \returns an associative array, with the option settings.                            *</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00536"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4e59c6b75babaf5435e0629cdcf615a4">  536</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4e59c6b75babaf5435e0629cdcf615a4">getBMLTOptions_by_id</a>(</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        $in_option_id,              <span class="comment">///&lt; The option ID. It cannot be optional.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"></span>        &amp;$out_option_number = <span class="keyword">null</span>  <span class="comment">///&lt; This can be optional. A reference to an integer that will be given the option number.</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        $BMLTOptions = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">if</span> (isset($out_option_number)) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            $out_option_number = 0;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keywordflow">if</span> (!$in_option_id) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            $BMLTOptions = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>(1);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">if</span> (isset($out_option_number)) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                $out_option_number = 1;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            $count = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>();</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="comment">// We sort through the available options, looking for the ID.</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">for</span> ($i = 1; $i &lt;= $count; $i++) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                $option_number = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <span class="keywordflow">if</span> ($i &gt; 1) {   <span class="comment">// We do this, for compatibility with older options.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                    $option_number = <span class="stringliteral">&quot;_$i&quot;</span>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                $name = self::$adminOptionsName.$option_number;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                $temp_BMLTOptions = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a812e94daeb7fb59635668fd8e1219ff2">cms_get_option</a>($name);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">if</span> (is_array($temp_BMLTOptions) &amp;&amp; count($temp_BMLTOptions)) {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                    <span class="keywordflow">if</span> ($temp_BMLTOptions[<span class="stringliteral">&#39;id&#39;</span>] == $in_option_id) {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                        $BMLTOptions = $temp_BMLTOptions;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                        <span class="comment">// If they want to know the ID, we supply it here.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                        <span class="keywordflow">if</span> (isset($out_option_number)) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                            $out_option_number = $i;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                        }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (getBMLTOptions_by_id)! No options found for $name! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span> (!isset($BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>]) || !$BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>]) {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            global <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            $BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>] = <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordflow">if</span> (!isset($BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>]) || !$BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>]) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            $BMLTOptions[<span class="stringliteral">&#39;lang&#39;</span>] = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abbe28db42855eeace180661bf40b4918">self::$default_language</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">if</span> (!isset($BMLTOptions[<span class="stringliteral">&#39;default_geo_width&#39;</span>]) || !$BMLTOptions[<span class="stringliteral">&#39;default_geo_width&#39;</span>]) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            $BMLTOptions[<span class="stringliteral">&#39;default_geo_width&#39;</span>] = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab13712314eec9bd961712f438a82f9d7">self::$default_geo_width</a>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">return</span> $BMLTOptions;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">    *   \brief This updates the database with the given options.                            *</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">    *   \returns a boolean. true if success.                                                *</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a34254745fa910e8b8fbff0a2059e8108">  604</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a34254745fa910e8b8fbff0a2059e8108">setBMLTOptions</a>(</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        $in_options,            <span class="comment">///&lt; An array. The options to be stored. If no number is supplied in the next parameter, the ID is used.</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment"></span>        $in_option_number = 1   <span class="comment">///&lt; It is possible to store multiple options. If there is a number here, that will be used.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        $ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span> (($in_option_number == <span class="keyword">null</span>) || (intval($in_option_number) &lt; 1) || (intval($in_option_number) &gt; ($this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>() + 1))) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            $in_option_number = 0;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4e59c6b75babaf5435e0629cdcf615a4">getBMLTOptions_by_id</a>($in_options[<span class="stringliteral">&#39;id&#39;</span>], $in_option_number);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (intval($in_option_number) &gt; 0) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            $option_number = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="comment">// If they want a certain option number, then it needs to be greater than 1, and within the number we have assigned (We can also increase by 1).</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="keywordflow">if</span> ((intval($in_option_number) &gt; 1) &amp;&amp; (intval($in_option_number) &lt;= ($this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>() + 1))) {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                $option_number = <span class="charliteral">&#39;_&#39;</span>.intval($in_option_number);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            $in_option_number = (intval($in_option_number) &gt; 1) ? intval($in_option_number) : 1;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            $name = self::$adminOptionsName.$option_number;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <span class="comment">// If this is a new option, then we also update the admin 2 options, incrementing the number of servers.</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="keywordflow">if</span> (intval($in_option_number) == ($this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>() + 1)) {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                $in_options[<span class="stringliteral">&#39;id&#39;</span>] = strval(time() + intval(rand(0, 999)));   <span class="comment">// This gives the option a unique slug</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                $admin2Options = array (<span class="stringliteral">&#39;num_servers&#39;</span> =&gt; intval($in_option_number));</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                $gKey = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                <span class="keywordflow">if</span> (isset($in_options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;&#39;</span> != $in_options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;INVALID&#39;</span> != $in_options[<span class="stringliteral">&#39;google_api_key&#39;</span>])) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                    $gKey = $in_options[<span class="stringliteral">&#39;google_api_key&#39;</span>];</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <span class="keywordflow">for</span> ($c = 0; $c &lt; count($in_options); $c++) {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                    <span class="keywordflow">if</span> ($num != $in_option_number) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                        $option = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>($c);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                        $option[<span class="stringliteral">&#39;google_api_key&#39;</span>] = $gKey;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                $admin2Options = array (<span class="stringliteral">&#39;num_servers&#39;</span> =&gt; intval($in_option_number), <span class="stringliteral">&#39;google_api_key&#39;</span> =&gt; $gKey );</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa388869ead7009a0a1dcc9695ebaf5c7">setAdmin2Options</a>($admin2Options);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a7b8aaef06ef3c920173f0a1f6c6d6325">cms_set_option</a>($name, $in_options);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            $ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (setBMLTOptions)! The option number ($in_option_number) is out of range! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">    *   \brief This gets the admin 2 options from the database.                             *</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">    *   \returns an associative array, with the option settings.                            *</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00663"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a173e10c0a79092e02cdc69d0f0459f38">  663</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a173e10c0a79092e02cdc69d0f0459f38">getAdmin2Options</a>()</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        $bmlt2_BMLTOptions = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">// We have a special set of options for version 2.</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        $old_BMLTOptions = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a812e94daeb7fb59635668fd8e1219ff2">cms_get_option</a>(self::$admin2OptionsName);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keywordflow">if</span> (is_array($old_BMLTOptions) &amp;&amp; count($old_BMLTOptions)) {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            <span class="keywordflow">foreach</span> ($old_BMLTOptions as $key =&gt; $value) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                $bmlt2_BMLTOptions[$key] = $value;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            $bmlt2_BMLTOptions = array (<span class="stringliteral">&#39;num_servers&#39;</span> =&gt; 1, <span class="stringliteral">&#39;google_api_key&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa388869ead7009a0a1dcc9695ebaf5c7">setAdmin2Options</a>($old_BMLTOptions);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">return</span> $bmlt2_BMLTOptions;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">    *   \brief This updates the database with the given options (Admin2 options).           *</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">    *   \returns a boolean. true if success.                                                *</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa388869ead7009a0a1dcc9695ebaf5c7">  687</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa388869ead7009a0a1dcc9695ebaf5c7">setAdmin2Options</a>($in_options) <span class="comment">///&lt; An array. The options to be stored.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        $ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a7b8aaef06ef3c920173f0a1f6c6d6325">cms_set_option</a>(self::$admin2OptionsName, $in_options)) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            $ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">    *   \brief Gets the number of active options.                                           *</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">    *   \returns an integer. The number of options.                                         *</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00704"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">  704</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>()</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        $ret = 1;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        $opts = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a173e10c0a79092e02cdc69d0f0459f38">getAdmin2Options</a>();</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">if</span> (isset($opts[<span class="stringliteral">&#39;num_servers&#39;</span>])) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            $ret = intval($opts[<span class="stringliteral">&#39;num_servers&#39;</span>]);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        } <span class="keywordflow">else</span> <span class="comment">// If the options weren&#39;t already set, we create them now.</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            $opts = array ( <span class="stringliteral">&#39;num_servers&#39;</span> =&gt; 1, <span class="stringliteral">&#39;google_api_key&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa388869ead7009a0a1dcc9695ebaf5c7">setAdmin2Options</a>($opts);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">    *   \brief Makes a new set of options, set as default.                                  *</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">    *   \returns An integer. The index of the options (It will always be the number of      *</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">    *   initial options, plus 1. Null if failed.                                            *</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00726"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac237b680337d5b551c03b83ec771adb9">  726</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac237b680337d5b551c03b83ec771adb9">make_new_options</a>()</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        $opt = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>(-1);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        $ret = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="comment">// If we successfully get the options, we save them, in order to put them in place</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="keywordflow">if</span> (is_array($opt) &amp;&amp; count($opt)) {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a34254745fa910e8b8fbff0a2059e8108">setBMLTOptions</a>($opt, $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>() + 1);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            $ret = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>();</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (make_new_options)! Failed to create new options! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">    *   \brief Deletes the options by ID.                                                   *</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">    *   \returns a boolean. true if success.                                                *</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00749"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab93ea4f1aef8490a0021a15e11d04212">  749</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab93ea4f1aef8490a0021a15e11d04212">delete_options_by_id</a>($in_option_id)   <span class="comment">///&lt; The ID of the option to delete.</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        $ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        $option_num = 0;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4e59c6b75babaf5435e0629cdcf615a4">getBMLTOptions_by_id</a>($in_option_id, $option_num); <span class="comment">// We just want the option number.</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordflow">if</span> ($option_num &gt; 0) {  <span class="comment">// If it&#39;s 1, we&#39;ll let the next function register the error.</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            $ret = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad529626098d05a5d47ec2bcc9bda7249">delete_options</a>($option_num);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">    *   \brief Deletes the indexed options.                                                 *</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">    *   This is a bit of a delicate operation, because we need to re-index all of the other *</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">    *   options, beyond the one being deleted.                                              *</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">    *   You cannot delete the first options (1), if they are the only ones.                 *</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">    *   \returns a boolean. true if success.                                                *</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">    ****************************************************************************************/</span><span class="comment"></span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">    /**&lt;    The index of the option to delete.</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">    It can be 1 -&gt; the number of available options.</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">    For safety&#39;s sake, this cannot be optional.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">    We cannot delete the first (primary) option if there are no others.</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00780"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad529626098d05a5d47ec2bcc9bda7249">  780</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad529626098d05a5d47ec2bcc9bda7249">delete_options</a>($in_option_number)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        $first_num = intval($in_option_number);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        $ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">if</span> ($first_num) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            $last_num = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>();</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <span class="keywordflow">if</span> ((($first_num &gt; 1) &amp;&amp; ($first_num &lt;= $last_num )) || (($first_num == 1) &amp;&amp; ($last_num &gt; 1))) {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">                    OK. At this point, we know which option we&#39;ll be deleting. The way we &quot;delete&quot;</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">                    the option is to cascade all the ones after it down, and then we delete the last one.</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">                    If this is the last one, then there&#39;s no need for a cascade, and we simply delete it.</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">                */</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                <span class="keywordflow">for</span> ($i = $first_num; $i &lt; $last_num; $i++) {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                    $opt = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>($i + 1);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a34254745fa910e8b8fbff0a2059e8108">setBMLTOptions</a>($opt, $i);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                $option_number = <span class="stringliteral">&quot;_$last_num&quot;</span>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                <span class="comment">// Delete the selected option</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                $option_name = self::$adminOptionsName.$option_number;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a9c75c6f237da7458797afc5fdb813ae9">cms_delete_option</a>($option_name);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                $admin2Options = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a173e10c0a79092e02cdc69d0f0459f38">getAdmin2Options</a>();</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                <span class="comment">// This actually decrements the number of available options.</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                $admin2Options[<span class="stringliteral">&#39;num_servers&#39;</span>] = $last_num - 1;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa388869ead7009a0a1dcc9695ebaf5c7">setAdmin2Options</a>($admin2Options);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                $ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                <span class="keywordflow">if</span> ($first_num &gt; 1) {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (delete_options)! Option request number out of range! It must be between 1 and $last_num --&gt;&quot;</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                } elseif ($first_num == 1) {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                    echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (delete_options)! You can&#39;t delete the last option! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                    echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (delete_options)! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (delete_options)! Option request number ($first_num) out of range! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    }</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">    *                      ADMIN PAGE DISPLAY AND PROCESSING FUNCTIONS                      *</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">    *   \brief This does any admin actions necessary.                                       *</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00840"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a8cc64446449a52bb9fc8ff777d0bb501">  840</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a8cc64446449a52bb9fc8ff777d0bb501">process_admin_page</a>(&amp;$out_option_number)   <span class="comment">///&lt; If an option number needs to be selected, it is set here.</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        $out_option_number = 1;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        global <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a9ad4ced6afcdd55144dc7e527d82293f">adapt_to_lang</a>($bmlt_localization);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        $timing = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad7b3cc1fba4480fcd2b6b9aa046d72d4">self::$local_options_success_time</a>;    <span class="comment">// Success is a shorter fade, but failure is longer.</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        $ret = <span class="stringliteral">&#39;&lt;div id=&quot;BMLTPlugin_Message_bar_div&quot; class=&quot;BMLTPlugin_Message_bar_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">if</span> (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;BMLTPlugin_create_option&#39;</span>])) {</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            $out_option_number = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac237b680337d5b551c03b83ec771adb9">make_new_options</a>();</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <span class="keywordflow">if</span> ($out_option_number) {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                $new_options = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>($out_option_number);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                $def_options = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>(1);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                    </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                $new_options = $def_options;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                unset($new_options[<span class="stringliteral">&#39;setting_name&#39;</span>]);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                unset($new_options[<span class="stringliteral">&#39;id&#39;</span>]);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                unset($new_options[<span class="stringliteral">&#39;theme&#39;</span>]);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a34254745fa910e8b8fbff0a2059e8108">setBMLTOptions</a>($new_options, $out_option_number);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                    </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;h2 id=&quot;BMLTPlugin_Fader&quot; class=&quot;BMLTPlugin_Message_bar_success&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                    $ret .= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_create_success);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;/h2&gt;&#39;</span>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                $timing = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae44e562448d334639fc7fa21c8da20f5">self::$local_options_failure_time</a>;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;h2 id=&quot;BMLTPlugin_Fader&quot; class=&quot;BMLTPlugin_Message_bar_fail&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                $ret .= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_create_failure);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;/h2&gt;&#39;</span>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        } elseif (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;BMLTPlugin_delete_option&#39;</span>])) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            $option_index = intval($this-&gt;my_http_vars[<span class="stringliteral">&#39;BMLTPlugin_delete_option&#39;</span>]);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ad529626098d05a5d47ec2bcc9bda7249">delete_options</a>($option_index)) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;h2 id=&quot;BMLTPlugin_Fader&quot; class=&quot;BMLTPlugin_Message_bar_success&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                    $ret .= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_delete_success);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;/h2&gt;&#39;</span>;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                $timing = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae44e562448d334639fc7fa21c8da20f5">self::$local_options_failure_time</a>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;h2 id=&quot;BMLTPlugin_Fader&quot; class=&quot;BMLTPlugin_Message_bar_fail&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                $ret .= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_delete_failure);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;/h2&gt;&#39;</span>;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;h2 id=&quot;BMLTPlugin_Fader&quot; class=&quot;BMLTPlugin_Message_bar_fail&quot;&gt;&amp;nbsp;&lt;/h2&gt;&#39;</span>;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;g_BMLTPlugin_TimeToFade = &#39;</span>.$timing.<span class="stringliteral">&#39;;BMLTPlugin_StartFader()&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">    *   \brief Returns the HTML for the admin page.                                         *</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">    *   \returns a string. The XHTML for the page.                                          *</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae8650a90f37d8edc5dd7c82aed927af8">  896</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae8650a90f37d8edc5dd7c82aed927af8">return_admin_page</a>()</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        $selected_option = 1;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        $process_html = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a8cc64446449a52bb9fc8ff777d0bb501">process_admin_page</a>($selected_option);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        $options_coords = array();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        $html = <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_option_page&quot; id=&quot;BMLTPlugin_option_page_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            $html .= <span class="stringliteral">&#39;&lt;noscript class=&quot;no_js&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noscript).<span class="stringliteral">&#39;&lt;/noscript&gt;&#39;</span>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            $html .= <span class="stringliteral">&#39;&lt;div id=&quot;BMLTPlugin_options_container&quot; style=&quot;display:none&quot;&gt;&#39;</span>;    <span class="comment">// This is displayed using JavaScript.</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;h1 class=&quot;BMLTPlugin_Admin_h1&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_title).<span class="stringliteral">&#39;&lt;/h1&gt;&#39;</span>;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                $html .= $process_html;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;form class=&quot;BMLTPlugin_sheet_form&quot; id=&quot;BMLTPlugin_sheet_form&quot; action =&quot;&#39;</span>.$this-&gt;get_admin_form_uri().<span class="stringliteral">&#39;&quot; method=&quot;get&quot; onsubmit=&quot;function(){return false}&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;fieldset class=&quot;BMLTPlugin_option_fieldset&quot; id=&quot;BMLTPlugin_option_fieldset&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                        $html .= <span class="stringliteral">&#39;&lt;legend id=&quot;BMLTPlugin_legend&quot; class=&quot;BMLTPlugin_legend&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                            $count = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>();</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">if</span> ($count &gt; 1) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            $html .= <span class="stringliteral">&#39;&lt;select id=&quot;BMLTPlugin_legend_select&quot; onchange=&quot;BMLTPlugin_SelectOptionSheet(this.value,&#39;</span>.$count.<span class="stringliteral">&#39;)&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="keywordflow">for</span> ($i = 1; $i &lt;= $count; $i++) {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                $options = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>($i);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                        </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                <span class="keywordflow">if</span> (is_array($options) &amp;&amp; count($options) &amp;&amp; isset($options[<span class="stringliteral">&#39;id&#39;</span>])) {</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                    $options_coords[$i] = array ( <span class="stringliteral">&#39;lat&#39;</span> =&gt; $options[<span class="stringliteral">&#39;map_center_latitude&#39;</span>], <span class="stringliteral">&#39;lng&#39;</span> =&gt; $options[<span class="stringliteral">&#39;map_center_longitude&#39;</span>], <span class="stringliteral">&#39;zoom&#39;</span> =&gt; $options[<span class="stringliteral">&#39;map_zoom&#39;</span>] );</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                            </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;option id=&quot;BMLTPlugin_option_sel_&#39;</span>.$i.<span class="stringliteral">&#39;&quot; value=&quot;&#39;</span>.$i.<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                            </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                    <span class="keywordflow">if</span> ($i == $selected_option) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                            $html .= <span class="stringliteral">&#39; selected=&quot;selected&quot;&#39;</span>;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                                            </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                    $html .= <span class="charliteral">&#39;&gt;&#39;</span>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                    <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;setting_name&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;setting_name&#39;</span>]) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                    $html .= htmlspecialchars($options[<span class="stringliteral">&#39;setting_name&#39;</span>]);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                                                $html .= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_prefix).$i;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                    }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                            $html .= <span class="stringliteral">&#39;&lt;/option&gt;&#39;</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                    echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (admin_page)! Options not found for $i! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                                $html .= <span class="stringliteral">&#39;&lt;/select&gt;&#39;</span>;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        } elseif ($count == 1) {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            $options = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>(1);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            $options_coords[1] = array ( <span class="stringliteral">&#39;lat&#39;</span> =&gt; $options[<span class="stringliteral">&#39;map_center_latitude&#39;</span>], <span class="stringliteral">&#39;lng&#39;</span> =&gt; $options[<span class="stringliteral">&#39;map_center_longitude&#39;</span>], <span class="stringliteral">&#39;zoom&#39;</span> =&gt; $options[<span class="stringliteral">&#39;map_zoom&#39;</span>] );</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;setting_name&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;setting_name&#39;</span>]) {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                $html .= htmlspecialchars($options[<span class="stringliteral">&#39;setting_name&#39;</span>]);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                $html .= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_prefix).<span class="charliteral">&#39;1&#39;</span>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin ERROR (admin_page)! No options! --&gt;&quot;</span>;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                        $html .= <span class="stringliteral">&#39;&lt;/legend&gt;&#39;</span>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keywordflow">for</span> ($i = 1; $i &lt;= $count; $i++) {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            $html .= $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6e6c06884c351fed8cea66c716606141">display_options_sheet</a>($i, (($i == $selected_option) ? <span class="stringliteral">&#39;block&#39;</span> : <span class="stringliteral">&#39;none&#39;</span>));</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        }</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;/fieldset&gt;&#39;</span>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_toolbar_line_bottom&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;form action =&quot;&#39;</span>.$this-&gt;get_admin_form_uri().<span class="stringliteral">&#39;&quot; method=&quot;post&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                        $html .= <span class="stringliteral">&#39;&lt;div id=&quot;BMLTPlugin_bottom_button_div&quot; class=&quot;BMLTPlugin_bottom_button_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <span class="keywordflow">if</span> ($count &gt; 1) {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            $html .= <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_toolbar_button_line_left&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                    $html .= <span class="stringliteral">&quot;var c_g_delete_confirm_message=&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_delete_option_confirm).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;input type=&quot;button&quot; id=&quot;BMLTPlugin_toolbar_button_del&quot; class=&quot;BMLTPlugin_delete_button&quot; value=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_delete_option).<span class="stringliteral">&#39;&quot; onclick=&quot;BMLTPlugin_DeleteOptionSheet()&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                            </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                            $html .= <span class="stringliteral">&#39;&lt;input type=&quot;submit&quot; id=&quot;BMLTPlugin_toolbar_button_new&quot; class=&quot;BMLTPlugin_create_button&quot; name=&quot;BMLTPlugin_create_option&quot; value=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_add_new).<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                            </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                            $html .= <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_toolbar_button_line_right&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                                $html .= <span class="stringliteral">&#39;&lt;input id=&quot;BMLTPlugin_toolbar_button_save&quot; type=&quot;button&quot; value=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_save).<span class="stringliteral">&#39;&quot; onclick=&quot;BMLTPlugin_SaveOptions()&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                            $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                        $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_toolbar_line_map&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;h2 class=&quot;BMLTPlugin_map_label_h2&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_map_label).<span class="stringliteral">&#39;&lt;/h2&gt;&#39;</span>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_Map_Div&quot; id=&quot;BMLTPlugin_Map_Div&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                        $html .= <span class="stringliteral">&quot;BMLTPlugin_DirtifyOptionSheet(true);&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);    <span class="comment">// This sets up the &quot;Save Changes&quot; button as disabled.</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                        <span class="comment">// This is a trick I use to hide irrelevant content from non-JS browsers. The element is drawn, hidden, then uses JS to show. No JS, no element.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                        $html .= <span class="stringliteral">&quot;document.getElementById(&#39;BMLTPlugin_options_container&#39;).style.display=&#39;block&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_no_name = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_no_name_string)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_no_root = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_no_root_server_string)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_root_canal = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_options_url_bad.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_success_message = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_save_success)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_failure_message = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_save_failure)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_success_time = &quot;</span>.intval(self::$local_options_success_time).<span class="stringliteral">&quot;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_failure_time = &quot;</span>.intval(self::$local_options_failure_time).<span class="stringliteral">&quot;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_unsaved_prompt = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_unsaved_message)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_test_server_success = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_test_server_success)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_test_server_failure = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_test_server_failure)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_coords = new Array();&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                        $html .= <span class="stringliteral">&quot;var g_BMLTPlugin_TimeToFade = &quot;</span>.intval(self::$local_options_success_time).<span class="stringliteral">&quot;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                        $html .= <span class="stringliteral">&quot;var g_BMLTPlugin_no_gkey_string = &#39;&quot;</span>.$this-&gt;process_text(str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>, $this-&gt;my_current_language-&gt;local_options_no_gkey_string)).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">if</span> (is_array($options_coords) &amp;&amp; count($options_coords)) {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="keywordflow">foreach</span> ($options_coords as $value) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                $html .= <span class="stringliteral">&#39;c_g_BMLTPlugin_coords[c_g_BMLTPlugin_coords.length] = {&#39;</span>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                $f = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                <span class="keywordflow">foreach</span> ($value as $key2 =&gt; $value2) {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                    <span class="keywordflow">if</span> ($f) {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                        $f = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                        $html .= <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                    }</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                    $html .= <span class="stringliteral">&quot;&#39;&quot;</span>.htmlspecialchars($key2).<span class="stringliteral">&quot;&#39;:&quot;</span>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                    $html .= <span class="stringliteral">&quot;&#39;&quot;</span>.htmlspecialchars($value2).<span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                $html .= <span class="stringliteral">&#39;};&#39;</span>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                        $url = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4005e57d7b24559e6731ed4108cfff46">get_plugin_path</a>();</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                        $url = htmlspecialchars($url.<span class="stringliteral">&#39;google_map_images&#39;</span>);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                        $html .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_admin_google_map_images = &#39;$url&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                        $html .= <span class="stringliteral">&#39;BMLTPlugin_admin_load_map();&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                    $html .= <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        $html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordflow">return</span> $html;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">    *   \brief This will return the HTML for one sheet of options in the admin page.        *</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">    *   \returns The XHTML to be displayed.                                                 *</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6e6c06884c351fed8cea66c716606141"> 1030</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6e6c06884c351fed8cea66c716606141">display_options_sheet</a>(</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        $in_options_index = 1,  <span class="comment">///&lt; The options index. If not given, the first (main) ones are used.</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment"></span>        $display_mode = <span class="stringliteral">&#39;none&#39;</span>  <span class="comment">///&lt; If this page is to be displayed, make it &#39;block&#39;.</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        $ret = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        $in_options_index = intval($in_options_index);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keywordflow">if</span> (($in_options_index &lt; 1) || ($in_options_index &gt; $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">get_num_options</a>())) {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            echo <span class="stringliteral">&quot;&lt;!-- BMLTPlugin Warning (display_options_sheet)! $in_options_index is out of range! Using the first options. --&gt;&quot;</span>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            $in_options_index = 1;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        }</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        $options = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">getBMLTOptions</a>($in_options_index);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="keywordflow">if</span> (is_array($options) &amp;&amp; count($options) &amp;&amp; isset($options[<span class="stringliteral">&#39;id&#39;</span>])) {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_option_sheet&quot; id=&quot;BMLTPlugin_option_sheet_&#39;</span>.$in_options_index.<span class="stringliteral">&#39;_div&quot; style=&quot;display:&#39;</span>.htmlspecialchars($display_mode).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;h2 class=&quot;BMLTPlugin_option_id_h2&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_settings_id_prompt).htmlspecialchars($options[<span class="stringliteral">&#39;id&#39;</span>]).<span class="stringliteral">&#39;&lt;/h2&gt;&#39;</span>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;actual_options_id&quot; id=&quot;BMLTPlugin_option_sheet_&#39;</span>.$in_options_index.<span class="stringliteral">&#39;_actual_options_id&quot; value=&quot;&#39;</span>.htmlspecialchars($options[<span class="stringliteral">&#39;id&#39;</span>]).<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;BMLTPlugin_option_sheet_line_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                    $id = <span class="stringliteral">&#39;BMLTPlugin_option_sheet_name_&#39;</span>.$in_options_index;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;label for=&quot;&#39;</span>.htmlspecialchars($id).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_name_label).<span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                        $string = (isset($options[<span class="stringliteral">&#39;setting_name&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;setting_name&#39;</span>] ? $options[<span class="stringliteral">&#39;setting_name&#39;</span>] : $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_no_name_string) );</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;input class=&quot;BMLTPlugin_option_sheet_line_name_text&quot; id=&quot;&#39;</span>.htmlspecialchars($id).<span class="stringliteral">&#39;&quot; type=&quot;text&quot; value=&quot;&#39;</span>.htmlspecialchars($string).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                    $ret .= <span class="stringliteral">&#39; onfocus=&quot;BMLTPlugin_ClickInText(this.id,\&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_no_name_string).<span class="charliteral">&#39;\&#39;</span>,<span class="keyword">false</span>)<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="stringliteral">                    $ret .= &#39; onblur=&quot;</span>BMLTPlugin_ClickInText(this.<span class="keywordtype">id</span>,\<span class="stringliteral">&#39;&#39;</span>.$this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_no_name_string).<span class="charliteral">&#39;\&#39;</span>,<span class="keyword">true</span>)<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="stringliteral">                    $ret .= &#39; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot; onkeyup=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot; /&gt;&#39;;</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="stringliteral">                    $id = &#39;BMLTPlugin_option_sheet_root_server_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_rootserver_label).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="stringliteral">                        $string = (isset($options[&#39;root_server&#39;]) &amp;&amp; $options[&#39;root_server&#39;] ? $options[&#39;root_server&#39;] : $this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_no_root_server_string) );</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;input class=&quot;</span>BMLTPlugin_option_sheet_line_root_server_text<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; type=&quot;</span>text<span class="stringliteral">&quot; value=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($string).&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="stringliteral">                    $ret .= &#39; onfocus=&quot;</span>BMLTPlugin_ClickInText(this.<span class="keywordtype">id</span>,\<span class="stringliteral">&#39;&#39;</span>.$this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_no_root_server_string).<span class="charliteral">&#39;\&#39;</span>,<span class="keyword">false</span>)<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="stringliteral">                    $ret .= &#39; onblur=&quot;</span>BMLTPlugin_ClickInText(this.<span class="keywordtype">id</span>,\<span class="stringliteral">&#39;&#39;</span>.$this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_options_no_root_server_string).<span class="charliteral">&#39;\&#39;</span>,<span class="keyword">true</span>)<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="stringliteral">                    $ret .= &#39; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot; onkeyup=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot; /&gt;&#39;;</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_Test_Button_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;input type=&quot;</span>button<span class="stringliteral">&quot; value=&quot;</span><span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_test_server).&#39;</span><span class="stringliteral">&quot; onclick=&quot;</span>BMLTPlugin_TestRootUri_call()<span class="stringliteral">&quot; title=&quot;</span><span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_test_server_tooltip).&#39;</span><span class="stringliteral">&quot; /&gt;&#39;;</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_NEUT<span class="stringliteral">&quot; id=&quot;</span>BMLTPlugin_option_sheet_indicator_<span class="stringliteral">&#39;.$in_options_index.&#39;</span><span class="stringliteral">&quot;&gt;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_Version<span class="stringliteral">&quot; id=&quot;</span>BMLTPlugin_option_sheet_version_indicator_<span class="stringliteral">&#39;.$in_options_index.&#39;</span><span class="stringliteral">&quot;&gt;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="stringliteral">                $dir_res = opendir(dirname(__FILE__).&#39;/themes&#39;);</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="stringliteral">            if ($dir_res) {</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="stringliteral">                    $id = &#39;BMLTPlugin_option_sheet_theme_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_theme_prompt).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="stringliteral">                while (false !== ( $file_name = readdir($dir_res) )) {</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="stringliteral">                    if (!preg_match(&#39;/^\./&#39;, $file_name) &amp;&amp; is_dir(dirname(__FILE__).&#39;/themes/&#39;.$file_name)) {</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="stringliteral">                                $ret .= &#39;&lt;option value=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($file_name).&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="stringliteral">                        if ($file_name == $options[&#39;theme&#39;]) {</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="stringliteral">                            $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="stringliteral">                                $ret .= &#39;&gt;&#39;.htmlspecialchars($file_name).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div BMLTPlugin_additional_css_line<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="stringliteral">                    $id = &#39;BMLTPlugin_option_sheet_additional_css_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_more_styles_label).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;textarea class=&quot;</span>BMLTPlugin_option_sheet_additional_css_textarea<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot; onkeyup=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="stringliteral">                    $ret .= htmlspecialchars($options[&#39;additional_css&#39;]);</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/textarea&gt;&#39;;</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;fieldset class=&quot;</span>BMLTPlugin_option_sheet_mobile_settings_fieldset<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;legend class=&quot;</span>BMLTPlugin_gmap_caveat_legend<span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_mobile_legend).&#39;&lt;/legend&gt;&#39;;</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div BMLTPlugin_google_api_line<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_google_api_label_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_google_api_label).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_google_api_text_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="stringliteral">                        $gKey = &#39;&#39;;</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="stringliteral">            if (isset($options[&#39;google_api_key&#39;]) &amp;&amp; (&#39;&#39; != $options[&#39;google_api_key&#39;]) &amp;&amp; (&#39;INVALID&#39; != $options[&#39;google_api_key&#39;])) {</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="stringliteral">                $gKey = $options[&#39;google_api_key&#39;];</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;input class=&quot;</span>BMLTPlugin_google_api_text<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; type=&quot;</span>text<span class="stringliteral">&quot; value=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($gKey).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet(); BMLTPlugin_PropagateAPIKey( this.value )<span class="stringliteral">&quot; onkeyup=&quot;</span>BMLTPlugin_DirtifyOptionSheet(); BMLTPlugin_PropagateAPIKey( this.value )<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_distance_units_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_distance_prompt).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="stringliteral">                            $ret .= &#39;&lt;option value=&quot;</span>mi<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="stringliteral">            if (&#39;mi&#39; == $options[&#39;distance_units&#39;]) {</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="stringliteral">                $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="stringliteral">                            $ret .= &#39;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_miles).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="stringliteral">                            $ret .= &#39;&lt;option value=&quot;</span>km<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="stringliteral">            if (&#39;km&#39; == $options[&#39;distance_units&#39;]) {</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="stringliteral">                $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="stringliteral">                            $ret .= &#39;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_kilometers).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_lang_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_lang_prompt).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="stringliteral">                            $dirname = dirname(__FILE__) . &quot;</span>/lang<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="stringliteral">                            $dir = new DirectoryIterator($dirname);</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="stringliteral">            foreach ($dir as $fileinfo) {</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="stringliteral">                if (!$fileinfo-&gt;isDot()) {</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="stringliteral">                    $fName = $fileinfo-&gt;getFilename();</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="stringliteral">                    if ($fName != &quot;</span>index.php<span class="stringliteral">&quot;) {</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="stringliteral">                        $fPath = $dirname . &quot;</span>/<span class="stringliteral">&quot; . $fName;</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="stringliteral">                        if ($file = fopen($fPath, &quot;</span>r<span class="stringliteral">&quot;)) {</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="stringliteral">                            $line0 = fgets($file);</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="stringliteral">                            $line1 = fgets($file);</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="stringliteral">                            $lang_name = trim(substr($line1, 3));</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="stringliteral">                            $lang_key = trim(substr($fName, 5, -4));</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="stringliteral">                            if ($lang_name &amp;&amp; $lang_key) {</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="stringliteral">                                $ret .= &#39;&lt;option value=&quot;</span><span class="stringliteral">&#39; . $lang_key .&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="stringliteral">                                if ($options[&#39;lang&#39;] == $lang_key) {</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="stringliteral">                                    $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="stringliteral">                                }</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="stringliteral">                                $ret .= &#39;&gt;&#39; . $this-&gt;process_text($lang_name) .&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_region_bias_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_mobile_region_bias_label).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="stringliteral">                        $ret .= $this-&gt;bmlt_create_region_bias_select($id, $options);</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_week_begins_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_week_begins_on_prompt).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="stringliteral">                            $sel_weekday = intval((isset($options[&#39;startWeekday&#39;]) &amp;&amp; $options[&#39;startWeekday&#39;]) ? $options[&#39;startWeekday&#39;] : self::$default_startWeekday);</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="stringliteral">                            $counter = 1;</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="stringliteral">                            $weekdays = $this-&gt;my_current_language-&gt;local_nouveau_weekday_long_array;</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="stringliteral">            foreach ($weekdays as $weekday_text) {</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;option&#39;;</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="stringliteral">                    $ret .= &#39; value=&quot;</span><span class="stringliteral">&#39;.$counter.&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="stringliteral">                if ($options[&#39;startWeekday&#39;] == $counter) {</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="stringliteral">                                $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="stringliteral">                    $counter++;</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="stringliteral">                                $ret .= &#39;&gt;&#39;.$this-&gt;process_text($weekday_text).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_time_format_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_time_format_prompt).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="stringliteral">                            $ret .= &#39;&lt;option&#39;;</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="stringliteral">            if (!$options[&#39;military_time&#39;]) {</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="stringliteral">                $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="stringliteral">                            $ret .= &#39;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_time_format_ampm).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="stringliteral">                            $ret .= &#39;&lt;option&#39;;</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="stringliteral">            if ($options[&#39;military_time&#39;]) {</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="stringliteral">                $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="stringliteral">                            $ret .= &#39;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_time_format_military).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_initial_view_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_initial_view_prompt).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="stringliteral">            foreach ($this-&gt;my_current_language-&gt;local_options_initial_view as $value =&gt; $prompt) {</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;option value=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($value).&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="stringliteral">                if ($value == $options[&#39;bmlt_initial_view&#39;]) {</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="stringliteral">                    $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="stringliteral">                $ret .= &#39;&gt;&#39;.$this-&gt;process_text($prompt).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_auto_search_radius_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_auto_search_radius_prompt).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="stringliteral">            foreach ($this-&gt;my_current_language-&gt;local_options_auto_search_radius_display_names as $prompt =&gt; $value) {</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;option value=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($value).&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="stringliteral">                if ($value == $options[&#39;default_geo_width&#39;]) {</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="stringliteral">                    $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="stringliteral">                $ret .= &#39;&gt;&#39;.$this-&gt;process_text($prompt).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div BMLTPlugin_location_checkbox_line<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_location_selected_checkbox_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_checkbox_div<span class="stringliteral">&quot;&gt;&lt;input class=&quot;</span>BMLTPlugin_option_sheet_line_location_checkbox<span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; type=&quot;</span>checkbox<span class="stringliteral">&quot;&#39;.($options[&#39;bmlt_location_checked&#39;] == 1 ? &#39; checked=&quot;</span>checked<span class="stringliteral">&quot;&#39; : &#39;&#39; ).&#39;&quot;</span>&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="stringliteral">                        $ret .= &#39;</span>&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;&#39;.htmlspecialchars($id).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_settings_location_checkbox_label).&#39;</span>&lt;/label&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="stringliteral">                    $ret .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="stringliteral">                    $ret .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;BMLTPlugin_option_sheet_line_div BMLTPlugin_location_checkbox_line&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="stringliteral">                        $id = &#39;</span>BMLTPlugin_location_services_checkbox_<span class="stringliteral">&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="stringliteral">                        $ret .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;BMLTPlugin_option_sheet_checkbox_div&quot;</span>&gt;&lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;BMLTPlugin_option_sheet_line_location_services_checkbox&quot;</span> onchange=<span class="stringliteral">&quot;BMLTPlugin_DirtifyOptionSheet()&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;&#39;.htmlspecialchars($id).&#39;&quot;</span> type=<span class="stringliteral">&quot;checkbox&quot;</span><span class="stringliteral">&#39;.($options[&#39;</span>bmlt_location_services<span class="stringliteral">&#39;] == 1 ? &#39;</span> checked=<span class="stringliteral">&quot;checked&quot;</span><span class="stringliteral">&#39; : &#39;</span><span class="stringliteral">&#39; ).&#39;</span><span class="stringliteral">&quot;&gt;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_selectLocation_checkbox_text).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_line_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="stringliteral">                        $id = &#39;BMLTPlugin_option_sheet_grace_period_&#39;.$in_options_index;</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;label for=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_mobile_grace_period_label).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;select id=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($id).&#39;</span><span class="stringliteral">&quot; onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="stringliteral">            for ($minute = 0; $minute &lt; 60; $minute += 5) {</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;option value=&quot;</span><span class="stringliteral">&#39;.$minute.&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="stringliteral">                if ($minute == $options[&#39;grace_period&#39;]) {</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="stringliteral">                    $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="stringliteral">                $ret .= &#39;&gt;&#39;.$minute.&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="stringliteral">                        $ret .= &#39;&lt;div class=&quot;</span>BMLTPlugin_option_sheet_text_div<span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_options_grace_period_disclaimer).&#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="stringliteral">                    $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;/fieldset&gt;&#39;;</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="stringliteral">        } else {</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="stringliteral">            echo &quot;</span>&lt;!-- <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html">BMLTPlugin</a> ERROR (<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6e6c06884c351fed8cea66c716606141">display_options_sheet</a>)! Options not found <span class="keywordflow">for</span> $in_options_index! --&gt;<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="stringliteral">    /*******************************************************************/</span><span class="comment"></span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">    /** \brief Creates the select element for the Region bias.</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">    *   \returns a string, containing the select element HTML.</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</div>
<div class="line"><a name="l01262"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ac412a3fc260044bb7e971016d84ad722"> 1262</a></span>&#160;    public function bmlt_create_region_bias_select($in_id, $in_options)</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    {</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        $ret = &#39;&#39;;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        $file_path = dirname(__FILE__).&#39;/country_names_and_code_elements.txt&#39;;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        $cc_array = explode(&quot;\n<span class="stringliteral">&quot;, file_get_contents($file_path));</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="stringliteral">        $ret .= &#39;&lt;select onchange=&quot;</span>BMLTPlugin_DirtifyOptionSheet()<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.$in_id.&#39;</span><span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="stringliteral">        foreach ($cc_array as $cc) {</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="stringliteral">            $cc_elem = explode(&quot;</span>\t<span class="stringliteral">&quot;, trim($cc));</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="stringliteral">            if (isset($cc_elem) &amp;&amp; is_array($cc_elem) &amp;&amp; (count($cc_elem) == 2)) {</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="stringliteral">                $name = ucwords(strtolower(trim($cc_elem[0])));</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="stringliteral">                $code = strtolower(trim($cc_elem[1]));</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;option value=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($code).&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="stringliteral">                if (strtolower($in_options[&#39;region_bias&#39;]) == $code) {</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="stringliteral">                    $ret .= &#39; selected=&quot;</span>selected<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="stringliteral">                    $ret .= &#39;&gt;&#39;.htmlspecialchars($name).&#39;&lt;/option&gt;&#39;;</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/select&gt;&#39;;</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="stringliteral">            return $ret;</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="stringliteral">    *                                   GENERIC HANDLERS                                    *</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="stringliteral">    *   \brief This does any admin actions necessary.                                       *</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#afcfc6bb88dd438a0a5b202125385efdf"> 1297</a></span>&#160;<span class="stringliteral">    public function admin_ajax_handler()</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="stringliteral">        // We only go here if we are in an AJAX call (This function dies out the session).</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="stringliteral">        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_Save_Settings_AJAX_Call&#39;])) {</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="stringliteral">            $ret = 0;</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="stringliteral">            if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_set_options&#39;])) {</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="stringliteral">                $ret = 1;</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="stringliteral">                $num_options = $this-&gt;get_num_options();</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="stringliteral">                for ($i = 1; $i &lt;= $num_options; $i++) {</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="stringliteral">                    $options = $this-&gt;getBMLTOptions($i);</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="stringliteral">                    if (is_array($options) &amp;&amp; count($options)) {</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_actual_id_&#39;.$i])) {</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="stringliteral">                            if (trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_actual_id_&#39;.$i])) {</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="stringliteral">                                $options[&#39;id&#39;] = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_actual_id_&#39;.$i]);</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="stringliteral">                                $options[&#39;id&#39;] = &#39;&#39;;</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_name_&#39;.$i])) {</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="stringliteral">                            if (trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_name_&#39;.$i])) {</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="stringliteral">                                $options[&#39;setting_name&#39;] = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_name_&#39;.$i]);</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="stringliteral">                                $options[&#39;setting_name&#39;] = &#39;&#39;;</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_google_api_text_&#39;.$i])) {</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="stringliteral">                            if (trim($this-&gt;my_http_vars[&#39;BMLTPlugin_google_api_text_&#39;.$i])) {</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="stringliteral">                                $options[&#39;google_api_key&#39;] = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_google_api_text_&#39;.$i]);</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="stringliteral">                                $options[&#39;google_api_key&#39;] = &#39;&#39;;</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_root_server_&#39;.$i])) {</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="stringliteral">                            if (trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_root_server_&#39;.$i])) {</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="stringliteral">                                $options[&#39;root_server&#39;] = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_root_server_&#39;.$i]);</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="stringliteral">                                $options[&#39;root_server&#39;] = self::$default_rootserver;</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_initial_view_&#39;.$i])) {</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="stringliteral">                            if (trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_initial_view_&#39;.$i])) {</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="stringliteral">                                $options[&#39;bmlt_initial_view&#39;] = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_initial_view_&#39;.$i]);</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="stringliteral">                                $options[&#39;bmlt_initial_view&#39;] = self::$default_initial_view;</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_theme_&#39;.$i])) {</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="stringliteral">                            if (trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_theme_&#39;.$i])) {</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="stringliteral">                                $options[&#39;theme&#39;] = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_theme_&#39;.$i]);</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="stringliteral">                                $options[&#39;theme&#39;] = self::$default_theme;</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_additional_css_&#39;.$i])) {</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="stringliteral">                            if (trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_additional_css_&#39;.$i])) {</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="stringliteral">                                $options[&#39;additional_css&#39;] = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_additional_css_&#39;.$i]);</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="stringliteral">                                $options[&#39;additional_css&#39;] = self::$default_additional_css;</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_latitude_&#39;.$i]) &amp;&amp; floatVal($this-&gt;my_http_vars[&#39;BMLTPlugin_option_latitude_&#39;.$i])) {</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="stringliteral">                            $options[&#39;map_center_latitude&#39;] = floatVal($this-&gt;my_http_vars[&#39;BMLTPlugin_option_latitude_&#39;.$i]);</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_longitude_&#39;.$i]) &amp;&amp; floatVal($this-&gt;my_http_vars[&#39;BMLTPlugin_option_longitude_&#39;.$i])) {</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="stringliteral">                            $options[&#39;map_center_longitude&#39;] = floatVal($this-&gt;my_http_vars[&#39;BMLTPlugin_option_longitude_&#39;.$i]);</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_zoom_&#39;.$i]) &amp;&amp; intval($this-&gt;my_http_vars[&#39;BMLTPlugin_option_zoom_&#39;.$i])) {</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="stringliteral">                            $options[&#39;map_zoom&#39;] = floatVal($this-&gt;my_http_vars[&#39;BMLTPlugin_option_zoom_&#39;.$i]);</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_distance_units_&#39;.$i])) {</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="stringliteral">                            $options[&#39;distance_units&#39;] = $this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_distance_units_&#39;.$i];</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_time_format_&#39;.$i])) {</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="stringliteral">                            $options[&#39;military_time&#39;] = (intval($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_time_format_&#39;.$i]) != 0);</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_week_begins_&#39;.$i])) {</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="stringliteral">                            $options[&#39;startWeekday&#39;] = intval($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_week_begins_&#39;.$i]);</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_grace_period_&#39;.$i])) {</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="stringliteral">                            $options[&#39;grace_period&#39;] = $this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_grace_period_&#39;.$i];</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_region_bias_&#39;.$i])) {</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="stringliteral">                            $options[&#39;region_bias&#39;] = $this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_region_bias_&#39;.$i];</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_lang_&#39;.$i])) {</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="stringliteral">                            $options[&#39;lang&#39;] = $this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_lang_&#39;.$i];</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_auto_search_radius_&#39;.$i])) {</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="stringliteral">                            $options[&#39;default_geo_width&#39;] = $this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_auto_search_radius_&#39;.$i];</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_time_offset_&#39;.$i])) {</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="stringliteral">                            $options[&#39;time_offset&#39;] = $this-&gt;my_http_vars[&#39;BMLTPlugin_option_sheet_time_offset_&#39;.$i];</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_location_selected_checkbox_&#39;.$i])) {</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="stringliteral">                            $options[&#39;bmlt_location_checked&#39;] = ($this-&gt;my_http_vars[&#39;BMLTPlugin_location_selected_checkbox_&#39;.$i] != 0 ? 1 : 0);</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_location_services_checkbox_&#39;.$i])) {</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="stringliteral">                            $options[&#39;bmlt_location_services&#39;] = ($this-&gt;my_http_vars[&#39;BMLTPlugin_location_services_checkbox_&#39;.$i] != 0 ? 1 : 0);</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="stringliteral">                        if (!$this-&gt;setBMLTOptions($options, $i)) {</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="stringliteral">                            $ret = 0;</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="stringliteral">                            break;</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="stringliteral">            if (ob_get_level()) {</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="stringliteral">                ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="stringliteral">            die(strVal($ret));</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="stringliteral">        } elseif (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_AJAX_Call&#39;]) || isset($this-&gt;my_http_vars[&#39;BMLTPlugin_Fetch_Langs_AJAX_Call&#39;])) {</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="stringliteral">            $ret = &#39;&#39;;</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="stringliteral">            if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_AJAX_Call_Check_Root_URI&#39;])) {</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="stringliteral">                $uri = trim($this-&gt;my_http_vars[&#39;BMLTPlugin_AJAX_Call_Check_Root_URI&#39;]);</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="stringliteral">                $test = new bmlt_satellite_controller($uri);</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="stringliteral">                if ($uri &amp;&amp; ($uri != $this-&gt;my_current_language-&gt;local_options_no_root_server_string ) &amp;&amp; ($test instanceof bmlt_satellite_controller)) {</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="stringliteral">                    if (!$test-&gt;get_m_error_message()) {</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="stringliteral">                        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_AJAX_Call&#39;])) {</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="stringliteral">                            $ret = trim($test-&gt;get_server_version());</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="stringliteral">                            $ret = explode(&quot;</span>.<span class="stringliteral">&quot;, $ret);</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="stringliteral">                            if ((intval($ret[0]) &lt; 1) || ((intval($ret[0]) == 1) &amp;&amp; (intval($ret[1]) &lt; 10))  || ((intval($ret[0]) == 1) &amp;&amp; (intval($ret[1]) == 10) &amp;&amp; (intval($ret[2]) &lt; 3))) {</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="stringliteral">                                $ret = &#39;&#39;;</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="stringliteral">                            } else {</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="stringliteral">                                $ret = implode(&#39;.&#39;, $ret);</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="stringliteral">                        } else {</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="stringliteral">                            $slangs = $test-&gt;get_server_langs();</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="stringliteral">                            if ($slangs) {</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="stringliteral">                                $langs = array();</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="stringliteral">                                foreach ($slangs as $key =&gt; $value) {</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="stringliteral">                                    $langs[] = array ( $key, $value[&#39;name&#39;], $value[&#39;default&#39;] );</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="stringliteral">                                }</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="stringliteral">                                </span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="stringliteral">                                $ret = array2json($langs);</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="stringliteral">            if (ob_get_level()) {</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="stringliteral">                ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="stringliteral">            header(&quot;</span>Content-type: text/html; charset=ISO-8859-1<span class="stringliteral">&quot;);</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="stringliteral">            die($ret);</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="stringliteral">      </span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="stringliteral">    *   \brief Handles some AJAX routes                                                     *</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="stringliteral">    *   This function is called after the page has loaded its custom fields, so we can      *</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="stringliteral">    *   figure out which settings we&#39;re using. If the settings support mobiles, and the UA  *</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="stringliteral">    *   indicates this is a mobile phone, we redirect the user to our fast mobile handler.  *</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a110ca5d835d4eeec80a0e0cd6de9c143"> 1483</a></span>&#160;<span class="stringliteral">    public function ajax_router()</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="stringliteral">        // If this is a basic AJAX call, we drop out quickly (We&#39;re really just a router).</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="stringliteral">        if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_mobile_ajax_router&#39;])) {</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="stringliteral">            $options = $this-&gt;getBMLTOptions_by_id($this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;]); // This is for security. We don&#39;t allow URIs to be directly specified. They must come from the settings.</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="stringliteral">            $uri = $options[&#39;root_server&#39;].&#39;/&#39;.$this-&gt;my_http_vars[&#39;request&#39;];</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="stringliteral">            if (ob_get_level()) {</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="stringliteral">                ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="stringliteral">            die(bmlt_satellite_controller::call_curl($uri));</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="stringliteral">        } else // However, if it is a mobile call, we do the mobile thing, then drop out.</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="stringliteral">            {</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="stringliteral">            if (isset($this-&gt;my_http_vars[&#39;BMLTPlugin_mobile&#39;])) {</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="stringliteral">                $ret = $this-&gt;BMLTPlugin_fast_mobile_lookup();</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="stringliteral">                if (ob_get_level()) {</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="stringliteral">                    ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="stringliteral">                $handler = null;</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="stringliteral">                if (zlib_get_coding_type() === false) {</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="stringliteral">                    $handler = &quot;</span>ob_gzhandler<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="stringliteral">                ob_start($handler);</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="stringliteral">                    echo $ret;</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="stringliteral">                ob_end_flush();</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="stringliteral">                die();</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="stringliteral">            } else {</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="stringliteral">                if (!isset($this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;])) {</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="stringliteral">                    $this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;] = null; // Just to squash a warning.</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="stringliteral">                $options = $this-&gt;getBMLTOptions_by_id($this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;]);</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="stringliteral">                $this-&gt;load_params();</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="stringliteral">                if (isset($this-&gt;my_http_vars[&#39;redirect_ajax&#39;]) &amp;&amp; $this-&gt;my_http_vars[&#39;redirect_ajax&#39;]) {</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="stringliteral">                    $url = $options[&#39;root_server&#39;].&quot;</span>/client_interface/xhtml/index.php?switcher=RedirectAJAX$this-&gt;my_params<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="stringliteral">                    if (ob_get_level()) {</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="stringliteral">                        ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="stringliteral">                    $ret = bmlt_satellite_controller::call_curl($url);</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="stringliteral">                    $handler = null;</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="stringliteral">                    if (zlib_get_coding_type() === false) {</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="stringliteral">                        $handler = &quot;</span>ob_gzhandler<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="stringliteral">                    header(&quot;</span>Content-type: text/html; charset=UTF-8<span class="stringliteral">&quot;);</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="stringliteral">                    ob_start($handler);</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="stringliteral">                        echo $ret;</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="stringliteral">                    ob_end_flush();</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="stringliteral">                    die();</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="stringliteral">                } elseif (isset($this-&gt;my_http_vars[&#39;redirect_ajax_json&#39;])) {</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="stringliteral">                    $url = $options[&#39;root_server&#39;].&quot;</span>/client_interface/json/index.php?<span class="stringliteral">&quot;.$this-&gt;my_http_vars[&#39;redirect_ajax_json&#39;].$this-&gt;my_params;</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="stringliteral">                    if (ob_get_level()) {</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="stringliteral">                        ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="stringliteral">                    $ret = bmlt_satellite_controller::call_curl($url);</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="stringliteral">                    $handler = null;</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="stringliteral">                    if (zlib_get_coding_type() === false) {</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="stringliteral">                        $handler = &quot;</span>ob_gzhandler<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="stringliteral">                    header(&quot;</span>Content-type: text/json; charset=ISO-8859-1<span class="stringliteral">&quot;);</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="stringliteral">                    ob_start($handler);</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="stringliteral">                        echo $ret;</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="stringliteral">                    ob_end_flush();</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="stringliteral">                    die();</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="stringliteral">                } elseif (isset($this-&gt;my_http_vars[&#39;direct_simple&#39;])) {</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="stringliteral">                    $this-&gt;adapt_to_lang($options[&#39;lang&#39;]);</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="stringliteral">                    $root_server = $options[&#39;root_server&#39;].&quot;</span>/client_interface/simple/index.php<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="stringliteral">                    $params = urldecode($this-&gt;my_http_vars[&#39;search_parameters&#39;]);</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="stringliteral">                    $url = &quot;</span>$root_server?switcher=GetSearchResults&amp;<span class="stringliteral">&quot;.$params;</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="stringliteral">                    $result = bmlt_satellite_controller::call_curl($url);</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="stringliteral">                    $result = preg_replace(&#39;|&lt;a |&#39;, &#39;&lt;a rel=&quot;</span>nofollow external<span class="stringliteral">&quot; &#39;, $result);</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="stringliteral">                    // What all this does, is pick out the single URI in the search parameters string, and replace the meeting details link with it.</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="stringliteral">                    if (preg_match(&#39;|&amp;single_uri=|&#39;, $params)) {</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="stringliteral">                        $single_uri = &#39;&#39;;</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="stringliteral">                        $sp = explode(&#39;&amp;&#39;, $params);</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="stringliteral">                        foreach ($sp as $s) {</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="stringliteral">                            if (preg_match(&#39;|single_uri=|&#39;, $s)) {</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="stringliteral">                                list ( $key, $single_uri ) = explode(&#39;=&#39;, $s);</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="stringliteral">                                break;</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="stringliteral">                        if ($single_uri) {</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="stringliteral">                            $result = preg_replace(&#39;|&lt;a [^&gt;]*href=&quot;</span><span class="stringliteral">&#39;.preg_quote($options[&#39;</span>root_server<span class="stringliteral">&#39;]).&#39;</span>.*?single_meeting_id=(\d+)[^&gt;]*&gt;|<span class="stringliteral">&#39;, &quot;&lt;a rel=\&quot;nofollow\&quot; title=\&quot;&quot;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_single_meeting_tooltip).&quot;\&quot; href=\&quot;&quot;.$single_uri.&quot;=$1&amp;amp;supports_ajax=yes\&quot;&gt;&quot;, $result);</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="stringliteral">                        $result = preg_replace(&#39;</span>|\&lt;a rel=<span class="stringliteral">&quot;external&quot;</span>|<span class="stringliteral">&#39;, &#39;</span>&lt;a rel=<span class="stringliteral">&quot;nofollow external&quot;</span> title=<span class="stringliteral">&quot;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_gm_link_tooltip).&#39;&quot;</span><span class="stringliteral">&#39;, $result);</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="stringliteral">                    if (ob_get_level()) {</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="stringliteral">                        ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="stringliteral">                    $handler = null;</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="stringliteral">                    if (zlib_get_coding_type() === false) {</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="stringliteral">                        $handler = &quot;ob_gzhandler&quot;;</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="stringliteral">                    header(&quot;Content-type: text/html; charset=UTF-8&quot;);</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="stringliteral">                    ob_start($handler);</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="stringliteral">                        echo $result;</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="stringliteral">                    ob_end_flush();</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="stringliteral">                    die();</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="stringliteral">                } elseif (isset($this-&gt;my_http_vars[&#39;</span>result_type_advanced<span class="stringliteral">&#39;]) &amp;&amp; ($this-&gt;my_http_vars[&#39;</span>result_type_advanced<span class="stringliteral">&#39;] == &#39;</span>booklet<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="stringliteral">                    $uri =  $options[&#39;</span>root_server<span class="stringliteral">&#39;].&quot;/local_server/pdf_generator/?list_type=booklet$this-&gt;my_params&quot;;</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="stringliteral">                    if (ob_get_level()) {</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="stringliteral">                        ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="stringliteral">                    header(&quot;Location: $uri&quot;);</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="stringliteral">                    die();</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="stringliteral">                } elseif (isset($this-&gt;my_http_vars[&#39;</span>result_type_advanced<span class="stringliteral">&#39;]) &amp;&amp; ($this-&gt;my_http_vars[&#39;</span>result_type_advanced<span class="stringliteral">&#39;] == &#39;</span>listprint<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="stringliteral">                    $uri =  $options[&#39;</span>root_server<span class="stringliteral">&#39;].&quot;/local_server/pdf_generator/?list_type=listprint$this-&gt;my_params&quot;;</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="stringliteral">                    if (ob_get_level()) {</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="stringliteral">                        ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="stringliteral">                    header(&quot;Location: $uri&quot;);</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="stringliteral">                    die();</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="stringliteral">    *   \brief Massages the page content.                                                   *</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="stringliteral">    *   \returns a string, containing the &quot;massaged&quot; content.                               *</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#abb9c6af3595575613ab48edbdc0c0db8"> 1623</a></span>&#160;<span class="stringliteral">    public function content_filter($in_the_content)   ///&lt; The content in need of filtering.</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="stringliteral">        $old_content = $in_the_content; // We check to see if we added anything.</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="stringliteral">        // Simple searches can be mixed in with other content.</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="stringliteral">        $in_the_content = $this-&gt;display_table_search($in_the_content);</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="stringliteral">        $options = $this-&gt;getBMLTOptions_by_id($this-&gt;my_http_vars[&#39;</span>bmlt_settings_id<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="stringliteral">        if (file_exists(dirname(__FILE__).&#39;</span>/themes/<span class="stringliteral">&#39;.$options[&#39;</span>theme<span class="stringliteral">&#39;].&#39;</span>/styles.css<span class="stringliteral">&#39;) &amp;&amp; file_exists(dirname(__FILE__).&#39;</span>/themes/<span class="stringliteral">&#39;.$options[&#39;</span>theme<span class="stringliteral">&#39;].&#39;</span>/nouveau_map_styles.css<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="stringliteral">            $in_the_content = $this-&gt;display_simple_search($in_the_content);</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="stringliteral">            $in_the_content = $this-&gt;display_changes($in_the_content);</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="stringliteral">            $in_the_content = $this-&gt;display_new_map_search($in_the_content);</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="stringliteral">            $in_the_content = $this-&gt;display_bmlt_nouveau($in_the_content);</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="stringliteral">            $in_the_content = $this-&gt;display_quicksearch($in_the_content);</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="stringliteral">        // This simply ensures that we remove any unused mobile shortcodes.</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="stringliteral">        $in_the_content = self::replace_shortcode($in_the_content, &#39;</span>bmlt_mobile<span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="stringliteral">        if ($in_the_content != $old_content) {  // If we made changes, we add a wrapper element, so we can have some strong specificity.</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="stringliteral">            $in_the_content = &quot;&lt;div id=\&quot;bmlt_page_items\&quot; class=\&quot;bmlt_page_items\&quot;&gt;$in_the_content&lt;/div&gt;&quot;;</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="stringliteral">        return $in_the_content;</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="stringliteral">    *   \brief This is a function that filters the content, and replaces a portion with the *</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="stringliteral">    *   &quot;quick&quot; search.                                                                     *</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="stringliteral">    *   \returns a string, containing the content.                                          *</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a30731614b831f7dbac4e66f0b714c1cd"> 1660</a></span>&#160;<span class="stringliteral">    public function display_quicksearch($in_content)     ///&lt; This is the content to be filtered.</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="stringliteral">        $my_form_next_id = 0;</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="stringliteral">        while ($params = self::get_shortcode($in_content, &#39;</span>bmlt_quicksearch<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="stringliteral">            $options_id = $this-&gt;cms_get_page_settings_id($in_content);</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="stringliteral">            $display = &#39;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="stringliteral">            if ($params !== true) {</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="stringliteral">                $param_array = explode(&#39;</span>##-##<span class="stringliteral">&#39;, $params);    // You can specify a settings ID, by separating it from the URI parameters with a ##-##.</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="stringliteral">                $params = null;</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="stringliteral">            if (($params === true) || is_array($param_array)) {</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="stringliteral">                if ($params === true) {</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="stringliteral">                    $params = null;</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="stringliteral">                } else {</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="stringliteral">                    $params = str_replace(array ( &#39;</span>&amp;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;amp;<span class="stringliteral">&#39; ), &#39;</span>&amp;<span class="stringliteral">&#39;, $param_array[count($param_array)-1]);</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="stringliteral">                // See if there is an options ID in the parameter list.</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="stringliteral">                if (isset($param_array) &amp;&amp; ((is_array($param_array) &amp;&amp; (count($param_array) &gt; 1)) || (intval($param_array[0]) &amp;&amp; preg_match(&#39;</span>/^\d+$/<span class="stringliteral">&#39;, $param_array[0])))) {</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="stringliteral">                    $options_id = intval($param_array[0]);</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="stringliteral">                    if (count($param_array) == 1) {</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="stringliteral">                        $params = null;</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="stringliteral">                $options = $this-&gt;getBMLTOptions_by_id($options_id);</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="stringliteral">                $this-&gt;adapt_to_lang($options[&#39;</span>lang<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="stringliteral">                $theme = $options[&#39;</span>theme<span class="stringliteral">&#39;];</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;noscript <span class="keyword">class</span>=<span class="stringliteral">&quot;no_js&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noscript).&#39;</span>&lt;/noscript&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="stringliteral">                $url = $this-&gt;get_plugin_path();</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="stringliteral">                $ajax_url = $this-&gt;get_ajax_base_uri();</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="stringliteral">                $throbber_loc = htmlspecialchars($url.&#39;</span>themes/<span class="stringliteral">&#39;.$theme.&#39;</span>/images/Throbber.gif<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_div_&#39;.$my_form_next_id.&#39;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_div quicksearch_theme_&#39;.$theme.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;<span class="stringliteral">&#39; . &quot;\n&quot;;</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_print_header&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_print_header_&#39;.$my_form_next_id.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_throbber_div&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_throbber_div_&#39;.$my_form_next_id.&#39;&quot;</span>&gt;&lt;img src=<span class="stringliteral">&quot;&#39;.htmlspecialchars($throbber_loc).&#39;&quot;</span> alt=<span class="stringliteral">&quot;AJAX Throbber&quot;</span> /&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_container&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_container_&#39;.$my_form_next_id.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;<span class="stringliteral">&#39; . &quot;\n&quot;;</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_select_container&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_select_container_&#39;.$my_form_next_id.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;<span class="stringliteral">&#39; . &quot;\n&quot;;</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="stringliteral">                            $display .= &#39;</span>&lt;select <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_town_select_&#39;.$my_form_next_id.&#39;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_town_select&quot;</span>&gt;<span class="stringliteral">&#39; . &quot;\n&quot;;</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="stringliteral">                                $display .= &#39;</span>&lt;option value=<span class="stringliteral">&quot;&quot;</span> selected=<span class="stringliteral">&quot;selected&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;my_current_language-&gt;local_quicksearch_select_option_0.&#39;</span>&lt;/select&gt;<span class="stringliteral">&#39; . &quot;\n&quot;;</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="stringliteral">                            $display .= &quot;&lt;/select&gt;\n&quot;;</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="stringliteral">                        $display .= &quot;&lt;/div&gt;\n&quot;;</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_weekdays_container&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_weekdays_container_&#39;.$my_form_next_id.&#39;&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="stringliteral">                            $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_weekday_container quicksearch_form_weekday_container_0&quot;</span>&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="stringliteral">                                $display .= &#39;</span>&lt;input type=<span class="stringliteral">&quot;checkbox&quot;</span> checked=<span class="stringliteral">&quot;checked&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_weekday_checkbox_&#39;.$my_form_next_id.&#39;_0&quot;</span> value=<span class="stringliteral">&quot;0&quot;</span> onchange=<span class="stringliteral">&quot;bmlt_quicksearch_form_&#39;.$my_form_next_id.&#39;.reactToWeekdayCheckboxChange(this)&quot;</span> /&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="stringliteral">                                $display .= &#39;</span>&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;quicksearch_form_weekday_checkbox_&#39;.$my_form_next_id.&#39;_0&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_all_weekdays).&quot;&lt;/label&gt;\n&quot;;</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="stringliteral">                            $display .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="stringliteral">                for ($index = 1; $index &lt; 8; $index++) {</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="stringliteral">                    $weekday_index = $index + intval($options[&#39;</span>startWeekday<span class="stringliteral">&#39;]) - 1;</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="stringliteral">                    if ($weekday_index &gt; 7) {</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="stringliteral">                        $weekday_index = 1;</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="stringliteral">                                </span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="stringliteral">                    $weekdayName = $this-&gt;my_current_language-&gt;local_weekdays_short[$weekday_index];</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="stringliteral">                                </span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_weekday_container quicksearch_form_weekday_container_&#39;.$weekday_index.&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;input type=<span class="stringliteral">&quot;checkbox&quot;</span> checked=<span class="stringliteral">&quot;checked&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_weekday_checkbox_&#39;.$my_form_next_id.&#39;_&#39;.$weekday_index.&#39;&quot;</span> value=<span class="stringliteral">&quot;&#39;.$weekday_index.&#39;&quot;</span> /&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;quicksearch_form_weekday_checkbox_&#39;.$weekday_index.&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($weekdayName).&quot;&lt;/label&gt;\n&quot;;</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;div style=<span class="stringliteral">&quot;clear:both&quot;</span>&gt;&lt;/div&gt;&lt;/div&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_text_container quicksearch_form_text_container_0&quot;</span>&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="stringliteral">                            $display .= &#39;</span>&lt;input type=<span class="stringliteral">&quot;text&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_search_text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_search_text_&#39;.$my_form_next_id.&#39;&quot;</span> placeholder=<span class="stringliteral">&quot;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_text_item_default_text).&#39;&quot;</span> /&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;input type=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_form_submit_button&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_form_submit_button_&#39;.$my_form_next_id.&#39;&quot;</span> value=<span class="stringliteral">&quot;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_text_go_button).&#39;&quot;</span> /&gt;<span class="stringliteral">&#39;.&quot;\n&quot;;</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39; . &quot;\n&quot;;</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_results_container&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_results_container_&#39;.$my_form_next_id.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_too_large_div&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_too_large_div_&#39;.$my_form_next_id.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_quicksearch_display_too_large).&#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_no_results_div&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_no_results_div_&#39;.$my_form_next_id.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_cant_find_meetings_display).&#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;quicksearch_search_results_div&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;quicksearch_search_results_div_&#39;.$my_form_next_id.&#39;&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="stringliteral">                    $display .= &quot;&lt;/div&gt;\n&quot;;</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="stringliteral">                    $display .= &quot;&lt;script type=\&quot;text/javascript\&quot;&gt;\n&quot;;</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="stringliteral">                        $field_key = &#39;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="stringliteral">                if ($params) {</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="stringliteral">                    if ((&#39;</span>location_province<span class="stringliteral">&#39; == $params)</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="stringliteral">                        ||  (&#39;</span>location_postal_code_1<span class="stringliteral">&#39; == $params)</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="stringliteral">                        ||  (&#39;</span>location_sub_province<span class="stringliteral">&#39; == $params)</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="stringliteral">                        ||  (&#39;</span>location_municipality<span class="stringliteral">&#39; == $params)</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="stringliteral">                        ||  (&#39;</span>location_city_subsection<span class="stringliteral">&#39; == $params)</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="stringliteral">                        ||  (&#39;</span>location_nation<span class="stringliteral">&#39; == $params)</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="stringliteral">                        ||  (&#39;</span>location_neighborhood<span class="stringliteral">&#39; == $params)) {</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="stringliteral">                        $field_key = $params;</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="stringliteral">                        $params = &#39;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="stringliteral">                    } else {</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="stringliteral">                        $pArray = explode(&#39;</span>=<span class="stringliteral">&#39;, $params);</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="stringliteral">                        if (1 &lt; count($pArray)) {</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="stringliteral">                            $field_key = $pArray[0];</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="stringliteral">                            if (!((&#39;</span>location_province<span class="stringliteral">&#39; == $field_key)</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="stringliteral">                                ||  (&#39;</span>location_postal_code_1<span class="stringliteral">&#39; == $field_key)</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="stringliteral">                                ||  (&#39;</span>location_sub_province<span class="stringliteral">&#39; == $field_key)</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="stringliteral">                                ||  (&#39;</span>location_municipality<span class="stringliteral">&#39; == $field_key)</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="stringliteral">                                ||  (&#39;</span>location_city_subsection<span class="stringliteral">&#39; == $field_key)</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="stringliteral">                                ||  (&#39;</span>location_nation<span class="stringliteral">&#39; == $field_key)</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="stringliteral">                                ||  (&#39;</span>location_neighborhood<span class="stringliteral">&#39; == $field_key))) {</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="stringliteral">                                $field_key = &#39;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="stringliteral">                            }</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="stringliteral">                            $params = $pArray[1];</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="stringliteral">                        $display .= &quot;var bmlt_quicksearch_form_$my_form_next_id = new BMLTQuickSearch ( $my_form_next_id, &#39;</span>$ajax_url<span class="stringliteral">&#39;, &#39;</span>$options_id<span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="stringliteral">                        $display .= &quot;, &#39;</span>$field_key<span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="stringliteral">                if ($params) {</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="stringliteral">                    $pArray = explode(&#39;</span>,<span class="stringliteral">&#39;, $params);</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="stringliteral">                    $pString = implode(&#39;</span><span class="stringliteral">&quot;,&quot;</span><span class="stringliteral">&#39;, array_map(&quot;strtolower&quot;, $pArray));</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>, [<span class="stringliteral">&quot;&#39;.$pString.&#39;&quot;</span>]<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="stringliteral">                } else {</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="stringliteral">                    $display .= &#39;</span>, []<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>, [<span class="stringliteral">&#39;.$this-&gt;my_current_language-&gt;local_table_ante_meridian.&#39;</span>]<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="stringliteral">                        $display .= &quot;, &#39;</span><span class="stringliteral">&quot;.htmlspecialchars($this-&gt;my_current_language-&gt;local_nouveau_meeting_details_map_link_uri_format).&quot;</span><span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="stringliteral">                        $display .= &quot;, [&#39;</span><span class="stringliteral">&quot;.join(&quot;</span><span class="charliteral">&#39;,&#39;</span><span class="stringliteral">&quot;, $this-&gt;my_current_language-&gt;local_nouveau_weekday_long_array).&quot;</span><span class="stringliteral">&#39;]&quot;;</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>, <span class="stringliteral">&#39;.strval(intval($options[&#39;</span>startWeekday<span class="stringliteral">&#39;]));</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>, <span class="stringliteral">&#39;.($options[&#39;</span>military_time<span class="stringliteral">&#39;] ? &#39;</span><span class="keyword">true</span><span class="stringliteral">&#39; : &#39;</span><span class="keyword">false</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="stringliteral">                        $display .= &quot; );\n&quot;;</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="stringliteral">                    $display .= &quot;&lt;/script&gt;\n&quot;;</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="stringliteral">                $display .= &quot;&lt;/div&gt;\n&quot;;</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="stringliteral">                $my_form_next_id++;</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="stringliteral">            // This simply ensures that we remove any unused mobile shortcodes.</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="stringliteral">            $in_content = self::replace_shortcode($in_content, &#39;</span>bmlt_quicksearch<span class="stringliteral">&#39;, $display);</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="stringliteral">        return $in_content;</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="stringliteral">    *   \brief This is a function that filters the content, and replaces a portion with the *</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="stringliteral">    *   &quot;popup&quot; search, if provided by the &#39;</span>bmlt_simple_searches<span class="stringliteral">&#39; custom field.             *</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="stringliteral">    *   \returns a string, containing the content.                                          *</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#aed313158db96eef2e63ab32cd6e2ce82"> 1803</a></span>&#160;<span class="stringliteral">    public function display_popup_search(</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="stringliteral">        $in_content,    ///&lt; This is the content to be filtered.</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="stringliteral">        $in_text,       ///&lt; The text that has the parameters in it.</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="stringliteral">        &amp;$out_count     ///&lt; This is set to 1, if a substitution was made.</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="stringliteral">    ) {</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="stringliteral">        $options_id = $this-&gt;cms_get_page_settings_id($in_content);</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="stringliteral">        $params = self::get_shortcode($in_content, &#39;</span>simple_search_list<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="stringliteral">        if ($in_text &amp;&amp; $params) {</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="stringliteral">            $temp_id = $this-&gt;cms_get_page_settings_id($in_content);</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="stringliteral">            if ($temp_id) {</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="stringliteral">                $options_id = $temp_id;</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="stringliteral">            if ($params !== true &amp;&amp; intval($params)) {</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="stringliteral">                $options_id = intval($params);</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="stringliteral">            if ($options_id) {</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="stringliteral">                $options = $this-&gt;getBMLTOptions_by_id($options_id);</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="stringliteral">                $this-&gt;adapt_to_lang($options[&#39;</span>lang<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="stringliteral">            $display .= &#39;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="stringliteral">            $text_ar = explode(&quot;\n&quot;, $in_text);</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="stringliteral">            if (is_array($text_ar) &amp;&amp; count($text_ar)) {</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;noscript <span class="keyword">class</span>=<span class="stringliteral">&quot;no_js&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noscript).&#39;</span>&lt;/noscript&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&quot;interactive_form_div&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;interactive_form_div&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;&lt;form action=<span class="stringliteral">&quot;#&quot;</span> onsubmit=<span class="stringliteral">&quot;return false&quot;</span>&gt;&lt;div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;label <span class="keyword">class</span>=<span class="stringliteral">&quot;meeting_search_select_label&quot;</span> <span class="keywordflow">for</span>=<span class="stringliteral">&quot;meeting_search_select&quot;</span>&gt;Find Meetings:&lt;/label&gt; <span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;select <span class="keywordtype">id</span>=<span class="stringliteral">&quot;meeting_search_select&quot;</span><span class="keyword">class</span>=<span class="stringliteral">&quot;simple_search_list&quot;</span> onchange=<span class="stringliteral">&quot;BMLTPlugin_simple_div_filler (this.value,this.options[this.selectedIndex].text);this.options[this.options.length-1].disabled=(this.selectedIndex==0)&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;option disabled=<span class="stringliteral">&quot;disabled&quot;</span> selected=<span class="stringliteral">&quot;selected&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_select_search).&#39;</span>&lt;/option&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="stringliteral">                $lines_max = count($text_ar);</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="stringliteral">                $lines = 0;</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="stringliteral">                while ($lines &lt; $lines_max) {</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="stringliteral">                    $line[&#39;</span>parameters<span class="stringliteral">&#39;] = trim($text_ar[$lines++]);</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="stringliteral">                    $line[&#39;</span>prompt<span class="stringliteral">&#39;] = trim($text_ar[$lines++]);</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="stringliteral">                    if ($line[&#39;</span>parameters<span class="stringliteral">&#39;] &amp;&amp; $line[&#39;</span>prompt<span class="stringliteral">&#39;]) {</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="stringliteral">                        $uri = $this-&gt;get_ajax_base_uri().&#39;</span>?bmlt_settings_id=<span class="stringliteral">&#39;.$options_id.&#39;</span>&amp;amp;direct_simple&amp;amp;search_parameters=<span class="stringliteral">&#39;.urlencode($line[&#39;</span>parameters<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="stringliteral">                        $display .= &#39;</span>&lt;option value=<span class="stringliteral">&quot;&#39;.$uri.&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.__($line[&#39;</span>prompt<span class="stringliteral">&#39;]).&#39;</span>&lt;/option&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;option disabled=<span class="stringliteral">&quot;disabled&quot;</span>&gt;&lt;/option&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;option disabled=<span class="stringliteral">&quot;disabled&quot;</span> value=<span class="stringliteral">&quot;&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_clear_search).&#39;</span>&lt;/option&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;/select&gt;&lt;/div&gt;&lt;/form&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="stringliteral">                $display .= &#39;</span>&lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="stringliteral">                $display .= &#39;</span>document.getElementById(\<span class="stringliteral">&#39;interactive_form_div\&#39;).style.display=\&#39;block\&#39;;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                $display .= <span class="stringliteral">&#39;document.getElementById(\&#39;meeting_search_select\&#39;).selectedIndex=0;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                $url = $this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4005e57d7b24559e6731ed4108cfff46">get_plugin_path</a>();</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                $img_url .= htmlspecialchars($url.<span class="stringliteral">&#39;themes/&#39;</span>.$options[<span class="stringliteral">&#39;theme&#39;</span>].<span class="stringliteral">&#39;/images/&#39;</span>);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                $display .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_images = &#39;$img_url&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                $display .= <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                $display .= <span class="stringliteral">&#39;&lt;div id=&quot;simple_search_container&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;            }</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            <span class="keywordflow">if</span> ($display) {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                $in_content = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#af960dde870b3ff53e61d8e73c24deece">self::replace_shortcode</a>($in_content, <span class="stringliteral">&#39;simple_search_list&#39;</span>, $display);</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;            </div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                $out_count = 1;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            }</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        }</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        </div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        <span class="keywordflow">return</span> $in_content;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    }</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        </div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">    *   \brief This function implements the new, Maps API V. 3 version of the &quot;classic&quot;     *</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">    *          BMLT search screen.                                                          *</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">    *   \returns a string, containing the content.                                          *</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#aeea1af5c85fa2cadd17c6eda69c1bd97"> 1879</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aeea1af5c85fa2cadd17c6eda69c1bd97">display_bmlt_nouveau</a>($in_content)      <span class="comment">///&lt; This is the content to be filtered.</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        $theshortcode = <span class="stringliteral">&#39;bmlt&#39;</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        </div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        $options_id = $this-&gt;cms_get_page_settings_id($in_content);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160; </div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        $in_content = str_replace(array ( <span class="stringliteral">&#39;&amp;#038;&#39;</span>, <span class="stringliteral">&#39;&amp;#038;#038;&#39;</span>, <span class="stringliteral">&#39;&amp;#038;amp;&#39;</span>, <span class="stringliteral">&#39;&amp;amp;#038;&#39;</span>, <span class="stringliteral">&#39;&amp;amp;&#39;</span>, <span class="stringliteral">&#39;&amp;amp;amp;&#39;</span> ), <span class="charliteral">&#39;&amp;&#39;</span>, $in_content);   <span class="comment">// This stupid kludge is because WordPress does an untoward substitution. Won&#39;t do anything unless WordPress has been naughty.</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        </div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        $first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160; </div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="keywordflow">while</span> ($params = self::get_shortcode($in_content, $theshortcode)) {</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            <span class="keywordflow">if</span> ($params !== <span class="keyword">true</span> &amp;&amp; intval($params)) {</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                $options_id = intval($params);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            }</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        </div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;            $options = $this-&gt;getBMLTOptions_by_id($options_id);</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160; </div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            $uid = htmlspecialchars(<span class="stringliteral">&#39;bmlt_nouveau_&#39;</span>.uniqid());</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;            $the_new_content = <span class="stringliteral">&#39;&lt;noscript&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noscript).<span class="stringliteral">&#39;&lt;/noscript&gt;&#39;</span>;    <span class="comment">// We let non-JS browsers know that this won&#39;t work for them.</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;            <span class="keywordflow">if</span> ($first) {   <span class="comment">// We only load this the first time.</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                <span class="comment">// These are the basic global JavaScript properties.</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                $the_new_content .= $this-&gt;BMLTPlugin_nouveau_map_search_global_javascript_stuff($options_id);</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                <span class="comment">// Most of the display is built in DOM, but this is how we get our localized strings into JS. We put them in globals.</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_NouveauMapSearch_advanced_name_string =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_NouveauMapSearch_map_name_string =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_map_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_NouveauMapSearch_text_name_string =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_text_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_text_go_button_string =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_text_go_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_text_location_label_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_text_location_label_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_text_item_default_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_text_item_default_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_weekdays_disclosure_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_weekdays_disclosure_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_formats_disclosure_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_formats_disclosure_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_service_bodies_disclosure_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_service_bodies_disclosure_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_no_search_results_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_cant_find_meetings_display).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_cant_lookup_display =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_cant_lookup_display).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_select_search_spec_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_select_search_spec_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_select_search_results_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_select_search_results_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_display_map_results_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_display_map_results_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_display_list_results_text =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_display_list_results_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;            </div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_services_set_my_location_advanced_button =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_location_services_set_my_location_advanced_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_services_find_all_meetings_nearby_button =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_location_services_find_all_meetings_nearby_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_services_find_all_meetings_nearby_later_today_button =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_location_services_find_all_meetings_nearby_later_today_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_services_find_all_meetings_nearby_tomorrow_button =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_location_services_find_all_meetings_nearby_tomorrow_button).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160; </div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_meeting_results_count_sprintf_format =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_meeting_results_count_sprintf_format.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_meeting_results_selection_count_sprintf_format =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_meeting_results_selection_count_sprintf_format.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_meeting_results_single_selection_count_sprintf_format =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_meeting_results_single_selection_count_sprintf_format.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_time_sprintf_format =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_single_time_sprintf_format.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;            </div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_loc_street_info = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_loc_street_info.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_loc_street = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_loc_street.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_street_info = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_street_info.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_loc_info = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_loc_info.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_street = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_street.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_loc = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_loc.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160; </div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_info_town_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_info_town_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_town_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_town_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_info_town_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_info_town_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_info_town_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_info_town_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_town_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_town_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_town_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_town_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160; </div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_info_town_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_info_town_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_town_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_town_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_info_town_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_info_town_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_info_town_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_info_town_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_town_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_town_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_town_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_town_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160; </div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_info_town_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_info_town_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_town_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_town_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_info_town_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_info_town_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_info_town_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_info_town_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_town_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_town_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_town_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_town_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160; </div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_info_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_info_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_info_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_info_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_info_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_info_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_province_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_province_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160; </div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_info_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_info_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_info_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_info_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_info_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_info_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_province = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_province.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160; </div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_info_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_info_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_info_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_info_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_info_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_info_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_zip = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_zip.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160; </div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street_info = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street_info.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_street = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_street.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street_info = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street_info.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc_info = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc_info.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_street = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_street.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_single_loc = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_single_loc.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160; </div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_wtf =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_wtf).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160; </div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_time_sprintf_format = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_time_sprintf_format.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_am =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_am).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_pm =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_pm).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_noon =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_noon).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_midnight =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_midnight).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_map_radius_label_1 =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_map_radius_label_1).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_map_radius_label_2 =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_map_radius_label_2).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_map_radius_value_2_km =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_map_radius_value_km).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_map_radius_value_2_mi =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_map_radius_value_mi).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_map_radius_value_auto =&#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_advanced_map_radius_value_auto).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_advanced_map_radius_value_array = [ &quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_advanced_map_radius_value_array.<span class="stringliteral">&quot; ];&quot;</span>;</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_meeting_details_link_title = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_meeting_details_link_title).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_meeting_details_map_link_uri_format = &#39;&quot;</span>.htmlspecialchars($this-&gt;my_current_language-&gt;local_nouveau_meeting_details_map_link_uri_format).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_meeting_details_map_link_text = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_meeting_details_map_link_text).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_array_keys = {&quot;</span>;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                    $first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                <span class="keywordflow">foreach</span> ($this-&gt;my_current_language-&gt;local_nouveau_prompt_array as $key =&gt; $value) {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                    <span class="keywordflow">if</span> (!$first) {</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                        $the_new_content .= <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                    }</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                    $first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                    $the_new_content .= <span class="charliteral">&#39;&quot;&#39;</span>.$key.<span class="stringliteral">&#39;&quot;:&#39;</span>;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                    $the_new_content .= <span class="charliteral">&#39;&quot;&#39;</span>.$this-&gt;process_text($value).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                }</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;};&quot;</span>;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;var g_Nouveau_military_time = &#39;</span>.((isset($options[<span class="stringliteral">&#39;military_time&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;military_time&#39;</span>]) ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span> ).<span class="charliteral">&#39;;&#39;</span>;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;var g_Nouveau_start_week = &#39;</span>.((isset($options[<span class="stringliteral">&#39;startWeekday&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;startWeekday&#39;</span>]) ? $options[<span class="stringliteral">&#39;startWeekday&#39;</span>] : self::$default_startWeekday ).<span class="charliteral">&#39;;&#39;</span>;</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;var g_Nouveau_array_header_text = new Array ( &quot;&#39;</span>.join(<span class="stringliteral">&#39;&quot;,&quot;&#39;</span>, $this-&gt;my_current_language-&gt;local_nouveau_table_header_array).<span class="stringliteral">&#39;&quot;);&#39;</span>;</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;var g_Nouveau_weekday_long_array = new Array ( &quot;&#39;</span>.join(<span class="stringliteral">&#39;&quot;,&quot;&#39;</span>, $this-&gt;my_current_language-&gt;local_nouveau_weekday_long_array).<span class="stringliteral">&#39;&quot;);&#39;</span>;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;var g_Nouveau_weekday_short_array = new Array ( &quot;&#39;</span>.join(<span class="stringliteral">&#39;&quot;,&quot;&#39;</span>, $this-&gt;my_current_language-&gt;local_nouveau_weekday_short_array).<span class="stringliteral">&#39;&quot;);&#39;</span>;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_lookup_location_failed = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_lookup_location_failed).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_lookup_location_server_error = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_lookup_location_server_error).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_default_geo_width = &quot;</span>.$options[<span class="stringliteral">&#39;default_geo_width&#39;</span>].<span class="stringliteral">&quot;;&quot;</span>;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_default_details_map_zoom = &quot;</span>.self::$default_details_map_zoom.<span class="charliteral">&#39;;&#39;</span>;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_default_marker_aggregation_threshold_in_pixels = 8;&quot;</span>;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160; </div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_formats_label = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_single_formats_label).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_service_body_label = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_nouveau_single_service_body_label).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                </div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_user_logged_in = &#39;&quot;</span>.((isset($this-&gt;m_is_logged_in_user) &amp;&amp; $this-&gt;m_is_logged_in_user) ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span> ).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_default_duration = &#39;&quot;</span>.self::$default_duration.<span class="stringliteral">&quot;&#39;;&quot;</span>;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_duration_title = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_duration_title.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_duration_hour_only_title = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_duration_hour_only_title.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_duration_hour_only_and_minutes_title = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_duration_hour_only_and_minutes_title.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_location_sprintf_format_duration_hours_only_title = &#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_location_sprintf_format_duration_hours_only_title.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_duration_sprintf_format_1_hr =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_single_duration_sprintf_format_1_hr.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_duration_sprintf_format_mins =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_single_duration_sprintf_format_mins.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_duration_sprintf_format_hrs =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_single_duration_sprintf_format_hrs.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_duration_sprintf_format_hr_mins =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_single_duration_sprintf_format_hr_mins.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;var g_Nouveau_single_duration_sprintf_format_hrs_mins =&#39;&quot;</span>.$this-&gt;my_current_language-&gt;local_nouveau_single_duration_sprintf_format_hrs_mins.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                </div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                $first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            }</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        </div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;            $in_options_id = $options[<span class="stringliteral">&#39;id&#39;</span>];</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        </div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;            <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>)) {</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// These just make the code easier to look at.</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            }</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            <span class="comment">// This is the overall container div.</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;            $the_new_content .= <span class="stringliteral">&#39;&lt;div id=&quot;&#39;</span>.$uid.<span class="stringliteral">&#39;_container&quot; class=&quot;bmlt_nouveau_container&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                $single_meeting_id = isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;single_meeting_id&#39;</span>]) ? intval($this-&gt;my_http_vars[<span class="stringliteral">&#39;single_meeting_id&#39;</span>]) : 0;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                <span class="comment">// What we do here, is tell the client to create a global variable (in JS DOM), with a unique handler for this instance of the Nouveau search.</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;var g_instance_&#39;</span>.$uid.<span class="stringliteral">&#39;_js_handler = new NouveauMapSearch ( \&#39;&#39;</span>.$uid.<span class="charliteral">&#39;\&#39;</span>, \<span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                                                                                                                                                                            .$options[<span class="stringliteral">&#39;bmlt_initial_view&#39;</span>].<span class="charliteral">&#39;\&#39;</span>,<span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="stringliteral">                                                                                                                                                                            .$options[&#39;</span>map_center_latitude<span class="stringliteral">&#39;].&quot;,&quot;</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="stringliteral">                                                                                                                                                                            .$options[&#39;</span>map_center_longitude<span class="stringliteral">&#39;].&quot;,&quot;</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="stringliteral">                                                                                                                                                                            .$options[&#39;</span>map_zoom<span class="stringliteral">&#39;].&quot;,&#39;</span><span class="stringliteral">&quot;</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="stringliteral">                                                                                                                                                                            .$options[&#39;distance_units&#39;].&quot;</span><span class="charliteral">&#39;,&#39;</span><span class="stringliteral">&quot;</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="stringliteral">                                                                                                                                                                            .$this-&gt;get_plugin_path().&quot;</span>themes/<span class="stringliteral">&quot;.$options[&#39;theme&#39;].&quot;</span><span class="charliteral">&#39;,&#39;</span><span class="stringliteral">&quot;</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="stringliteral">                                                                                                                                                                            .htmlspecialchars($this-&gt;get_ajax_base_uri()).&quot;</span>?bmlt_settings_id=$in_options_id&amp;redirect_ajax_json=<span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, &quot;.($options[&#39;</span>bmlt_location_checked<span class="stringliteral">&#39;] ? &#39;</span><span class="keyword">true</span><span class="stringliteral">&#39; : &#39;</span><span class="keyword">false</span><span class="stringliteral">&#39;).&quot;, &quot;</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="stringliteral">                                                                                                                                                                            .($options[&#39;</span>bmlt_location_services<span class="stringliteral">&#39;] == 0 || ($options[&#39;</span>bmlt_location_services<span class="stringliteral">&#39;] == 1 &amp;&amp; BMLTPlugin_weAreMobile($this-&gt;my_http_vars)) ? &#39;</span><span class="keyword">true</span><span class="stringliteral">&#39; : &#39;</span><span class="keyword">false</span><span class="stringliteral">&#39;).&quot;, &quot;</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="stringliteral">                                                                                                                                                                            .$single_meeting_id.&quot;, &quot;</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="stringliteral">                                                                                                                                                                            .$options[&#39;</span>grace_period<span class="stringliteral">&#39;].&quot;);&quot; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;).&quot;&lt;/script&gt;&quot;;</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="stringliteral">            $the_new_content .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="stringliteral">            $in_content = self::replace_shortcode($in_content, $theshortcode, $the_new_content);</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="stringliteral">        return $in_content;</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="stringliteral">    *   \brief This is a function that filters the content, and replaces a portion with the *</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="stringliteral">    *   &quot;simple&quot; search                                                                     *</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="stringliteral">    *   \returns a string, containing the content.                                          *</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc0421fc577d2bde5c912cb58b860b38"> 2081</a></span>&#160;<span class="stringliteral">    public function display_simple_search($in_content)      ///&lt; This is the content to be filtered.</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="stringliteral">        $options_id = $this-&gt;cms_get_page_settings_id($in_content);</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="stringliteral">        if ($options_id) {</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="stringliteral">            $options = $this-&gt;getBMLTOptions_by_id($options_id);</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="stringliteral">            $this-&gt;adapt_to_lang($options[&#39;</span>lang<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="stringliteral">            $root_server_root = $options[&#39;</span>root_server<span class="stringliteral">&#39;];</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="stringliteral">        if ($root_server_root) {</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="stringliteral">            while ($params = self::get_shortcode($in_content, &#39;</span>bmlt_simple<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="stringliteral">                $param_array = explode(&#39;</span>##-##<span class="stringliteral">&#39;, $params);    // You can specify a settings ID, by separating it from the URI parameters with a ##-##.</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="stringliteral">                $params = null;</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="stringliteral">                if (is_array($param_array) &amp;&amp; (count($param_array) &gt; 1)) {</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="stringliteral">                    $options = $this-&gt;getBMLTOptions_by_id($param_array[0]);</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="stringliteral">                    $this-&gt;adapt_to_lang($options[&#39;</span>lang<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="stringliteral">                    $root_server_root = $options[&#39;</span>root_server<span class="stringliteral">&#39;];</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="stringliteral">                $params = (count($param_array) &gt; 0) ? &#39;</span>?<span class="stringliteral">&#39;.str_replace(array ( &#39;</span>&amp;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;amp;<span class="stringliteral">&#39; ), &#39;</span>&amp;<span class="stringliteral">&#39;, $param_array[count($param_array)-1]) : null;</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="stringliteral">                $uri = $root_server_root.&quot;/client_interface/simple/index.php&quot;.$params;</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="stringliteral">                $the_new_content = bmlt_satellite_controller::call_curl($uri);</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="stringliteral">                $in_content = self::replace_shortcode($in_content, &#39;</span>bmlt_simple<span class="stringliteral">&#39;, $the_new_content);</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="stringliteral">        return $in_content;</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="stringliteral">    *   \brief This is a function that filters the content, and replaces a portion with the *</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="stringliteral">    *   new &quot;table&quot; search                                                                  *</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="stringliteral">    *   \returns a string, containing the content.                                          *</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2021ca3bd349b7ff94277ecb51e2ee1d"> 2123</a></span>&#160;<span class="stringliteral">    public function display_table_search($in_content)      ///&lt; This is the content to be filtered.</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="stringliteral">        $my_table_next_id = 0;</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="stringliteral">        while ($params = self::get_shortcode($in_content, &#39;</span>bmlt_table<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="stringliteral">            $options_id = $this-&gt;cms_get_page_settings_id($in_content);</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="stringliteral">            if ($params !== true) {</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="stringliteral">                $param_array = explode(&#39;</span>##-##<span class="stringliteral">&#39;, $params);    // You can specify a settings ID, by separating it from the URI parameters with a ##-##.</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="stringliteral">                $params = null;</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="stringliteral">            if (($params === true) || is_array($param_array)) {</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="stringliteral">                if ($params === true) {</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="stringliteral">                    $params = null;</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="stringliteral">                } else {</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="stringliteral">                    $params = str_replace(array ( &#39;</span>&amp;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;#038;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;#038;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;<span class="stringliteral">&#39;, &#39;</span>&amp;amp;amp;<span class="stringliteral">&#39; ), &#39;</span>&amp;<span class="stringliteral">&#39;, $param_array[count($param_array)-1]);</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="stringliteral">                // See if there is an options ID in the parameter list.</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="stringliteral">                if ((is_array($param_array) &amp;&amp; (count($param_array) &gt; 1)) || (intval($param_array[0]) &amp;&amp; preg_match(&#39;</span>/^\d+$/<span class="stringliteral">&#39;, $param_array[0]))) {</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="stringliteral">                    $options_id = intval($param_array[0]);</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="stringliteral">                    if (count($param_array) == 1) {</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="stringliteral">                        $params = null;</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="stringliteral">                $options = $this-&gt;getBMLTOptions_by_id($options_id);</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="stringliteral">                $this-&gt;adapt_to_lang($options[&#39;</span>lang<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="stringliteral">                // This strips weekday selectors out. We will be dealing with this ourselves.</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="stringliteral">                $params = preg_replace(&#39;</span>|(\&amp;){0,1}weekdays(\[\]){0,1}=[0-9]{0,1}|<span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;, $params);</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="stringliteral">                // We ignore the block_mode and sort key selectors as well. We&#39;</span>ll be doing our own thing. It will be table-based, and sorted by time (to start).</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                $params = preg_replace(<span class="stringliteral">&#39;|(\&amp;){0,1}block_mode=[a-zA-Z0-9]{0,5}|&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $params);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                $params = preg_replace(<span class="stringliteral">&#39;|(\&amp;){0,1}sort_key=[a-zA-Z0-9]*?|&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $params);</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                $params = preg_replace(<span class="stringliteral">&#39;|(\&amp;){0,1}sort_dir=[a-zA-Z0-9]{0,4}|&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $params);</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                $params = preg_replace(<span class="stringliteral">&#39;|^[\&amp;\?]|&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $params);</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                $params = preg_replace(<span class="stringliteral">&#39;|[\&amp;\?]$|&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $params);</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                </div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                $the_new_content = <span class="stringliteral">&#39;&lt;noscript&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noscript).<span class="stringliteral">&#39;&lt;/noscript&gt;&#39;</span>;    <span class="comment">// We let non-JS browsers know that this won&#39;t work for them.</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                </div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                <span class="comment">// The first time through, we import our JS file. After that, we no longer need it.</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                <span class="keywordflow">if</span> (!$my_table_next_id) {</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                    $the_new_content .= self::stripFile(<span class="stringliteral">&#39;table_display.js&#39;</span>);</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                    $the_new_content .= <span class="stringliteral">&#39;var g_table_weekday_name_array = new Array ( &quot;&#39;</span>.join(<span class="stringliteral">&#39;&quot;,&quot;&#39;</span>, $this-&gt;my_current_language-&gt;local_nouveau_weekday_short_array).<span class="stringliteral">&#39;&quot; );&#39;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                    $the_new_content .= <span class="stringliteral">&#39;var g_table_weekday_long_name_array = new Array ( &quot;&#39;</span>.join(<span class="stringliteral">&#39;&quot;,&quot;&#39;</span>, $this-&gt;my_current_language-&gt;local_nouveau_weekday_long_array).<span class="stringliteral">&#39;&quot; );&#39;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_throbber_img_src = &#39;&quot;</span>.htmlspecialchars($this-&gt;get_plugin_path().<span class="stringliteral">&#39;themes/default/images/TableThrobber.gif&#39;</span>).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_time_header_text = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_table_header_time_label).<span class="stringliteral">&quot;&#39;;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_name_header_text = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_table_header_meeting_name_label).<span class="stringliteral">&quot;&#39;;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_town_header_text = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_table_header_town_label).<span class="stringliteral">&quot;&#39;;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_address_header_text = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_table_header_address_label).<span class="stringliteral">&quot;&#39;;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_format_header_text = &#39;&quot;</span>.htmlspecialchars($this-&gt;my_current_language-&gt;local_table_header_format_label).<span class="stringliteral">&quot;&#39;;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_header_tab_format = &#39;&quot;</span>.htmlspecialchars($this-&gt;my_current_language-&gt;local_table_header_tab_title_format).<span class="stringliteral">&quot;&#39;;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_header_tab_loading_format = &#39;&quot;</span>.htmlspecialchars($this-&gt;my_current_language-&gt;local_table_tab_loading_title_format).<span class="stringliteral">&quot;&#39;;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                    $the_new_content .= <span class="stringliteral">&#39;var g_table_ampm_array = new Array ( &#39;</span>.$this-&gt;my_current_language-&gt;local_table_ante_meridian.<span class="stringliteral">&#39; );&#39;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_map_link_uri_format = &#39;&quot;</span>.htmlspecialchars($this-&gt;my_current_language-&gt;local_nouveau_meeting_details_map_link_uri_format).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;var g_table_no_meetings_format = &#39;&quot;</span>.htmlspecialchars($this-&gt;my_current_language-&gt;local_table_no_meetings_format).(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;&#39;;\n&quot;</span> : <span class="stringliteral">&quot;&#39;;&quot;</span>);</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                    $the_new_content .= <span class="stringliteral">&quot;&lt;/script&gt;&quot;</span>;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                }</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                </div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                $my_table_next_id++;    <span class="comment">// We increment the ID, so we can have multiple tables on the same page. This also makes the IDs very predictable for fun CSS tricks.</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                </div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;div style=&quot;display_none&quot; class=&quot;bmlt_table_display_div bmlt_table_display_div_theme_&#39;</span>.htmlspecialchars($options[<span class="stringliteral">&#39;theme&#39;</span>]).<span class="stringliteral">&#39;&quot; id=&quot;bmlt_table_display_div_&#39;</span>.strval($my_table_next_id).<span class="stringliteral">&#39;&quot;&gt;&lt;/div&gt;&#39;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                $theWeekday = strval(intval($options[<span class="stringliteral">&#39;startWeekday&#39;</span>] - 1));</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                $the_new_content .= <span class="stringliteral">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;var bmlt_table_display_func_&quot;</span>.strval($my_table_next_id).<span class="stringliteral">&quot; = new TableSearchDisplay ( &#39;bmlt_table_display_div_&quot;</span>.strval($my_table_next_id).<span class="stringliteral">&quot;&#39;, &#39;$options_id&#39;, &#39;&quot;</span>.htmlspecialchars($options[<span class="stringliteral">&#39;theme&#39;</span>]).<span class="stringliteral">&quot;&#39;,&#39;&quot;</span>.htmlspecialchars($this-&gt;get_ajax_base_uri()).<span class="stringliteral">&quot;?redirect_ajax_json=&#39;, &#39;$theWeekday&#39;, &quot;</span>.($options[<span class="stringliteral">&#39;military_time&#39;</span>] ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span> ).<span class="stringliteral">&quot;, &#39;$params&#39; );&lt;/script&gt;&quot;</span>.(defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                </div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                $in_content = self::replace_shortcode($in_content, <span class="stringliteral">&#39;bmlt_table&#39;</span>, $the_new_content);</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;            }</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        }</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        </div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        <span class="keywordflow">return</span> $in_content;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    }</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="comment">    *   \brief This is a function that filters the content, and replaces a portion with the *</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="comment">    *   &quot;new map&quot; search                                                                    *</span></div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">    *   \returns a string, containing the content.                                          *</span></div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02203"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6b8584e1f426f88ac0a3a5eb56093c66"> 2203</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a6b8584e1f426f88ac0a3a5eb56093c66">display_new_map_search</a>($in_content)      <span class="comment">///&lt; This is the content to be filtered.</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        $options_id = $this-&gt;cms_get_page_settings_id($in_content);</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160; </div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        $in_content = str_replace(array ( <span class="stringliteral">&#39;&amp;#038;&#39;</span>, <span class="stringliteral">&#39;&amp;#038;#038;&#39;</span>, <span class="stringliteral">&#39;&amp;#038;amp;&#39;</span>, <span class="stringliteral">&#39;&amp;amp;#038;&#39;</span>, <span class="stringliteral">&#39;&amp;amp;&#39;</span>, <span class="stringliteral">&#39;&amp;amp;amp;&#39;</span> ), <span class="charliteral">&#39;&amp;&#39;</span>, $in_content);   <span class="comment">// This stupid kludge is because WordPress does an untoward substitution. Won&#39;t do anything unless WordPress has been naughty.</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        </div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        $first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160; </div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        <span class="keywordflow">while</span> ($params = self::get_shortcode($in_content, <span class="stringliteral">&#39;bmlt_map&#39;</span>)) {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;            <span class="keywordflow">if</span> ($params !== <span class="keyword">true</span> &amp;&amp; intval($params)) {</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                $options_id = intval($params);</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            }</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            </div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            $options = $this-&gt;getBMLTOptions_by_id($options_id);</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;            $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;            $uid = htmlspecialchars(<span class="stringliteral">&#39;BMLTuid_&#39;</span>.uniqid());</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;            </div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;            $the_new_content = <span class="stringliteral">&#39;&lt;noscript&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noscript).<span class="stringliteral">&#39;&lt;/noscript&gt;&#39;</span>;    <span class="comment">// We let non-JS browsers know that this won&#39;t work for them.</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            </div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;            <span class="keywordflow">if</span> ($first) {   <span class="comment">// We only load this the first time.</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                $the_new_content .= $this-&gt;BMLTPlugin_map_search_global_javascript_stuff($options_id);</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                $first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            }</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160; </div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;            $the_new_content .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div bmlt_map_container_div_theme_&#39;</span>.htmlspecialchars($options[<span class="stringliteral">&#39;theme&#39;</span>]).<span class="stringliteral">&#39;&quot; style=&quot;display:none&quot; id=&quot;&#39;</span>.$uid.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;  <span class="comment">// This starts off hidden, and is revealed by JS.</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_header&quot;&gt;&#39;</span>;  <span class="comment">// This allows a CSS &quot;hook.&quot;</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                    $the_new_content .= $this-&gt;BMLTPlugin_map_search_location_options($options_id, $uid);   <span class="comment">// This is the box of location search choices.</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                    $the_new_content .= $this-&gt;BMLTPlugin_map_search_search_options($options_id, $uid);     <span class="comment">// This is the box of basic search choices.</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                    $the_new_content .= $this-&gt;BMLTPlugin_map_search_local_javascript_stuff($options_id, $uid);</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_search_map_div&quot; id=&quot;&#39;</span>.$uid.<span class="stringliteral">&#39;_bmlt_search_map_div&quot;&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                $the_new_content .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;var g_military_time = &#39;</span>.($options[<span class="stringliteral">&#39;military_time&#39;</span>] ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span> ).<span class="stringliteral">&#39;;g_no_meetings_found=&quot;&#39;</span>.htmlspecialchars($this-&gt;my_current_language-&gt;local_cant_find_meetings_display).<span class="stringliteral">&#39;&quot;;document.getElementById(\&#39;&#39;</span>.$uid.<span class="charliteral">&#39;\&#39;</span>).style.display=\<span class="stringliteral">&#39;block\&#39;;c_ms_&#39;</span>.$uid.<span class="stringliteral">&#39; = new MapSearch ( \&#39;&#39;</span>.htmlspecialchars($uid).<span class="charliteral">&#39;\&#39;</span>,\<span class="stringliteral">&#39;&#39;</span>.htmlspecialchars($options_id).<span class="charliteral">&#39;\&#39;</span>, document.getElementById(\<span class="stringliteral">&#39;&#39;</span>.$uid.<span class="stringliteral">&#39;_bmlt_search_map_div\&#39;), {\&#39;latitude\&#39;:&#39;</span>.$options[<span class="stringliteral">&#39;map_center_latitude&#39;</span>].<span class="stringliteral">&#39;,\&#39;longitude\&#39;:&#39;</span>.$options[<span class="stringliteral">&#39;map_center_longitude&#39;</span>].<span class="stringliteral">&#39;,\&#39;zoom\&#39;:&#39;</span>.$options[<span class="stringliteral">&#39;map_zoom&#39;</span>].<span class="stringliteral">&#39;} );var g_Nouveau_start_week = &#39;</span>.((isset($options[<span class="stringliteral">&#39;startWeekday&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;startWeekday&#39;</span>]) ? $options[<span class="stringliteral">&#39;startWeekday&#39;</span>] : self::$default_startWeekday ).<span class="stringliteral">&#39;;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;            $the_new_content .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;            </div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;            $in_content = self::replace_shortcode($in_content, <span class="stringliteral">&#39;bmlt_map&#39;</span>, $the_new_content);</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;            </div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="keywordflow">return</span> $in_content;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    }</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160; </div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="comment">    *   \brief  This returns a div of location options to be applied to the map search.     *</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="comment">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a5e19c2b04b24b4aca8024c610a30abed"> 2250</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a5e19c2b04b24b4aca8024c610a30abed">BMLTPlugin_map_search_location_options</a>(</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        $in_options_id, <span class="comment">///&lt; The ID for the options to use for this implementation.</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment"></span>        $in_uid         <span class="comment">///&lt; This is the UID of the enclosing div.</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        $ret = <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_location_options_div&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_options_loc&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;a class=&quot;bmlt_map_reveal_options&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_loc_a&quot; href=&quot;javascript:var a=document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_loc_a\&#39;);var b=document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_loc\&#39;);if(b &amp;amp;&amp;amp; a){if(b.style.display==\&#39;none\&#39;){a.className=\&#39;bmlt_map_hide_options\&#39;;b.style.display=\&#39;block\&#39;;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.openLocationSectionExt(document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_text\&#39;), document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_submit\&#39;));}else{a.className=\&#39;bmlt_map_reveal_options\&#39;;b.style.display=\&#39;none\&#39;;};};c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.recalculateMapExt()&quot;&gt;&lt;span&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_option_loc_label).<span class="stringliteral">&#39;&lt;/span&gt;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_search_options_div&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_loc&quot; style=&quot;display:none&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;form action=&quot;#&quot; method=&quot;get&quot; onsubmit=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.lookupLocationExt(document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_text\&#39;), document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_submit\&#39;));return false&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                        $ret .= <span class="stringliteral">&#39;&lt;fieldset class=&quot;bmlt_map_container_div_search_options_div_location_fieldset&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;location_radius_popup_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;label for=&quot;&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_option_loc_popup_label_1).<span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;select class=&quot;bmlt_map_location_radius_popup&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_radius_select&quot; onchange=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.changeRadiusExt(true)&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                                    $ret .= <span class="stringliteral">&#39;&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_option_loc_popup_auto).<span class="stringliteral">&#39;&lt;/option&gt;&#39;</span>;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                                    $ret .= <span class="stringliteral">&#39;&lt;option value=&quot;&quot; disabled=&quot;disabled&quot;&gt;&lt;/option&gt;&#39;</span>;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                                    $options = $this-&gt;getBMLTOptions_by_id($in_options_id);</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                                    $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        <span class="keywordflow">foreach</span> ($this-&gt;my_current_language-&gt;local_new_map_js_diameter_choices as $radius) {</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;option value=&quot;&#39;</span>.($radius / 2).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.($radius / 2).<span class="charliteral">&#39; &#39;</span>.$this-&gt;process_text((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span>) ? $this-&gt;my_current_language-&gt;local_new_map_option_loc_popup_km : $this-&gt;my_current_language-&gt;local_new_map_option_loc_popup_mi).<span class="stringliteral">&#39;&lt;/option&gt;&#39;</span>;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        }</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;/select&gt;&#39;</span>;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;label for=&quot;&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_option_loc_popup_label_2).<span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;fieldset class=&quot;location_text_entry_fieldset&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;legend&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_text_entry_fieldset_label).<span class="stringliteral">&#39;&lt;/legend&gt;&#39;</span>;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                                $def_text = $this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_text_entry_default_text);</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;location_text_input_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                                    $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;text&quot; class=&quot;location_text_input_item_blurred&quot; value=&quot;&#39;</span>.$def_text.<span class="stringliteral">&#39;&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_text&quot; onfocus=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.focusLocationTextExt(this, document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_submit\&#39;), false)&quot; onblur=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.focusLocationTextExt(this, document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_submit\&#39;), true)&quot; onkeyup=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.enterTextIntoLocationTextExt(this, document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_submit\&#39;))&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;location_text_submit_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                                    $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;button&quot; disabled=&quot;disabled&quot; class=&quot;location_text_submit_button&quot; value=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_location_submit_button_text).<span class="stringliteral">&#39;&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_submit&quot; onclick=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.lookupLocationExt(document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_location_text\&#39;), this)&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;/fieldset&gt;&#39;</span>;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                        $ret .= <span class="stringliteral">&#39;&lt;/fieldset&gt;&#39;</span>;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    }</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    </div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment">    *   \brief  This returns a div of search options to be applied to the map search.       *</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a161b35c445db3bb7d3ec0a59c592aec3"> 2298</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a161b35c445db3bb7d3ec0a59c592aec3">BMLTPlugin_map_search_search_options</a>(</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        $in_options_id, <span class="comment">///&lt; The ID for the options to use for this implementation.</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment"></span>        $in_uid         <span class="comment">///&lt; This is the UID of the enclosing div.</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        $options = $this-&gt;getBMLTOptions_by_id($in_options_id);</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        $ret = <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_search_options_div&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_options_1&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;a class=&quot;bmlt_map_reveal_options&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_1_a&quot; href=&quot;javascript:var a=document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_1_a\&#39;);var b=document.getElementById(\&#39;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_1\&#39;);if(b &amp;amp;&amp;amp; a){if(b.style.display==\&#39;none\&#39;){a.className=\&#39;bmlt_map_hide_options\&#39;;b.style.display=\&#39;block\&#39;}else{a.className=\&#39;bmlt_map_reveal_options\&#39;;b.style.display=\&#39;none\&#39;}};c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.recalculateMapExt()&quot;&gt;&lt;span&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_option_1_label).<span class="stringliteral">&#39;&lt;/span&gt;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_search_options_div&quot; id=&quot;&#39;</span>.$in_uid.<span class="stringliteral">&#39;_options_1&quot; style=&quot;display:none&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;form action=&quot;#&quot; method=&quot;get&quot; onsubmit=&quot;return false&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                        $ret .= <span class="stringliteral">&#39;&lt;fieldset class=&quot;bmlt_map_container_div_search_options_div_weekdays_fieldset&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;legend&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_weekdays).<span class="stringliteral">&#39;&lt;/legend&gt;&#39;</span>;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_search_options_weekday_checkbox_div&quot;&gt;&lt;input title=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_all_weekdays_title).<span class="stringliteral">&#39;&quot; type=&quot;checkbox&quot; id=&quot;weekday_&#39;</span>.$in_uid.<span class="stringliteral">&#39;_0&quot; checked=&quot;checked&quot; onchange=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.recalculateMapExt(this)&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;label title=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_all_weekdays_title).<span class="stringliteral">&#39;&quot; for=&quot;weekday_&#39;</span>.$in_uid.<span class="stringliteral">&#39;_0&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_all_weekdays).<span class="stringliteral">&#39;&lt;/label&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        <span class="keywordflow">for</span> ($index = 1; $index &lt; count($this-&gt;my_current_language-&gt;local_weekdays); $index++) {</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;            $weekday_index = ($index - 1) + $options[<span class="stringliteral">&#39;startWeekday&#39;</span>];</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            </div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;            <span class="keywordflow">if</span> ($weekday_index &gt; 7) {</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                $weekday_index -= 7;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;            }</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;            </div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;            $weekday = $this-&gt;my_current_language-&gt;local_weekdays[$weekday_index];</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_search_options_weekday_checkbox_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;input title=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_weekdays_title.$weekday).<span class="stringliteral">&#39;.&quot; type=&quot;checkbox&quot; id=&quot;weekday_&#39;</span>.$in_uid.<span class="charliteral">&#39;_&#39;</span>.htmlspecialchars($weekday_index).<span class="stringliteral">&#39;&quot; onchange=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.recalculateMapExt(this)&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;label title=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_weekdays_title.$weekday).<span class="stringliteral">&#39;.&quot; for=&quot;weekday_&#39;</span>.$in_uid.<span class="charliteral">&#39;_&#39;</span>.htmlspecialchars($weekday_index).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$this-&gt;process_text($weekday).<span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        }</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                        $ret .= <span class="stringliteral">&#39;&lt;/fieldset&gt;&#39;</span>;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                        $ret .= <span class="stringliteral">&#39;&lt;fieldset class=&quot;bmlt_map_container_div_search_options_div_formats_fieldset&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;legend&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_formats).<span class="stringliteral">&#39;&lt;/legend&gt;&#39;</span>;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_search_options_formats_checkbox_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;input title=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_all_formats_title).<span class="stringliteral">&#39;&quot; type=&quot;checkbox&quot; id=&quot;formats_&#39;</span>.$in_uid.<span class="stringliteral">&#39;_0&quot; checked=&quot;checked&quot; onchange=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.recalculateMapExt(this)&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                                $ret .= <span class="stringliteral">&#39;&lt;label title=&quot;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_all_formats_title).<span class="stringliteral">&#39;&quot; for=&quot;formats_&#39;</span>.$in_uid.<span class="stringliteral">&#39;_0&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_all_formats).<span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                            $this-&gt;my_driver-&gt;set_m_root_uri($options[<span class="stringliteral">&#39;root_server&#39;</span>]);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                            $error = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                            </div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        <span class="keywordflow">if</span> ($error) {</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            $formats = $this-&gt;my_driver-&gt;get_server_formats();</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;        </div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;            <span class="keywordflow">if</span> (!$this-&gt;my_driver-&gt;get_m_error_message()) {</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                $index = 1;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                <span class="keywordflow">foreach</span> ($formats as $id =&gt; $format) {</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;bmlt_map_container_div_search_options_formats_checkbox_div&quot;&gt;&lt;input type=&quot;checkbox&quot; value=&quot;&#39;</span>.intval($id).<span class="stringliteral">&#39;&quot; id=&quot;formats_&#39;</span>.$in_uid.<span class="charliteral">&#39;_&#39;</span>.$index.<span class="stringliteral">&#39;&quot; onchange=&quot;c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39;.recalculateMapExt(this)&quot; title=&quot;&#39;</span>.$this-&gt;process_text(<span class="charliteral">&#39;(&#39;</span>.$format[<span class="stringliteral">&#39;name_string&#39;</span>] .<span class="stringliteral">&#39;) &#39;</span>.$format[<span class="stringliteral">&#39;description_string&#39;</span>]).<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;label title=&quot;&#39;</span>.$this-&gt;process_text(<span class="charliteral">&#39;(&#39;</span>.$format[<span class="stringliteral">&#39;name_string&#39;</span>] .<span class="stringliteral">&#39;) &#39;</span>.$format[<span class="stringliteral">&#39;description_string&#39;</span>]).<span class="stringliteral">&#39;&quot; for=&quot;formats_&#39;</span>.$in_uid.<span class="charliteral">&#39;_&#39;</span>.$index.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$this-&gt;process_text($format[<span class="stringliteral">&#39;key_string&#39;</span>]).<span class="stringliteral">&#39;&lt;/label&gt;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                    $index++;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                }</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            }</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;        }</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                        $ret .= <span class="stringliteral">&#39;&lt;/fieldset&gt;&#39;</span>;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                    $ret .= <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    }</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160; </div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment">    *   \brief  This returns the global JavaScript stuff for the new map search that only   *</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment">    *           only needs to be loaded once.                                               *</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="comment">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a1737248d47e30fd50361ec549cf4e1da"> 2365</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a1737248d47e30fd50361ec549cf4e1da">BMLTPlugin_map_search_global_javascript_stuff</a>($in_options_id)  <span class="comment">///&lt; The ID of our currently selected options.</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;        $options = $this-&gt;getBMLTOptions_by_id($in_options_id);</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;        $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;        $gKey = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160; </div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;        <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;INVALID&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>])) {</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;            $gKey = $options[<span class="stringliteral">&#39;google_api_key&#39;</span>];</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;        }</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160; </div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <span class="comment">// Include the Google Maps API files.</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;        $ret = <span class="stringliteral">&#39;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;https://maps.googleapis.com/maps/api/js?libraries=geometry&amp;key=&#39;</span>.$gKey;</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;region_bias&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;region_bias&#39;</span>]) {</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;            $ret .= <span class="stringliteral">&#39;&amp;region=&#39;</span>.strtoupper($options[<span class="stringliteral">&#39;region_bias&#39;</span>]);</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        }</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        $ret .= <span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;        <span class="comment">// Declare the various globals and display strings. This is how we pass strings to the JavaScript, as opposed to the clunky way we do it in the root server.</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        $ret .= <span class="stringliteral">&#39;var c_g_cannot_determine_location = \&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_cannot_determine_location).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_no_meetings_found = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_fail_no_meetings).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_server_error = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_address_lookup_fail = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_cant_find_address).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_center_marker_curent_radius_1 = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_js_center_marker_current_radius_1).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_center_marker_curent_radius_2_km = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_js_center_marker_current_radius_2_km).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_center_marker_curent_radius_2_mi = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_js_center_marker_current_radius_2_mi).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_map_link_text = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_map_link).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_weekdays = [<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="stringliteral">        $ret .= &quot;&#39;</span><span class="stringliteral">&quot;.$this-&gt;process_text(join(&quot;</span><span class="charliteral">&#39;,&#39;</span><span class="stringliteral">&quot;, $this-&gt;my_current_language-&gt;local_weekdays)).&quot;</span><span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>];<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_weekdays_short = [<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="stringliteral">        $ret .= &quot;&#39;</span><span class="stringliteral">&quot;.$this-&gt;process_text(join(&quot;</span><span class="charliteral">&#39;,&#39;</span><span class="stringliteral">&quot;, $this-&gt;my_current_language-&gt;local_weekdays_short)).&quot;</span><span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>];<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_diameter_choices = [<span class="stringliteral">&#39;.join(&quot;,&quot;, $this-&gt;my_current_language-&gt;local_new_map_js_diameter_choices).&#39;</span>];<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_formats = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_formats).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_Noon = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noon).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_Midnight = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_midnight).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_debug_mode = <span class="stringliteral">&#39;.( defined(&#39;</span>DEBUG_MODE<span class="stringliteral">&#39;) ? &#39;</span><span class="keyword">true</span><span class="stringliteral">&#39; : &#39;</span><span class="keyword">false</span><span class="stringliteral">&#39; ).&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_distance_prompt = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_distance).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_distance_prompt_suffix = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_center_marker_distance_suffix).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_distance_center_marker_desc = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_center_marker_description).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_BMLTPlugin_files_uri = \<span class="stringliteral">&#39;&#39;</span>.htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).<span class="stringliteral">&#39;?\&#39;;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        $ret .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_images = &#39;&quot;</span>.htmlspecialchars($this-&gt;get_plugin_path().<span class="stringliteral">&quot;/google_map_images&quot;</span>).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        $ret .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_default_location_text = &#39;&quot;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_new_map_text_entry_default_text).<span class="stringliteral">&quot;&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.htmlspecialchars($this-&gt;get_plugin_path()).<span class="stringliteral">&#39;map_search.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160; </div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    }</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160; </div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment">    *   \brief  This returns the global JavaScript stuff for the new map search that only   *</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">    *           only needs to be loaded once.                                               *</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2efe0a0b9e11b85b1b974366b5e4cc79"> 2422</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2efe0a0b9e11b85b1b974366b5e4cc79">BMLTPlugin_nouveau_map_search_global_javascript_stuff</a>($in_options_id) <span class="comment">///&lt; The ID of our currently selected options.</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        $options = $this-&gt;getBMLTOptions_by_id($in_options_id);</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        <span class="comment">// Include the Google Maps API V3 files.</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        $gKey = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160; </div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;        <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;INVALID&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>])) {</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            $gKey = $options[<span class="stringliteral">&#39;google_api_key&#39;</span>];</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        }</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160; </div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        $ret = <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot; src=&quot;https://maps.googleapis.com/maps/api/js?libraries=geometry&amp;key=&#39;</span>.$gKey;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;        <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;region_bias&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;region_bias&#39;</span>]) {</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;            $ret .= <span class="stringliteral">&#39;&amp;region=&#39;</span>.strtoupper($options[<span class="stringliteral">&#39;region_bias&#39;</span>]);</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        }</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        $ret .= <span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;script src=&quot;&#39;</span>.htmlspecialchars($this-&gt;get_plugin_path()).<span class="stringliteral">&#39;nouveau_map_search.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160; </div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    }</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160; </div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="comment">    *   \brief  This returns the JavaScript stuff that needs to be loaded into each of the  *</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="comment">    *           new map search instances.                                                   *</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="comment">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0b9dcf50920c5faf3f4570ff3f8f8612"> 2451</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0b9dcf50920c5faf3f4570ff3f8f8612">BMLTPlugin_map_search_local_javascript_stuff</a>(</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;        $in_options_id, <span class="comment">///&lt; The ID for the options to use for this implementation.</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="comment"></span>        $in_uid         <span class="comment">///&lt; The unique ID for this instance</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;        $options = $this-&gt;getBMLTOptions_by_id($in_options_id);</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;        $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160; </div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        <span class="comment">// Declare the various globals and display strings. This is how we pass strings to the JavaScript, as opposed to the clunky way we do it in the root server.</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;        $ret = <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;        $ret .= <span class="stringliteral">&#39;var c_ms_&#39;</span>.$in_uid.<span class="stringliteral">&#39; = null;&#39;</span>;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        $ret .= <span class="stringliteral">&#39;var c_g_distance_units_are_km_&#39;</span>.$in_uid.<span class="stringliteral">&#39; = &#39;</span>.((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span> ) ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span>).<span class="charliteral">&#39;;&#39;</span>;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;        $ret .= <span class="stringliteral">&#39;var c_g_distance_units_&#39;</span>.$in_uid.<span class="stringliteral">&#39; = \&#39;&#39;</span>.((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span> ) ? $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_kilometers) : $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_miles) ).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_BMLTPlugin_throbber_img_src_<span class="stringliteral">&#39;.$in_uid.&quot; = &#39;</span><span class="stringliteral">&quot;.htmlspecialchars($this-&gt;get_plugin_path().&#39;themes/&#39;.$options[&#39;theme&#39;].&#39;/images/Throbber.gif&#39;).(defined(&#39;_DEBUG_MODE_&#39;) ? &quot;</span><span class="stringliteral">&#39;;\n&quot; : &quot;&#39;</span>;<span class="stringliteral">&quot;);</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="stringliteral">        $ret .= &#39;var c_g_BMLTRoot_URI_JSON_SearchResults_&#39;.$in_uid.&quot;</span> = <span class="stringliteral">&#39;&quot;.htmlspecialchars($this-&gt;get_ajax_base_uri()).&quot;?redirect_ajax_json=&quot;.urlencode(&#39;</span>switcher=GetSearchResults<span class="stringliteral">&#39;).&quot;&amp;bmlt_settings_id=$in_options_id&#39;</span>;\n<span class="stringliteral">&quot;;</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="stringliteral">        $ret .= &#39;&lt;/script&gt;&#39;;</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="stringliteral">    *   \brief This is a function that filters the content, and replaces a portion with the *</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="stringliteral">    *   &quot;</span>changes<span class="stringliteral">&quot; dump.                                                                     *</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;<span class="stringliteral">    *   \returns a string, containing the content.                                          *</span></div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#aefe3ccfcd3e44ca02676a22a47aa5ba5"> 2478</a></span>&#160;<span class="stringliteral">    public function display_changes($in_content)     ///&lt; This is the content to be filtered.</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="stringliteral">        $options_id = $this-&gt;cms_get_page_settings_id($in_content);</span></div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="stringliteral">        $options = $this-&gt;getBMLTOptions_by_id($options_id);</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="stringliteral">        $this-&gt;adapt_to_lang($options[&#39;lang&#39;]);</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="stringliteral">        $root_server_root = $options[&#39;root_server&#39;];</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="stringliteral">        $in_content = str_replace(array ( &#39;&amp;#038;&#39;, &#39;&amp;#038;#038;&#39;, &#39;&amp;#038;amp;&#39;, &#39;&amp;amp;#038;&#39;, &#39;&amp;amp;&#39;, &#39;&amp;amp;amp;&#39; ), &#39;&amp;&#39;, $in_content);   // This stupid kludge is because WordPress does an untoward substitution. Won&#39;t do anything unless WordPress has been naughty.</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="stringliteral">        while ($params = self::get_shortcode($in_content, &#39;bmlt_changes&#39;)) {</span></div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="stringliteral">            $param_array = explode(&#39;##-##&#39;, $params);    // You can specify a settings ID, by separating it from the URI parameters with a ##-##.</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="stringliteral">            $params = null;</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;<span class="stringliteral">            if (is_array($param_array) &amp;&amp; (count($param_array) &gt; 1)) {</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;<span class="stringliteral">                $options = $this-&gt;getBMLTOptions_by_id($param_array[0]);</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;<span class="stringliteral">                $this-&gt;adapt_to_lang($options[&#39;lang&#39;]);</span></div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;<span class="stringliteral">                $params = $param_array[1];</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="stringliteral">            } else {</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;<span class="stringliteral">                $params = (count($param_array) &gt; 0) ? $param_array[0] : null;</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;<span class="stringliteral">            if ($params &amp;&amp; $options[&#39;root_server&#39;]) {</span></div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="stringliteral">                $params = explode(&#39;&amp;&#39;, $params);</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;<span class="stringliteral">                $start_date = null;</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;<span class="stringliteral">                $end_date = null;</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;<span class="stringliteral">                $meeting_id = null;</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="stringliteral">                $service_body_id = null;</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="stringliteral">                $single_uri = null;</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="stringliteral">                foreach ($params as $one_param) {</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="stringliteral">                    list ( $key, $value ) = explode(&#39;=&#39;, $one_param, 2);</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="stringliteral">                    if ($key &amp;&amp; $value) {</span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="stringliteral">                        switch ($key) {</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="stringliteral">                            case &#39;start_date&#39;:</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;<span class="stringliteral">                                $start_date = strtotime($value);</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;<span class="stringliteral">                                break;</span></div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<span class="stringliteral">                            case &#39;end_date&#39;:</span></div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="stringliteral">                                $end_date = strtotime($value);</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="stringliteral">                                break;</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="stringliteral">                            case &#39;meeting_id&#39;:</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="stringliteral">                                $meeting_id = intval($value);</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="stringliteral">                                break;</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;<span class="stringliteral">                            case &#39;service_body_id&#39;:</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="stringliteral">                                $service_body_id = intval($value);</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="stringliteral">                                break;</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="stringliteral">                            </span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;<span class="stringliteral">                            case &#39;single_uri&#39;:</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="stringliteral">                                $single_uri = $value;</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;<span class="stringliteral">                                break;</span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;<span class="stringliteral">                $this-&gt;my_driver-&gt;set_m_root_uri($options[&#39;root_server&#39;]);</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="stringliteral">                $error = $this-&gt;my_driver-&gt;get_m_error_message();</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;<span class="stringliteral">                if ($error) {</span></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="stringliteral">                    if (ob_get_level()) {</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="stringliteral">                        ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="stringliteral">                    echo &quot;</span>&lt;!-- <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html">BMLTPlugin</a> ERROR (display_changes)! Can<span class="stringliteral">&#39;t set the Satellite Driver root! &quot;.htmlspecialchars($error).&quot; --&gt;&quot;;</span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="stringliteral">                } else {</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="stringliteral">                    set_time_limit(120); // Change requests can take a loooong time...</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="stringliteral">                    $changes = $this-&gt;my_driver-&gt;get_meeting_changes($start_date, $end_date, $meeting_id, $service_body_id);</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="stringliteral">                    $error = $this-&gt;my_driver-&gt;get_m_error_message();</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="stringliteral">                    if ($error) {</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="stringliteral">                        if (ob_get_level()) {</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="stringliteral">                            ob_end_clean(); // Just in case we are in an OB</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="stringliteral">                        echo &quot;&lt;!-- BMLTPlugin ERROR (display_changes)! Error during get_meeting_changes Call! &quot;.htmlspecialchars($error).&quot; --&gt;&quot;;</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="stringliteral">                    } else {</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="stringliteral">                        $the_new_content = &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_div&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="stringliteral">                        foreach ($changes as $change) {</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="stringliteral">                            $the_new_content .= $this-&gt;setup_one_change($change, $single_uri);</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="stringliteral">                        }</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="stringliteral">                        $the_new_content .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="stringliteral">                        </span></div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="stringliteral">                        $in_content = self::replace_shortcode($in_content, &#39;</span>bmlt_changes<span class="stringliteral">&#39;, $the_new_content);</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="stringliteral">        return $in_content;</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;<span class="stringliteral">    *   \brief Returns the XHTML for one single change record.                              *</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;<span class="stringliteral">    *   \returns A string. The DOCTYPE to be displayed.                                     *</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02578"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a0e0047901ac5577603ec2f2876551fcc"> 2578</a></span>&#160;<span class="stringliteral">    public function setup_one_change(</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="stringliteral">        $in_change_array,       ///&lt; One change record</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="stringliteral">        $in_single_uri = null   ///&lt; If there was a specific single meeting URI, we pass it in here.</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;<span class="stringliteral">    ) {</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="stringliteral">        $ret = &#39;</span>&lt;dl <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dl&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;bmlt_change_dl_&#39;.htmlspecialchars($in_change_array[&#39;change_type&#39;]).&#39;_&#39;.intval($in_change_array[&#39;date_int&#39;]).&#39;_&#39;.intval($in_change_array[&#39;meeting_id&#39;]).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;dt <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dt bmlt_change_record_dt_date&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text($this-&gt;my_current_language-&gt;local_change_label_date).&#39;</span>&lt;/dt&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;dd <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dd bmlt_change_record_dd_date&quot;</span>&gt;<span class="stringliteral">&#39;.date($this-&gt;my_current_language-&gt;local_change_date_format, intval($in_change_array[&#39;</span>date_int<span class="stringliteral">&#39;])).&#39;</span>&lt;/dd&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;<span class="stringliteral">        if (isset($in_change_array[&#39;</span>meeting_name<span class="stringliteral">&#39;]) &amp;&amp; $in_change_array[&#39;</span>meeting_name<span class="stringliteral">&#39;]) {</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;dt <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dt bmlt_change_record_dt_name&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text($this-&gt;my_current_language-&gt;local_change_label_meeting_name).&#39;</span>&lt;/dt&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;dd <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dd bmlt_change_record_dd_name&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;<span class="stringliteral">            if (isset($in_change_array[&#39;</span>meeting_id<span class="stringliteral">&#39;]) &amp;&amp; $in_change_array[&#39;</span>meeting_id<span class="stringliteral">&#39;] &amp;&amp; isset($in_single_uri) &amp;&amp; $in_single_uri) {</span></div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;a href=<span class="stringliteral">&quot;&#39;.htmlspecialchars($in_single_uri).$in_change_array[&#39;meeting_id&#39;].&#39;&quot;</span> rel=<span class="stringliteral">&quot;nofollow&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="stringliteral">                    $ret .= self::process_text(html_entity_decode($in_change_array[&#39;</span>meeting_name<span class="stringliteral">&#39;]));</span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;/a&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;<span class="stringliteral">            } else {</span></div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="stringliteral">                $ret .= self::process_text(html_entity_decode($in_change_array[&#39;</span>meeting_name<span class="stringliteral">&#39;]));</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;/dd&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;<span class="stringliteral">        if (isset($in_change_array[&#39;</span>service_body_name<span class="stringliteral">&#39;]) &amp;&amp; $in_change_array[&#39;</span>service_body_name<span class="stringliteral">&#39;]) {</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;dt <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dt bmlt_change_record_dt_service_body_name&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text($this-&gt;my_current_language-&gt;local_change_label_service_body_name).&#39;</span>&lt;/dt&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;dd <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dd bmlt_change_record_dd_service_body_name&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text(html_entity_decode($in_change_array[&#39;</span>service_body_name<span class="stringliteral">&#39;])).&#39;</span>&lt;/dd&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="stringliteral">        if (isset($in_change_array[&#39;</span>user_name<span class="stringliteral">&#39;]) &amp;&amp; $in_change_array[&#39;</span>user_name<span class="stringliteral">&#39;]) {</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;dt <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dt bmlt_change_record_dt_service_body_admin_name&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text($this-&gt;my_current_language-&gt;local_change_label_admin_name).&#39;</span>&lt;/dt&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;dd <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dd bmlt_change_record_dd_service_body_admin_name&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text(html_entity_decode($in_change_array[&#39;</span>user_name<span class="stringliteral">&#39;])).&#39;</span>&lt;/dd&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="stringliteral">        if (isset($in_change_array[&#39;</span>details<span class="stringliteral">&#39;]) &amp;&amp; $in_change_array[&#39;</span>details<span class="stringliteral">&#39;]) {</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;dt <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dt bmlt_change_record_dt_description&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text($this-&gt;my_current_language-&gt;local_change_label_description).&#39;</span>&lt;/dt&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;dd <span class="keyword">class</span>=<span class="stringliteral">&quot;bmlt_change_record_dd bmlt_change_record_dd_description&quot;</span>&gt;<span class="stringliteral">&#39;.self::process_text(html_entity_decode($in_change_array[&#39;</span>details<span class="stringliteral">&#39;])).&#39;</span>&lt;/dd&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;/dl&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;<span class="stringliteral">    *                              FAST MOBILE LOOKUP ROUTINES                              *</span></div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="stringliteral">    *   Our mobile support is based on the fast mobile client. It has been adapted to fit   *</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="stringliteral">    *   into a WordPress environment.                                                       *</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;<span class="stringliteral">    *   \brief Checks the UA of the caller, to see if it should return XHTML Strict or WML. *</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<span class="stringliteral">    *   NOTE: This is very, very basic. It is not meant to be a studly check, like WURFL.   *</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="stringliteral">    *   \returns A string. The DOCTYPE to be displayed.                                     *</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a429fda64d92c4fe232aa32669e04fbd1"> 2633</a></span>&#160;<span class="stringliteral">    public static function BMLTPlugin_select_doctype($in_http_vars)  ///&lt; The query variables</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="stringliteral">        $ret = &#39;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="stringliteral">        function isDeviceWML1($in_http_vars)</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="stringliteral">        {</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="stringliteral">            return BMLTPlugin::mobile_sniff_ua($in_http_vars) == &#39;</span>wml<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="stringliteral">        function isDeviceWML2($in_http_vars)</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;<span class="stringliteral">        {</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="stringliteral">            return BMLTPlugin::mobile_sniff_ua($in_http_vars) == &#39;</span>xhtml_mp<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="stringliteral">        function isMobileDevice($in_http_vars)</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="stringliteral">        {</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="stringliteral">            $language = BMLTPlugin::mobile_sniff_ua($in_http_vars);</span></div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="stringliteral">            return ($language != &#39;</span>xhtml<span class="stringliteral">&#39;) &amp;&amp; ($language != &#39;</span>smartphone<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="stringliteral">        // If we aren&#39;</span>t deliberately forcing an emulation, we figure it out <span class="keywordflow">for</span> ourselves.</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;        <span class="keywordflow">if</span> (!isset($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;            <span class="keywordflow">if</span> (isDeviceWML1($in_http_vars)) {</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                $in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] = 1;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;            } elseif (isDeviceWML2($in_http_vars)) {</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                $in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] = 2;</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            } elseif (isMobileDevice($in_http_vars)) {</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                $in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] = 1;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            }</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;        }</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;        </div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        <span class="comment">// We may specify a mobile XHTML (WML 2) manually.</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        <span class="keywordflow">if</span> (isset($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;            <span class="keywordflow">if</span> ($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] == 2) {    <span class="comment">// Use the XHTML MP header</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                $ret = <span class="stringliteral">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML Basic 1.0//EN&quot; &quot;http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;            } <span class="keywordflow">else</span> <span class="comment">// Default is WAP</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                {</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                $ret = <span class="charliteral">&#39;&lt;&#39;</span>; <span class="comment">// This is because some servers are dumb enough to interpret the embedded prolog as PHP delimiters.</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                $ret .= <span class="stringliteral">&#39;?xml version=&quot;1.0&quot;?&#39;</span>;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                $ret .= <span class="stringliteral">&#39;&gt;&lt;!DOCTYPE wml PUBLIC &quot;-//WAPFORUM//DTD WML 1.1//EN&quot; &quot;http://www.wapforum.org/DTD/wml_1.1.xml&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;            }</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;            <span class="comment">// We return a fully-qualified XHTML 1.0 Strict page.</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;            $ret = <span class="stringliteral">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        }</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        </div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        <span class="keywordflow">if</span> (!isset($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) || ($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] != 1)) {</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot;&#39;</span>;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;            <span class="keywordflow">if</span> (!isset($in_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;                $ret .= <span class="stringliteral">&#39; lang=&quot;en&quot;&#39;</span>;</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;            }</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;            $ret .= <span class="charliteral">&#39;&gt;&#39;</span>;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;wml&gt;&#39;</span>;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        }</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;        </div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;head&gt;&#39;</span>;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    </div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    }</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    </div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="comment">    *   \brief Output the necessary Javascript. This is only called for a &quot;pure javascript&quot; *</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="comment">    *   do_search invocation (smartphone interactive map).                                  *</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a7c4afb53d27429c6ff4675a810d910da"> 2702</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a7c4afb53d27429c6ff4675a810d910da">BMLTPlugin_fast_mobile_lookup_javascript_stuff</a>()</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    {</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        $options = $this-&gt;getBMLTOptions_by_id($this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>]);</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        </div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;        $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;        $gKey = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160; </div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;INVALID&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>])) {</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;            $gKey = $options[<span class="stringliteral">&#39;google_api_key&#39;</span>];</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        }</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160; </div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        $ret = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160; </div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;        <span class="comment">// Include the Google Maps API V3 files.</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot; src=&quot;https://maps.googleapis.com/maps/api/js?key=&#39;</span>.$gKey.<span class="stringliteral">&#39;&amp;region=&#39;</span>.strtoupper($options[<span class="stringliteral">&#39;region_bias&#39;</span>]).<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;        </div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;        <span class="comment">// Declare the various globals and display strings. This is how we pass strings to the JavaScript, as opposed to the clunky way we do it in the root server.</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        $ret .= <span class="stringliteral">&#39;var c_g_cannot_determine_location = \&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_cannot_determine_location).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_no_meetings_found = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_fail_no_meetings).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_server_error = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_address_lookup_fail = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_cant_find_address).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_map_link_text = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_map_link).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_weekdays = [<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="stringliteral">        $ret .= &quot;&#39;</span><span class="stringliteral">&quot;.$this-&gt;process_text(join(&quot;</span><span class="charliteral">&#39;,&#39;</span><span class="stringliteral">&quot;, $this-&gt;my_current_language-&gt;local_weekdays)).&quot;</span><span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>];<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_formats = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_formats).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_Noon = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_noon).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_Midnight = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_midnight).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_debug_mode = <span class="stringliteral">&#39;.( defined(&#39;</span>DEBUG_MODE<span class="stringliteral">&#39;) ? &#39;</span><span class="keyword">true</span><span class="stringliteral">&#39; : &#39;</span><span class="keyword">false</span><span class="stringliteral">&#39; ).&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<span class="stringliteral">        $h = null;</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="stringliteral">        $m = null;</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="stringliteral">        list ( $h, $m ) = explode(&#39;</span>:<span class="stringliteral">&#39;, date(&quot;G:i&quot;, time() + ($options[&#39;</span>time_offset<span class="stringliteral">&#39;] * 60 * 60) - ($options[&#39;</span>grace_time<span class="stringliteral">&#39;] * 60)));</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_hour = <span class="stringliteral">&#39;.intval($h).&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_min = <span class="stringliteral">&#39;.intval($m).&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_military_time = <span class="stringliteral">&#39;.($options[&#39;</span>military_time<span class="stringliteral">&#39;] ? &#39;</span><span class="keyword">true</span><span class="stringliteral">&#39; : &#39;</span><span class="keyword">false</span><span class="stringliteral">&#39; ).&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_Nouveau_start_week = <span class="stringliteral">&#39;.((isset($options[&#39;</span>startWeekday<span class="stringliteral">&#39;]) &amp;&amp; $options[&#39;</span>startWeekday<span class="stringliteral">&#39;]) ? $options[&#39;</span>startWeekday<span class="stringliteral">&#39;] : self::$default_startWeekday ).&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_distance_prompt = \<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_distance).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_distance_units_are_km = <span class="stringliteral">&#39;.((strtolower($options[&#39;</span>distance_units<span class="stringliteral">&#39;]) == &#39;</span>km<span class="stringliteral">&#39; ) ? &#39;</span><span class="keyword">true</span><span class="stringliteral">&#39; : &#39;</span><span class="keyword">false</span><span class="stringliteral">&#39;).&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_g_distance_units = \<span class="stringliteral">&#39;&#39;</span>.((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span> ) ? $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_kilometers) : $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_miles) ).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>var c_BMLTPlugin_files_uri = \<span class="stringliteral">&#39;&#39;</span>.htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).<span class="stringliteral">&#39;?\&#39;;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        $ret .= <span class="stringliteral">&#39;var c_bmlt_settings_id=&#39;</span>.intVal(((isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>]) &amp;&amp; $this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>]) ? $this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>)) .<span class="charliteral">&#39;;&#39;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160; </div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        $img_url = htmlspecialchars($this-&gt;get_plugin_path().<span class="stringliteral">&quot;google_map_images&quot;</span>);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;        </div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;        $ret .= <span class="stringliteral">&quot;var c_g_BMLTPlugin_images = &#39;$img_url&#39;;&quot;</span> . (defined(<span class="stringliteral">&#39;_DEBUG_MODE_&#39;</span>) ? <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        $ret .= <span class="stringliteral">&#39;var c_g_googleURI = \&#39;https://maps.google.com/maps/api/js?key=&#39;</span>.$key.<span class="stringliteral">&#39;&amp;region=&#39;</span>.strtoupper($options[<span class="stringliteral">&#39;region_bias&#39;</span>]).<span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39; . (defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &#39;</span><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;/script&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="stringliteral">       </span></div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;script src=<span class="stringliteral">&quot;&#39;.htmlspecialchars($this-&gt;get_plugin_path()).&#39;fast_mobile_lookup.js&quot;</span> type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;<span class="stringliteral">    *   \brief Output whatever header stuff is necessary for the available UA               *</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="stringliteral">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab5df9b359a4a902461ae060aaff98b27"> 2763</a></span>&#160;<span class="stringliteral">    public function BMLTPlugin_fast_mobile_lookup_header_stuff()</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="stringliteral">        $ret = &#39;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;<span class="stringliteral">        $url = $this-&gt;get_plugin_path();</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;meta http-equiv=<span class="stringliteral">&quot;content-type&quot;</span> content=<span class="stringliteral">&quot;text/html; charset=utf-8&quot;</span> /&gt;<span class="stringliteral">&#39;;    // WML 1 only cares about the charset and cache.</span></div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;meta http-equiv=<span class="stringliteral">&quot;Cache-Control&quot;</span> content=<span class="stringliteral">&quot;max-age=300&quot;</span>  /&gt;<span class="stringliteral">&#39;;               // Cache for 5 minutes.</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;meta http-equiv=<span class="stringliteral">&quot;Cache-Control&quot;</span> content=<span class="stringliteral">&quot;no-transform&quot;</span>  /&gt;<span class="stringliteral">&#39;;              // No Transforms.</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="stringliteral">        if (!isset($this-&gt;my_http_vars[&#39;</span>WML<span class="stringliteral">&#39;]) || ($this-&gt;my_http_vars[&#39;</span>WML<span class="stringliteral">&#39;] != 1)) {   // If full XHTML</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="stringliteral">            // Various meta tags we need.</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;meta http-equiv=<span class="stringliteral">&quot;Content-Script-Type&quot;</span> content=<span class="stringliteral">&quot;text/javascript&quot;</span> /&gt;<span class="stringliteral">&#39;;      // Set the types for inline styles and scripts.</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;meta http-equiv=<span class="stringliteral">&quot;Content-Style-Type&quot;</span> content=<span class="stringliteral">&quot;text/css&quot;</span> /&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;meta name=<span class="stringliteral">&quot;viewport&quot;</span> content=<span class="stringliteral">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0&quot;</span> /&gt;<span class="stringliteral">&#39;; // Make sure iPhone screens stay humble.</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="stringliteral">            $url = $this-&gt;get_plugin_path();</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;<span class="stringliteral">            $options = $this-&gt;getBMLTOptions_by_id($this-&gt;my_http_vars[&#39;</span>bmlt_settings_id<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;<span class="stringliteral">            $this-&gt;adapt_to_lang($options[&#39;</span>lang<span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;<span class="stringliteral">            $url = htmlspecialchars($url.&#39;</span>themes/<span class="stringliteral">&#39;.$options[&#39;</span>theme<span class="stringliteral">&#39;].&#39;</span>/<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;link rel=<span class="stringliteral">&quot;stylesheet&quot;</span> media=<span class="stringliteral">&quot;all&quot;</span> href=<span class="stringliteral">&quot;&#39;.$url.&#39;fast_mobile_lookup.css&quot;</span> type=<span class="stringliteral">&quot;text/css&quot;</span> /&gt;<span class="stringliteral">&#39;.(defined(&#39;</span>_DEBUG_MODE_<span class="stringliteral">&#39;) ? &quot;\n&quot; : &quot;&quot;);</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="stringliteral">            // If we have a shortcut icon, set it here.</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;<span class="stringliteral">            if (defined(&#39;</span>_SHORTCUT_LOC_<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;link rel=<span class="stringliteral">&quot;SHORTCUT ICON&quot;</span> href=<span class="stringliteral">&quot;&#39;.$this-&gt;process_text(&#39;_SHORTCUT_LOC_&#39;).&#39;&quot;</span> /&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="stringliteral">            // Set the appropriate page title.</span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="stringliteral">            if (isset($this-&gt;my_http_vars[&#39;</span>do_search<span class="stringliteral">&#39;])) {</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;title&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_results_page_title).&#39;</span>&lt;/title&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="stringliteral">            } else {</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="stringliteral">                $ret .= &#39;</span>&lt;title&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_results_page_title).&#39;</span>&lt;/title&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;/head&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="stringliteral">    *   \brief Returns the XHTML/WML for the Map Search form. These are the three &quot;fast     *</span></div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="stringliteral">    *   lookup&quot; links displayed at the top (Note display:none&quot; in the style).               *</span></div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;<span class="stringliteral">    *   This is to be revealed by JavaScript.                                               *</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;<span class="stringliteral">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02814"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a94669e11dbe3108f6aa83686b4d8e6f1"> 2814</a></span>&#160;<span class="stringliteral">    public function BMLTPlugin_draw_map_search_form()</span></div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;<span class="stringliteral">        $ret = &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;search_intro&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;hidden_until_js&quot;</span> style=<span class="stringliteral">&quot;display:none&quot;</span>&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;h1 <span class="keyword">class</span>=<span class="stringliteral">&quot;banner_h1&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_GPS_banner).&#39;</span>&lt;/h1&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;h2 <span class="keyword">class</span>=<span class="stringliteral">&quot;banner_h2&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_GPS_banner_subtext).&#39;</span>&lt;/h2&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;link_one_line&quot;</span>&gt;&lt;a rel=<span class="stringliteral">&quot;nofollow&quot;</span> accesskey=<span class="stringliteral">&quot;1&quot;</span> href=<span class="stringliteral">&quot;&#39;.htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).&#39;?BMLTPlugin_mobile&amp;amp;do_search&amp;amp;bmlt_settings_id=&#39;.htmlspecialchars($this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;]).((isset($this-&gt;my_http_vars[&#39;base_url&#39;]) &amp;&amp; $this-&gt;my_http_vars[&#39;base_url&#39;]) ? &#39;&amp;amp;base_url=&#39;.urlencode($this-&gt;my_http_vars[&#39;base_url&#39;]) : &#39;&#39;).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_all).&#39;</span>&lt;/a&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;link_one_line&quot;</span>&gt;&lt;a rel=<span class="stringliteral">&quot;nofollow&quot;</span> accesskey=<span class="stringliteral">&quot;2&quot;</span> href=<span class="stringliteral">&quot;&#39;.htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).&#39;?BMLTPlugin_mobile&amp;amp;do_search&amp;amp;qualifier=today&amp;amp;bmlt_settings_id=&#39;.htmlspecialchars($this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;]).((isset($this-&gt;my_http_vars[&#39;base_url&#39;]) &amp;&amp; $this-&gt;my_http_vars[&#39;base_url&#39;]) ? &#39;&amp;amp;base_url=&#39;.urlencode($this-&gt;my_http_vars[&#39;base_url&#39;]) : &#39;&#39;).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_today).&#39;</span>&lt;/a&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;link_one_line&quot;</span>&gt;&lt;a rel=<span class="stringliteral">&quot;nofollow&quot;</span> accesskey=<span class="stringliteral">&quot;3&quot;</span> href=<span class="stringliteral">&quot;&#39;.htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).&#39;?BMLTPlugin_mobile&amp;amp;do_search&amp;amp;qualifier=tomorrow&amp;amp;bmlt_settings_id=&#39;.htmlspecialchars($this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;]).((isset($this-&gt;my_http_vars[&#39;base_url&#39;]) &amp;&amp; $this-&gt;my_http_vars[&#39;base_url&#39;]) ? &#39;&amp;amp;base_url=&#39;.urlencode($this-&gt;my_http_vars[&#39;base_url&#39;]) : &#39;&#39;).&#39;&quot;</span>&gt;<span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_tomorrow).&#39;</span>&lt;/a&gt;&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="stringliteral">            $ret .= &#39;</span>&lt;hr <span class="keyword">class</span>=<span class="stringliteral">&quot;meeting_divider_hr&quot;</span> /&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="stringliteral">        $ret .= &#39;</span>&lt;/div&gt;<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="stringliteral">    *   \brief Returns the XHTML/WML for the Address Entry form                             *</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="stringliteral">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2bd3f01f52f2ba09b4a2e155e8c391b9"> 2835</a></span>&#160;<span class="stringliteral">    public function BMLTPlugin_draw_address_search_form()</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="stringliteral">        if (!isset($this-&gt;my_http_vars[&#39;</span>WML<span class="stringliteral">&#39;]) || ($this-&gt;my_http_vars[&#39;</span>WML<span class="stringliteral">&#39;] != 1)) {</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="stringliteral">            $ret = &#39;</span>&lt;form <span class="keyword">class</span>=<span class="stringliteral">&quot;address_input_form&quot;</span> method=<span class="stringliteral">&quot;get&quot;</span> action=<span class="stringliteral">&quot;&#39;.htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).&#39;&quot;</span><span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="stringliteral">            if (!isset($this-&gt;my_http_vars[&#39;</span>WML<span class="stringliteral">&#39;])) {</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="stringliteral">                // This fills the form with a &quot;seed&quot; text (standard accessibility practice). We do it this way, so we don&#39;</span>t clutter the form <span class="keywordflow">if</span> no JavaScript is available.</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                $ret .= <span class="stringliteral">&#39; onsubmit=&quot;if((document.getElementById(\&#39;address_input\&#39;).value==\&#39;&#39;</span>;</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;                $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_an_address);</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                $ret .= <span class="charliteral">&#39;\&#39;</span>)||!document.getElementById(\<span class="stringliteral">&#39;address_input\&#39;).value){alert(\&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_address_alert).<span class="charliteral">&#39;\&#39;</span>);document.getElementById(\<span class="stringliteral">&#39;address_input\&#39;).focus();return false}else{if(document.getElementById(\&#39;hidden_until_js\&#39;).style.display==\&#39;block\&#39;){document.getElementById(\&#39;do_search\&#39;).value=\&#39;1\&#39;}}&quot;&#39;</span>;</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;            }</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            $ret .= <span class="charliteral">&#39;&gt;&#39;</span>;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;search_address&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            <span class="comment">// The default, is we return a list. This is changed by JavaScript.</span></div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;BMLTPlugin_mobile&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            </div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;            <span class="keywordflow">if</span> (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;base_url&#39;</span>]) &amp;&amp; $this-&gt;my_http_vars[<span class="stringliteral">&#39;base_url&#39;</span>]) {</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;base_url&quot; value=&quot;&#39;</span>.htmlspecialchars($this-&gt;my_http_vars[<span class="stringliteral">&#39;base_url&#39;</span>]).<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;            }</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                </div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;bmlt_settings_id&quot; value=&quot;&#39;</span>.htmlspecialchars($this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>]).<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;do_search&quot; id=&quot;do_search&quot; value=&quot;the hard way&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;h1 class=&quot;banner_h2&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_address_single).<span class="stringliteral">&#39;&lt;/h1&gt;&#39;</span>;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;            <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {  <span class="comment">// This is here to prevent WAI warnings.</span></div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;label for=&quot;address_input&quot; style=&quot;display:none&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_address_alert).<span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;            }</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;            <span class="keywordflow">if</span> (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;WML&quot; value=&quot;2&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;            }</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;            $ret = <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>;   <span class="comment">// WML rides the short bus.</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;        }</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;        </div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) || ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] != 1)) {</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;address_top&quot; id=&quot;address_input_line_wrapper&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;link_one_line input_line_div&quot; id=&quot;address_input_line_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;            <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;link_one_line&quot; id=&quot;hidden_until_js2&quot; style=&quot;display:none&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;checkbox&quot; id=&quot;force_list_checkbox&quot;&#39;</span>;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;                $ret .= <span class="stringliteral">&#39; onchange=&quot;if(this.checked){document.getElementById ( \&#39;hidden_until_js\&#39; ).style.display = \&#39;none\&#39;;document.getElementById(\&#39;address_input\&#39;).focus();}else{document.getElementById ( \&#39;hidden_until_js\&#39; ).style.display = \&#39;block\&#39;}&quot; /&gt;&lt;label for=&quot;force_list_checkbox&quot;&#39;</span>;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;                $ret .= <span class="stringliteral">&#39;&gt; &#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_list_check).<span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;            }</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;        }</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;            </div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;input type=&quot;text&quot; name=&quot;address&quot;&#39;</span>;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        </div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;        <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) || ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] != 1)) {</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;            $ret .= <span class="stringliteral">&#39; id=&quot;address_input&quot; class=&quot;address_input&quot; size=&quot;64&quot; value=&quot;&quot;&#39;</span>;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;            <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;                $ret .= <span class="stringliteral">&#39; onfocus=&quot;if(!this.value||(this.value==\&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_an_address).<span class="charliteral">&#39;\&#39;</span>))this.value=\<span class="charliteral">&#39;\&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="stringliteral">                $ret .= &#39; onkeydown=&quot;</span><span class="keywordflow">if</span>(!this.value||(this.value==\<span class="stringliteral">&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_an_address).<span class="charliteral">&#39;\&#39;</span>))this.value=\<span class="charliteral">&#39;\&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="stringliteral">                $ret .= &#39; onblur=&quot;</span><span class="keywordflow">if</span>(!this.value)this.value=\<span class="stringliteral">&#39;&#39;</span>.$this-&gt;<a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">process_text</a>($this-&gt;my_current_language-&gt;local_enter_an_address).<span class="charliteral">&#39;\&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="stringliteral">        } else {</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="stringliteral">            $ret .= &#39; size=&quot;</span>32<span class="stringliteral">&quot; format=&quot;</span>*m<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;<span class="stringliteral">        $ret .= &#39; /&gt;&#39;;</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="stringliteral">        if (!isset($this-&gt;my_http_vars[&#39;WML&#39;]) || ($this-&gt;my_http_vars[&#39;WML&#39;] != 1)) {</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;<span class="stringliteral">        } else {</span></div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/p&gt;&#39;;</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;<span class="stringliteral">        if (!isset($this-&gt;my_http_vars[&#39;WML&#39;]) || ($this-&gt;my_http_vars[&#39;WML&#39;] != 1)) {</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;div class=&quot;</span>link_form_elements<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;div class=&quot;</span>link_one_line<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;input checked=&quot;</span>checked<span class="stringliteral">&quot; id=&quot;</span>search_all_days<span class="stringliteral">&quot; type=&quot;</span>radio<span class="stringliteral">&quot; name=&quot;</span>qualifier<span class="stringliteral">&quot; value=&quot;</span><span class="stringliteral">&quot; /&gt;&#39;;</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;label for=&quot;</span>search_all_days<span class="stringliteral">&quot;&gt; &#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_all_address).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;div class=&quot;</span>link_one_line<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;input id=&quot;</span>search_today<span class="stringliteral">&quot; type=&quot;</span>radio<span class="stringliteral">&quot; name=&quot;</span>qualifier<span class="stringliteral">&quot; value=&quot;</span>today<span class="stringliteral">&quot; /&gt;&#39;;</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;label for=&quot;</span>search_today<span class="stringliteral">&quot;&gt; &#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_today).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;div class=&quot;</span>link_one_line<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;input id=&quot;</span>search_tomorrow<span class="stringliteral">&quot; type=&quot;</span>radio<span class="stringliteral">&quot; name=&quot;</span>qualifier<span class="stringliteral">&quot; value=&quot;</span>tomorrow<span class="stringliteral">&quot; /&gt;&#39;;</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;label for=&quot;</span>search_tomorrow<span class="stringliteral">&quot;&gt; &#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_tomorrow).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;div class=&quot;</span>link_one_line_submit<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;<span class="stringliteral">            if (!isset($this-&gt;my_http_vars[&#39;WML&#39;])) {  // This silly thing is to prevent WAI warnings.</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;label for=&quot;</span>submit_button<span class="stringliteral">&quot; style=&quot;</span>display:none<span class="stringliteral">&quot;&gt;&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_submit_button).&#39;&lt;/label&gt;&#39;;</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;input id=&quot;</span>submit_button<span class="stringliteral">&quot; type=&quot;</span>submit<span class="stringliteral">&quot; value=&quot;</span><span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_submit_button).&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="stringliteral">            if (!isset($this-&gt;my_http_vars[&#39;WML&#39;])) {</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="stringliteral">                $ret .= &#39; onclick=&quot;</span><span class="keywordflow">if</span>((document.getElementById(\<span class="stringliteral">&#39;address_input\&#39;).value==\&#39;&#39;</span>;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;                $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_an_address);</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                $ret .= <span class="charliteral">&#39;\&#39;</span>)||!document.getElementById(\<span class="stringliteral">&#39;address_input\&#39;).value){alert(\&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_address_alert).<span class="charliteral">&#39;\&#39;</span>);document.getElementById(\<span class="stringliteral">&#39;address_input\&#39;).focus();return false}else{if(document.getElementById(\&#39;hidden_until_js\&#39;).style.display==\&#39;block\&#39;){document.getElementById(\&#39;do_search\&#39;).value=\&#39;1\&#39;}}&quot;&#39;</span>;</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;            }</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;            $ret .= <span class="stringliteral">&#39; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;select name=&quot;qualifier&quot; value=&quot;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;option value=&quot;&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_all_address).<span class="stringliteral">&#39;&lt;/option&gt;&#39;</span>;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;option value=&quot;today&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_today).<span class="stringliteral">&#39;&lt;/option&gt;&#39;</span>;</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;option value=&quot;tomorrow&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_tomorrow).<span class="stringliteral">&#39;&lt;/option&gt;&#39;</span>;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/select&gt;&#39;</span>;</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;anchor&gt;&#39;</span>;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;go href=&quot;&#39;</span>.htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).<span class="stringliteral">&#39;&quot; method=&quot;get&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;postfield name=&quot;address&quot; value=&quot;$(address)&quot;/&gt;&#39;</span>;</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;postfield name=&quot;qualifier&quot; value=&quot;$(qualifier)&quot;/&gt;&#39;</span>;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;postfield name=&quot;do_search&quot; value=&quot;the hard way&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;postfield name=&quot;WML&quot; value=&quot;1&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;postfield name=&quot;BMLTPlugin_mobile&quot; value=&quot;1&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;            if (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;base_url&#39;</span>]) &amp;&amp; $this-&gt;my_http_vars[<span class="stringliteral">&#39;base_url&#39;</span>]) {</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;postfield type=&quot;hidden&quot; name=&quot;base_url&quot; value=&quot;&#39;</span>.htmlspecialchars($this-&gt;my_http_vars[<span class="stringliteral">&#39;base_url&#39;</span>]).<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;            }</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;postfield name=&quot;bmlt_settings_id&quot; value=&quot;&#39;</span>.$this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>].<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/go&gt;&#39;</span>;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;            $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_search_submit_button);</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/anchor&gt;&#39;</span>;</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        }</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        </div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    }</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160; </div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="comment">    *   \brief Renders one WML card                                                         *</span></div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;<span class="comment">    *   \returns A string. The WML 1.1 to be displayed.                                     *</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab86b4e0a45f366c9f847ab6e23ea94fa"> 2966</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab86b4e0a45f366c9f847ab6e23ea94fa">BMLTPlugin_render_card</a>(</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        $ret,                   <span class="comment">///&lt; The current XHTML tally (so we can count it).</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;<span class="comment"></span>        $index,                 <span class="comment">///&lt; The page index of the meeting.</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="comment"></span>        $count,                 <span class="comment">///&lt; The total number of meetings.</span></div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<span class="comment"></span>        $meeting                <span class="comment">///&lt; The meeting data.</span></div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;<span class="comment"></span>    ) {</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;card id=&quot;card_&#39;</span>.$index.<span class="stringliteral">&#39;&quot; title=&quot;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;meeting_name&#39;</span>]).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;        </div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160; </div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        <span class="keywordflow">if</span> ($count &gt; 1) {</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;            $next_card = <span class="keyword">null</span>;</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;            $prev_card = <span class="keyword">null</span>;</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;            $myself = <span class="keyword">null</span>;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;            $vars = array();</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;            </div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;            unset($_REQUEST[<span class="stringliteral">&#39;access_card&#39;</span>]);</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;            </div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;            <span class="keywordflow">foreach</span> ($_REQUEST as $name =&gt; $val) {</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                $text = urlencode($name).<span class="charliteral">&#39;=&#39;</span>.urlencode($val);</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                array_push($vars, $text);</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;            }</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;            </div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;            $myself = htmlspecialchars($this-&gt;get_ajax_mobile_base_uri()).<span class="charliteral">&#39;?&#39;</span>.join(<span class="stringliteral">&#39;&amp;amp;&#39;</span>, $vars).<span class="stringliteral">&#39;&amp;amp;access_card=&#39;</span>;</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;        </div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;            <span class="keywordflow">if</span> ($index &lt; $count) {</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;                $next_card = $myself.strval($index + 1);</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;            }</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;            </div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;            <span class="keywordflow">if</span> ($index &gt; 1) {</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                $prev_card = $myself.strval($index - 1);</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;            }</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160; </div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&lt;table columns=&quot;3&quot;&gt;&lt;tr&gt;&#39;</span>;</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;            <span class="keywordflow">if</span> ($prev_card) {</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;small&gt;&lt;anchor&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_prev_card).<span class="stringliteral">&#39;&lt;go href=&quot;&#39;</span>.$prev_card.<span class="stringliteral">&#39;&quot;/&gt;&lt;/anchor&gt;&lt;/small&gt;&#39;</span>;</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;            }</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;td&gt;&#39;</span>;</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;            <span class="keywordflow">if</span> ($next_card) {</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;small&gt;&lt;anchor&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_next_card).<span class="stringliteral">&#39;&lt;go href=&quot;&#39;</span>.$next_card.<span class="stringliteral">&#39;&quot;/&gt;&lt;/anchor&gt;&lt;/small&gt;&#39;</span>;</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;            }</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;            </div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        }</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    </div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;p&gt;&lt;big&gt;&lt;strong&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;meeting_name&#39;</span>]).<span class="stringliteral">&#39;&lt;/strong&gt;&lt;/big&gt;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_weekdays[$meeting[<span class="stringliteral">&#39;weekday_tinyint&#39;</span>]]).<span class="charliteral">&#39; &#39;</span>.htmlspecialchars(date(<span class="stringliteral">&#39;g:i A&#39;</span>, strtotime($meeting[<span class="stringliteral">&#39;start_time&#39;</span>]))).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_text&#39;</span>]) {</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&lt;b&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_text&#39;</span>]).<span class="stringliteral">&#39;&lt;/b&gt;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        }</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;        </div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>;</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_street&#39;</span>]) {</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;            $ret .= htmlspecialchars($meeting[<span class="stringliteral">&#39;location_street&#39;</span>]);</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        }</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;        </div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;        <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_neighborhood&#39;</span>]) {</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;            $ret .= <span class="stringliteral">&#39; (&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_neighborhood&#39;</span>]).<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;        }</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        </div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_municipality&#39;</span>]) {</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_municipality&#39;</span>]);</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        </div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_province&#39;</span>]) {</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                $ret .= <span class="stringliteral">&#39;, &#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_province&#39;</span>]);</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;            }</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;            </div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_postal_code_1&#39;</span>]) {</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                $ret .= <span class="charliteral">&#39; &#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_postal_code_1&#39;</span>]);</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;            }</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        }</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;        </div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;        $distance = <span class="keyword">null</span>;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        </div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;        <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;distance_in_km&#39;</span>]) {</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;            $distance = round(((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span>) ? $meeting[<span class="stringliteral">&#39;distance_in_km&#39;</span>] : $meeting[<span class="stringliteral">&#39;distance_in_miles&#39;</span>]), 1);</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;            </div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;            $distance = strval($distance).<span class="charliteral">&#39; &#39;</span>.((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span> ) ? $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_kilometers) : $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_miles) );</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160; </div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&lt;b&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_distance).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.htmlspecialchars($distance).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;        }</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                                                        </div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;        <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_info&#39;</span>]) {</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_info&#39;</span>]).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        }</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                    </div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;        <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;comments&#39;</span>]) {</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;comments&#39;</span>]).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;        }</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        </div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;p&gt;&lt;b&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_formats).<span class="stringliteral">&#39;:&lt;/b&gt; &#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;formats&#39;</span>]).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;        </div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        $ret .= <span class="stringliteral">&#39;&lt;/card&gt;&#39;</span>;</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;        </div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    }</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160; </div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="comment">    *   \brief Runs the lookup.                                                             *</span></div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="comment">    *   \returns A string. The XHTML to be displayed.                                       *</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03072"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae994760bd6b6d4cf6ada2ccf06637211"> 3072</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ae994760bd6b6d4cf6ada2ccf06637211">BMLTPlugin_fast_mobile_lookup</a>()</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    {</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="comment">        /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="comment">        *   \brief Sorting Callback                                                             *</span></div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="comment">        *                                                                                       *</span></div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="comment">        *   This will sort meetings by weekday, then by distance, so the first meeting of any   *</span></div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="comment">        *   given weekday is the closest one, etc.                                              *</span></div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="comment">        *                                                                                       *</span></div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="comment">        *   \returns -1 if a &lt; b, 1, otherwise.                                                 *</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="comment">        ****************************************************************************************/</span></div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        <span class="keyword">function</span> mycmp(</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;            $in_a_meeting,  <span class="comment">///&lt; These are meeting data arrays. The elements we&#39;ll be checking will be &#39;weekday_tinyint&#39; and &#39;distance_in_XX&#39;.</span></div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment"></span>            $in_b_meeting</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        ) {</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;            $ret = 0;</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;            </div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;            <span class="keywordflow">if</span> ($in_a_meeting[<span class="stringliteral">&#39;weekday_tinyint&#39;</span>] != $in_b_meeting[<span class="stringliteral">&#39;weekday_tinyint&#39;</span>]) {</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;                $ret = ($in_a_meeting[<span class="stringliteral">&#39;weekday_tinyint&#39;</span>] &lt; $in_b_meeting[<span class="stringliteral">&#39;weekday_tinyint&#39;</span>]) ? -1 : 1;</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;                $dist_a = intval(round(strtolower(($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;mi&#39;</span>) ? $in_a_meeting[<span class="stringliteral">&#39;distance_in_miles&#39;</span>] : $in_a_meeting[<span class="stringliteral">&#39;distance_in_km&#39;</span>], 1) * 10);</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;                $dist_b = intval(round((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;mi&#39;</span>) ? $in_b_meeting[<span class="stringliteral">&#39;distance_in_miles&#39;</span>] : $in_b_meeting[<span class="stringliteral">&#39;distance_in_km&#39;</span>], 1) * 10);</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    </div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                <span class="keywordflow">if</span> ($dist_a != $dist_b) {</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;                    $ret = ($dist_a &lt; $dist_b) ? -1 : 1;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;                    $time_a = preg_replace(<span class="stringliteral">&#39;|:|&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $in_a_meeting[<span class="stringliteral">&#39;start_time&#39;</span>]);</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;                    $time_b = preg_replace(<span class="stringliteral">&#39;|:|&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $in_b_meeting[<span class="stringliteral">&#39;start_time&#39;</span>]);</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;                    $ret = ($time_a &lt; $time_b) ? -1 : 1;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;                }</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            }</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;            </div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;            <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;        }</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        $ret = self::BMLTPlugin_select_doctype($this-&gt;my_http_vars);</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;        $ret .= $this-&gt;BMLTPlugin_fast_mobile_lookup_header_stuff();   <span class="comment">// Add styles and/or JS, depending on the UA.</span></div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        $options = $this-&gt;getBMLTOptions_by_id($this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>]);</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;        $this-&gt;adapt_to_lang($options[<span class="stringliteral">&#39;lang&#39;</span>]);</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;        </div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;        <span class="comment">// If we are running XHTML, then JavaScript works. Let&#39;s see if we can figure out where we are...</span></div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;        <span class="comment">// If the client can handle JavaScript, then the whole thing can be done with JS, and there&#39;s no need for the driver.</span></div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        <span class="comment">// Also, if JS does not work, the form will ask us to do it &quot;the hard way&quot; (i.e. on the server).</span></div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;my_http_vars[<span class="stringliteral">&#39;address&#39;</span>] &amp;&amp; isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;do_search&#39;</span>]) &amp;&amp; (($this-&gt;my_http_vars[<span class="stringliteral">&#39;do_search&#39;</span>] == <span class="stringliteral">&#39;the hard way&#39;</span>) || (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) &amp;&amp; ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] == 1)))) {</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) || ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] != 1)) {   <span class="comment">// Regular XHTML requires a body element.</span></div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;body&gt;&#39;</span>;</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;            }</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;            </div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;            $this-&gt;my_driver-&gt;set_m_root_uri($options[<span class="stringliteral">&#39;root_server&#39;</span>]);</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;            $error = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;            </div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;            <span class="keywordflow">if</span> ($error) {</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;                <span class="keywordflow">if</span> (ob_get_level()) {</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;                    ob_end_clean(); <span class="comment">// Just in case we are in an OB</span></div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;                }</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;                die(<span class="stringliteral">&#39;&lt;h1&gt;ERROR (BMLTPlugin_fast_mobile_lookup: &#39;</span>.htmlspecialchars($error).<span class="stringliteral">&#39;)&lt;/h1&gt;&#39;</span>);</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;            }</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;            </div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;            $qualifier = strtolower(trim($this-&gt;my_http_vars[<span class="stringliteral">&#39;qualifier&#39;</span>]));</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;            </div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;            <span class="comment">// Do the search.</span></div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;            </div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;            <span class="keywordflow">if</span> ($this-&gt;my_http_vars[<span class="stringliteral">&#39;address&#39;</span>]) {</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;                $this-&gt;my_driver-&gt;set_current_transaction_parameter(<span class="stringliteral">&#39;SearchString&#39;</span>, $this-&gt;my_http_vars[<span class="stringliteral">&#39;address&#39;</span>]);</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                $error_message = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;                    $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;                    $this-&gt;my_driver-&gt;set_current_transaction_parameter(<span class="stringliteral">&#39;StringSearchIsAnAddress&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;                    $error_message = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;                    <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;                        $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;                        <span class="keywordflow">if</span> ($qualifier) {</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                            $weekdays = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;                            $h = 0;</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                            $m = 0;</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;                            $time = time() + ($options[<span class="stringliteral">&#39;time_offset&#39;</span>] * 60 * 60);</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                            $today = intval(date(<span class="stringliteral">&quot;w&quot;</span>, $time)) + 1;</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;                            <span class="comment">// We set the current time, minus the grace time. This allows us to be running late, yet still have the meeting listed.</span></div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                            list ( $h, $m ) = explode(<span class="charliteral">&#39;:&#39;</span>, date(<span class="stringliteral">&quot;G:i&quot;</span>, time() - ($options[<span class="stringliteral">&#39;grace_period&#39;</span>] * 60)));</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;                            <span class="keywordflow">if</span> ($qualifier == <span class="stringliteral">&#39;today&#39;</span>) {</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                                $weekdays = strval($today);</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;                                $weekdays = strval(($today &lt; 7) ? $today + 1 : 1);</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;                            }</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;                            $this-&gt;my_driver-&gt;set_current_transaction_parameter(<span class="stringliteral">&#39;weekdays&#39;</span>, array($weekdays));</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;                            $error_message = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;                            <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;                                $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;                                <span class="keywordflow">if</span> ($h || $m) {</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;                                    $this-&gt;my_driver-&gt;set_current_transaction_parameter(<span class="stringliteral">&#39;StartsAfterH&#39;</span>, $h);</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;                                    $error_message = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;                                    <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;                                        $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;                                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;                                        $this-&gt;my_driver-&gt;set_current_transaction_parameter(<span class="stringliteral">&#39;StartsAfterM&#39;</span>, $m);</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;                                        $error_message = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                                        <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;                                            $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;                                        }</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;                                    }</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;                                }</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;                            }</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;                        }</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;                        </div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;                        <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;                            $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;                            $this-&gt;my_driver-&gt;set_current_transaction_parameter(<span class="stringliteral">&#39;SearchStringRadius&#39;</span>, intval($options[<span class="stringliteral">&#39;default_geo_width&#39;</span>]));</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;                            $error_message = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;                            <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;                                $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;                            } <span class="keywordflow">else</span> <span class="comment">// The search is set up. Throw the switch, Igor! ...yeth...mawther....</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;                                {</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;                                $search_result = $this-&gt;my_driver-&gt;meeting_search();</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160; </div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;                                $error_message = $this-&gt;my_driver-&gt;get_m_error_message();</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;                                <span class="keywordflow">if</span> ($error_message) {</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;                                    $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_server_fail).<span class="stringliteral">&#39; &quot;&#39;</span>.htmlspecialchars($error_message).<span class="charliteral">&#39;&quot;&#39;</span>;</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;                                } elseif (isset($search_result) &amp;&amp; is_array($search_result) &amp;&amp; isset($search_result[<span class="stringliteral">&#39;meetings&#39;</span>])) {</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;                                    <span class="comment">// Yes! We have valid search data!</span></div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                                    <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) || ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] != 1)) {   <span class="comment">// Regular XHTML</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                                        $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;multi_meeting_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                                    }</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                                    </div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;                                    $index = 1;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                                    $count = count($search_result[<span class="stringliteral">&#39;meetings&#39;</span>]);</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;                                    usort($search_result[<span class="stringliteral">&#39;meetings&#39;</span>], <span class="stringliteral">&#39;mycmp&#39;</span>);</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;                                    <span class="keywordflow">if</span> (isset($_REQUEST[<span class="stringliteral">&#39;access_card&#39;</span>]) &amp;&amp; intval($_REQUEST[<span class="stringliteral">&#39;access_card&#39;</span>])) {</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;                                        $index = intval($_REQUEST[<span class="stringliteral">&#39;access_card&#39;</span>]);</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;                                    }</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;                                        </div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;                                    <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) || ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] != 1)) {   <span class="comment">// Regular XHTML</span></div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;                                        $index = 1;</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;                                        <span class="keywordflow">foreach</span> ($search_result[<span class="stringliteral">&#39;meetings&#39;</span>] as $meeting) {</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;div class=&quot;single_meeting_div&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;h1 class=&quot;meeting_name_h2&quot;&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;meeting_name&#39;</span>]).<span class="stringliteral">&#39;&lt;/h1&gt;&#39;</span>;</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;time_day_p&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_weekdays[$meeting[<span class="stringliteral">&#39;weekday_tinyint&#39;</span>]]).<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;                                            $time = explode(<span class="charliteral">&#39;:&#39;</span>, $meeting[<span class="stringliteral">&#39;start_time&#39;</span>]);</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;                                            $am_pm = <span class="stringliteral">&#39; AM&#39;</span>;</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;                                            $distance = <span class="keyword">null</span>;</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;                                            </div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;                                            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;distance_in_km&#39;</span>]) {</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;                                                $distance = round(((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span>) ? $meeting[<span class="stringliteral">&#39;distance_in_km&#39;</span>] : $meeting[<span class="stringliteral">&#39;distance_in_miles&#39;</span>]), 1);</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;                                                </div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;                                                $distance = strval($distance).<span class="charliteral">&#39; &#39;</span>.((strtolower($options[<span class="stringliteral">&#39;distance_units&#39;</span>]) == <span class="stringliteral">&#39;km&#39;</span> ) ? $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_kilometers) : $this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_miles) );</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;                                            }</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160; </div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;                                            $time[0] = intval($time[0]);</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;                                            $time[1] = intval($time[1]);</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;                                            </div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;                                            <span class="keywordflow">if</span> (($time[0] == 23) &amp;&amp; ($time[1] &gt; 50)) {</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;                                                $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_midnight);</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;                                            } elseif (($time[0] == 12) &amp;&amp; ($time[1] == 0)) {</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;                                                $ret .= $this-&gt;process_text($this-&gt;my_current_language-&gt;local_noon);</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;                                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;                                                <span class="keywordflow">if</span> (($time[0] &gt; 12) || (($time[0] == 12) &amp;&amp; ($time[1] &gt; 0))) {</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                                                    $am_pm = <span class="stringliteral">&#39; PM&#39;</span>;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                                                }</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                                                </div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;                                                <span class="keywordflow">if</span> ($time[0] &gt; 12) {</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;                                                    $time[0] -= 12;</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                                                }</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;                                            </div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;                                                <span class="keywordflow">if</span> ($time[1] &lt; 10) {</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;                                                    $time[1] = <span class="stringliteral">&quot;0$time[1]&quot;</span>;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;                                                }</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;                                                </div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;                                                $ret .= htmlspecialchars($time[0].<span class="charliteral">&#39;:&#39;</span>.$time[1].$am_pm);</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;                                            }</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;                                            </div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;                                            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_text&#39;</span>]) {</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;                                                $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;locations_text_p&quot;&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_text&#39;</span>]).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;                                            }</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;                                            </div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;street_p&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;                                            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_street&#39;</span>]) {</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;                                                $ret .= htmlspecialchars($meeting[<span class="stringliteral">&#39;location_street&#39;</span>]);</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;                                            }</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;                                            </div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;                                            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_neighborhood&#39;</span>]) {</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                                                $ret .= <span class="stringliteral">&#39;&lt;span class=&quot;neighborhood_span&quot;&gt; (&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_neighborhood&#39;</span>]).<span class="stringliteral">&#39;)&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;                                            }</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;                                            </div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;                                            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_municipality&#39;</span>]) {</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;                                                $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;town_p&quot;&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_municipality&#39;</span>]);</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;                                            </div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;                                                <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_province&#39;</span>]) {</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;span class=&quot;state_span&quot;&gt;, &#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_province&#39;</span>]).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;                                                }</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;                                                </div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;                                                <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_postal_code_1&#39;</span>]) {</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;span class=&quot;zip_span&quot;&gt; &#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_postal_code_1&#39;</span>]).<span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;                                                }</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                                                $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;                                                <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;p id=&quot;maplink_&#39;</span>.intval($meeting[<span class="stringliteral">&#39;id_bigint&#39;</span>]).<span class="stringliteral">&#39;&quot; style=&quot;display:none&quot;&gt;&#39;</span>;</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;                                                    $url = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160; </div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                                                    $comma = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;                                                    <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;meeting_name&#39;</span>]) {</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                                                        $url .= urlencode($meeting[<span class="stringliteral">&#39;meeting_name&#39;</span>]);</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                                                        $comma = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;                                                    }</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;                                                        </div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                                                    <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_text&#39;</span>]) {</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;                                                        $url .= ($comma ? <span class="stringliteral">&#39;,+&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).urlencode($meeting[<span class="stringliteral">&#39;location_text&#39;</span>]);</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                                                        $comma = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                                                    }</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;                                                    </div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                                                    <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_street&#39;</span>]) {</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;                                                        $url .= ($comma ? <span class="stringliteral">&#39;,+&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).urlencode($meeting[<span class="stringliteral">&#39;location_street&#39;</span>]);</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                                                        $comma = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                                                    }</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                                                    </div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                                                    <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_municipality&#39;</span>]) {</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                                                        $url .= ($comma ? <span class="stringliteral">&#39;,+&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).urlencode($meeting[<span class="stringliteral">&#39;location_municipality&#39;</span>]);</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                                                        $comma = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;                                                    }</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;                                                        </div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                                                    <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_province&#39;</span>]) {</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;                                                        $url .= ($comma ? <span class="stringliteral">&#39;,+&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).urlencode($meeting[<span class="stringliteral">&#39;location_province&#39;</span>]);</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;                                                    }</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;                                                    </div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;                                                    $gKey = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;        </div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;                                                    <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>]) &amp;&amp; (<span class="stringliteral">&#39;INVALID&#39;</span> != $options[<span class="stringliteral">&#39;google_api_key&#39;</span>])) {</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;                                                        $gKey = $options[<span class="stringliteral">&#39;google_api_key&#39;</span>];</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;                                                    }</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160; </div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;                                                    $url = <span class="stringliteral">&#39;https://maps.google.com/maps?key=&#39;</span>.$gKey.<span class="stringliteral">&#39;&amp;region=&#39;</span>.strtoupper($options[<span class="stringliteral">&#39;region_bias&#39;</span>]).<span class="stringliteral">&#39;&amp;q=&#39;</span>.urlencode($meeting[<span class="stringliteral">&#39;latitude&#39;</span>]).<span class="charliteral">&#39;,&#39;</span>.urlencode($meeting[<span class="stringliteral">&#39;longitude&#39;</span>]) . <span class="stringliteral">&#39;+(%22&#39;</span>.str_replace(<span class="stringliteral">&quot;%28&quot;</span>, <span class="charliteral">&#39;-&#39;</span>, str_replace(<span class="stringliteral">&quot;%29&quot;</span>, <span class="charliteral">&#39;-&#39;</span>, $url)).<span class="stringliteral">&#39;%22)&#39;</span>;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                                                    $url .= <span class="stringliteral">&#39;&amp;ll=&#39;</span>.urlencode($meeting[<span class="stringliteral">&#39;latitude&#39;</span>]).<span class="charliteral">&#39;,&#39;</span>.urlencode($meeting[<span class="stringliteral">&#39;longitude&#39;</span>]);</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;a rel=&quot;external nofollow&quot; accesskey=&quot;&#39;</span>.$index.<span class="stringliteral">&#39;&quot; href=&quot;&#39;</span>.htmlspecialchars($url).<span class="stringliteral">&#39;&quot; title=&quot;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;meeting_name&#39;</span>]).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_map_link).<span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;document.getElementById(\&#39;maplink_&#39;</span>.intval($meeting[<span class="stringliteral">&#39;id_bigint&#39;</span>]).<span class="charliteral">&#39;\&#39;</span>).style.display=\<span class="stringliteral">&#39;block\&#39;;var c_BMLTPlugin_settings_id = &#39;</span>.htmlspecialchars($this-&gt;my_http_vars[<span class="stringliteral">&#39;bmlt_settings_id&#39;</span>]).<span class="stringliteral">&#39;;&lt;/script&gt;&#39;</span>;</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160; </div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;                                                }</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;                                            }</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;                                                        </div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;                                            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;location_info&#39;</span>]) {</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;                                                $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;location_info_p&quot;&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;location_info&#39;</span>]).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;                                            }</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;                                                        </div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;                                            <span class="keywordflow">if</span> ($meeting[<span class="stringliteral">&#39;comments&#39;</span>]) {</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;                                                $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;comments_p&quot;&gt;&#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;comments&#39;</span>]).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;                                            }</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;                                            </div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                                            <span class="keywordflow">if</span> ($distance) {</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                                                $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;distance_p&quot;&gt;&lt;strong&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_distance).<span class="stringliteral">&#39;:&lt;/strong&gt; &#39;</span>.htmlspecialchars($distance).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                                            }</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;                                                </div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;p class=&quot;formats_p&quot;&gt;&lt;strong&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_formats).<span class="stringliteral">&#39;:&lt;/strong&gt; &#39;</span>.htmlspecialchars($meeting[<span class="stringliteral">&#39;formats&#39;</span>]).<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;                                            $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;                                            <span class="keywordflow">if</span> ($index++ &lt; $count) {</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;                                                <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;hr class=&quot;meeting_divider_hr&quot; /&gt;&#39;</span>;</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;                                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;                                                    $ret .= <span class="stringliteral">&#39;&lt;hr /&gt;&#39;</span>;</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;                                                }</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                                            }</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                                        }</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;                                    } <span class="keywordflow">else</span> <span class="comment">// WML 1 (yuch) We do this, because we need to limit the size of the pages to fit simple phones.</span></div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;                                        {</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;                                        $meetings = $search_result[<span class="stringliteral">&#39;meetings&#39;</span>];</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;                                        $indexed_array = array_values($meetings);</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;                                        $ret = $this-&gt;BMLTPlugin_render_card($ret, $index, $count, $indexed_array[$index - 1], <span class="keyword">false</span>);</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;                                    }</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                                    </div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;                                    <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) || ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] != 1)) {   <span class="comment">// Regular XHTML</span></div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;                                        $ret .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                                    }</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;                                    $ret .= <span class="stringliteral">&#39;&lt;h1 class=&quot;failed_search_h1&#39;</span>;</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                                    <span class="keywordflow">if</span> (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) &amp;&amp; $this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) {   <span class="comment">// We use a normally-positioned element in WML.</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;                                        $ret .= <span class="stringliteral">&#39;_wml&#39;</span>;</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;                                    }</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                                    $ret .= <span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_fail_no_meetings).<span class="stringliteral">&#39;&lt;/h1&gt;&#39;</span>;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;                                }</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;                            }</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;                        }</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;                    }</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;                }</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;                $ret .= <span class="stringliteral">&#39;&lt;h1 class=&quot;failed_search_h1&quot;&gt;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_address_alert).<span class="stringliteral">&#39;&lt;/h1&gt;&#39;</span>;</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;            }</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        } elseif (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;do_search&#39;</span>]) &amp;&amp; !((($this-&gt;my_http_vars[<span class="stringliteral">&#39;do_search&#39;</span>] == <span class="stringliteral">&#39;the hard way&#39;</span>) || (isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>]) &amp;&amp; ($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>] == 1))))) {</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            $ret .= <span class="stringliteral">&#39;&lt;body id=&quot;search_results_body&quot;&#39;</span>;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;            <span class="keywordflow">if</span> (!isset($this-&gt;my_http_vars[<span class="stringliteral">&#39;WML&#39;</span>])) {</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;                $ret .= <span class="stringliteral">&#39; onload=&quot;WhereAmI (\&#39;&#39;</span>.htmlspecialchars(strtolower(trim($this-&gt;my_http_vars[<span class="stringliteral">&#39;qualifier&#39;</span>]))).<span class="charliteral">&#39;\&#39;</span>,\<span class="stringliteral">&#39;&#39;</span>.htmlspecialchars(trim($this-&gt;my_http_vars[<span class="stringliteral">&#39;address&#39;</span>])).<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="stringliteral">            $ret .= &#39;&gt;&#39;;</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;<span class="stringliteral">            $ret .= $this-&gt;BMLTPlugin_fast_mobile_lookup_javascript_stuff();</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;div id=&quot;</span>location_finder<span class="stringliteral">&quot; class=&quot;</span>results_map_div<span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="stringliteral">            $url = $this-&gt;get_plugin_path();</span></div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="stringliteral">            $throbber_loc .= htmlspecialchars($url.&#39;themes/&#39;.$options[&#39;theme&#39;].&#39;/images/Throbber.gif&#39;);</span></div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;div class=&quot;</span>throbber_div<span class="stringliteral">&quot;&gt;&lt;img id=&quot;</span>throbber<span class="stringliteral">&quot; src=&quot;</span><span class="stringliteral">&#39;.htmlspecialchars($throbber_loc).&#39;</span><span class="stringliteral">&quot; alt=&quot;</span>AJAX Throbber<span class="stringliteral">&quot; /&gt;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;<span class="stringliteral">        } else {</span></div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;<span class="stringliteral">            if (!isset($this-&gt;my_http_vars[&#39;WML&#39;]) || ($this-&gt;my_http_vars[&#39;WML&#39;] != 1)) {</span></div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;body id=&quot;</span>search_form_body<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;<span class="stringliteral">                if (!isset($this-&gt;my_http_vars[&#39;WML&#39;])) {</span></div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;<span class="stringliteral">                    $ret .= &#39; onload=&quot;</span><span class="keywordflow">if</span>( (typeof ( navigator ) == \<span class="stringliteral">&#39;object\&#39; &amp;amp;&amp;amp; typeof ( navigator.geolocation ) == \&#39;object\&#39;) || (window.blackberry &amp;amp;&amp;amp; blackberry.location.GPSSupported) || (typeof ( google ) == \&#39;object\&#39; &amp;amp;&amp;amp; typeof ( google.gears ) == \&#39;object\&#39;) ){document.getElementById ( \&#39;hidden_until_js\&#39; ).style.display = \&#39;block\&#39;;document.getElementById ( \&#39;hidden_until_js2\&#39; ).style.display = \&#39;block\&#39;;};document.getElementById(\&#39;address_input\&#39;).value=\&#39;&#39;</span>.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_enter_an_address).<span class="charliteral">&#39;\&#39;</span><span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="stringliteral">                $ret .= &#39;&gt;&#39;;</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;div class=&quot;</span>search_div<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;<span class="stringliteral">                if (!isset($this-&gt;my_http_vars[&#39;WML&#39;])) {</span></div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;<span class="stringliteral">                    $ret .= &#39; cellpadding=&quot;</span>0<span class="stringliteral">&quot; cellspacing=&quot;</span>0<span class="stringliteral">&quot; border=&quot;</span>0<span class="stringliteral">&quot;&#39;;</span></div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;<span class="stringliteral">                $ret .= &#39;&gt;&#39;;</span></div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;div class=&quot;</span>GPS_lookup_row_div<span class="stringliteral">&quot;&gt;&lt;div&gt;&#39;;</span></div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;<span class="stringliteral">                if (!isset($this-&gt;my_http_vars[&#39;WML&#39;])) {</span></div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;<span class="stringliteral">                    $ret .= $this-&gt;BMLTPlugin_draw_map_search_form();</span></div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;/div&gt;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;div&gt;&lt;div&gt;&#39;;</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="stringliteral">                $ret .= $this-&gt;BMLTPlugin_draw_address_search_form();</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#39;;</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;<span class="stringliteral">            } else {</span></div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;card title=&quot;</span><span class="stringliteral">&#39;.$this-&gt;process_text($this-&gt;my_current_language-&gt;local_mobile_results_form_title).&#39;</span><span class="stringliteral">&quot;&gt;&#39;;</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;<span class="stringliteral">                $ret .= $this-&gt;BMLTPlugin_draw_address_search_form();</span></div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;<span class="stringliteral">                $ret .= &#39;&lt;/card&gt;&#39;;</span></div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;<span class="stringliteral">        if (!isset($this-&gt;my_http_vars[&#39;WML&#39;]) || ($this-&gt;my_http_vars[&#39;WML&#39;] != 1)) {</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/body&gt;&#39;;  // Wrap up the page.</span></div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/html&gt;&#39;;</span></div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;<span class="stringliteral">            if (isset($this-&gt;my_http_vars[&#39;WML&#39;]) &amp;&amp; ($this-&gt;my_http_vars[&#39;WML&#39;] == 2)) {</span></div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;<span class="stringliteral">                $ret = &quot;</span>&lt;<span class="stringliteral">&quot;.&quot;</span>?xml version=<span class="stringliteral">&#39;1.0&#39;</span> encoding=<span class="stringliteral">&#39;UTF-8&#39;</span> ?<span class="stringliteral">&quot;.&quot;</span>&gt;<span class="stringliteral">&quot;.$ret;</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;<span class="stringliteral">                header(&#39;Content-type: application/xhtml+xml&#39;);</span></div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="stringliteral">        } else {</span></div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="stringliteral">            $ret .= &#39;&lt;/wml&gt;&#39;;</span></div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="stringliteral">            header(&#39;Content-type: text/vnd.wap.wml&#39;);</span></div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="stringliteral">    *                                    THE CONSTRUCTOR                                    *</span></div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;<span class="stringliteral">    *   \brief Constructor. Enforces the SINGLETON, and sets up the callbacks.              *</span></div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;<span class="stringliteral">    *   You will need to make sure that you call this with a parent::__construct() call.    *</span></div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a095c5d389db211932136b53f25f39685"> 3426</a></span>&#160;<span class="stringliteral">    public function __construct()</span></div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;<span class="stringliteral">    {</span></div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;<span class="stringliteral">        if (!isset(self::$g_s_there_can_only_be_one) || (self::$g_s_there_can_only_be_one === null)) {</span></div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;<span class="stringliteral">            self::$g_s_there_can_only_be_one = $this;</span></div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;<span class="stringliteral">            $options = $this-&gt;getBMLTOptions_by_id($this-&gt;my_http_vars[&#39;bmlt_settings_id&#39;]);</span></div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;<span class="stringliteral">            $this-&gt;my_http_vars = array_merge_recursive($_GET, $_POST);</span></div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;<span class="stringliteral">                </span></div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;<span class="stringliteral">            if (!(isset($this-&gt;my_http_vars[&#39;search_form&#39;]) &amp;&amp; $this-&gt;my_http_vars[&#39;search_form&#39;] )</span></div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;<span class="stringliteral">                &amp;&amp; !(isset($this-&gt;my_http_vars[&#39;do_search&#39;]) &amp;&amp; $this-&gt;my_http_vars[&#39;do_search&#39;] )</span></div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;<span class="stringliteral">                &amp;&amp; !(isset($this-&gt;my_http_vars[&#39;single_meeting_id&#39;]) &amp;&amp; $this-&gt;my_http_vars[&#39;single_meeting_id&#39;] )</span></div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;<span class="stringliteral">                ) {</span></div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;<span class="stringliteral">                $this-&gt;my_http_vars[&#39;search_form&#39;] = true;</span></div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="stringliteral">            $this-&gt;my_http_vars[&#39;script_name&#39;] = preg_replace(&#39;|(.*?)\?.*|&#39;, &quot;</span>$1<span class="stringliteral">&quot;, $_SERVER[&#39;REQUEST_URI&#39;]);</span></div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;<span class="stringliteral">            $this-&gt;my_http_vars[&#39;satellite&#39;] = $this-&gt;my_http_vars[&#39;script_name&#39;];</span></div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="stringliteral">            $this-&gt;my_http_vars[&#39;supports_ajax&#39;] = &#39;yes&#39;;</span></div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="stringliteral">            $this-&gt;my_http_vars[&#39;no_ajax_check&#39;] = &#39;yes&#39;;</span></div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;<span class="stringliteral">            // We need to start off by setting up our driver.</span></div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;<span class="stringliteral">            $this-&gt;my_driver = new bmlt_satellite_controller;</span></div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;<span class="stringliteral">            global $bmlt_localization;</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="stringliteral">            $this-&gt;adapt_to_lang($bmlt_localization);</span></div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="stringliteral">            if ($this-&gt;my_driver instanceof bmlt_satellite_controller) {</span></div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="stringliteral">                $this-&gt;set_callbacks(); // Set up the various callbacks and whatnot.</span></div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;<span class="stringliteral">            } else {</span></div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="stringliteral">                echo &quot;</span>&lt;!-- <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html">BMLTPlugin</a> ERROR (__construct)! Can<span class="stringliteral">&#39;t Instantiate the Satellite Driver! Please reinstall the plugin! --&gt;&quot;;</span></div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;<span class="stringliteral">        } else {</span></div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;<span class="stringliteral">            echo &quot;&lt;!-- BMLTPlugin Warning: __construct() called multiple times! --&gt;&quot;;</span></div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;<span class="stringliteral">    *                            THE CMS-SPECIFIC FUNCTIONS                                 *</span></div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;<span class="stringliteral">    * These may be overridden by the subclasses. Some are required to be overridden.        *</span></div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;<span class="stringliteral">    *   \brief This function fetches the settings ID for a page (if there is one).          *</span></div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;<span class="stringliteral">    *   If $in_check_mobile is set to true, then ONLY a check for mobile support will be    *</span></div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;<span class="stringliteral">    *   made, and no other shortcodes will be checked.                                      *</span></div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;<span class="stringliteral">    *                                                                                       *</span></div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;<span class="stringliteral">    *   \returns a mixed type, with the settings ID.                                        *</span></div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;<span class="stringliteral">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;<span class="stringliteral">    // phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03479"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a367942fcb87133bd531708f65270dbdd"> 3479</a></span>&#160;<span class="stringliteral">    protected function cms_get_page_settings_id(</span></div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;<span class="stringliteral">        $in_content,               ///&lt; Required (for the base version) content to check.</span></div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;<span class="stringliteral">        $in_check_mobile = false   ///&lt; True if this includes a check for mobile. Default is false.</span></div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="stringliteral">    ) {</span></div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;<span class="stringliteral">        // phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="stringliteral">        $my_option_id = null;</span></div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;<span class="stringliteral">        if ($in_content) {  // The default version requires content.</span></div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;<span class="stringliteral">            // We only return a mobile ID if we have the shortcode, we&#39;</span>re asked <span class="keywordflow">for</span> it, we<span class="stringliteral">&#39;re not already handling mobile, and we have a mobile UA.</span></div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;<span class="stringliteral">            if ($in_check_mobile &amp;&amp; !isset($this-&gt;my_http_vars[&#39;</span>BMLTPlugin_mobile<span class="stringliteral">&#39;]) &amp;&amp; (self::mobile_sniff_ua($this-&gt;my_http_vars) != &#39;</span>xhtml<span class="stringliteral">&#39;) &amp;&amp; ($params = self::get_shortcode($in_content, &#39;</span>bmlt_mobile<span class="stringliteral">&#39;))) {</span></div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;<span class="stringliteral">                if ($params === true) { // If no mobile settings number was provided, we use the default.</span></div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;<span class="stringliteral">                    $options = $this-&gt;getBMLTOptions(1);</span></div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;<span class="stringliteral">                    $my_option_id = strval($options[&#39;</span><span class="keywordtype">id</span><span class="stringliteral">&#39;]);</span></div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;<span class="stringliteral">                } else {</span></div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;<span class="stringliteral">                    $my_option_id = $params;</span></div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;<span class="stringliteral">            } elseif (!$in_check_mobile) { // A mobile check ignores the rest.</span></div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;<span class="stringliteral">                if (($params = self::get_shortcode($in_content, &#39;</span>bmlt_table<span class="stringliteral">&#39;)) || ($params = self::get_shortcode($in_content, &#39;</span>bmlt_simple<span class="stringliteral">&#39;)) || ($params = self::get_shortcode($in_content, &#39;</span>bmlt_changes<span class="stringliteral">&#39;))) {</span></div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;<span class="stringliteral">                    $param_array = explode(&#39;</span>##-##<span class="stringliteral">&#39;, $params);</span></div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;<span class="stringliteral">                    </span></div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;<span class="stringliteral">                    if (is_array($param_array) &amp;&amp; (count($param_array) &gt; 1)) {</span></div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;<span class="stringliteral">                        $my_option_id = $param_array[0];</span></div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;<span class="stringliteral">                    }</span></div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;<span class="stringliteral">                if ($params = self::get_shortcode($in_content, &#39;</span>bmlt<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;<span class="stringliteral">                    $my_option_id = ( $params !== true ) ? $params : $my_option_id;</span></div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;<span class="stringliteral">                if ($params = self::get_shortcode($in_content, &#39;</span>bmlt_map<span class="stringliteral">&#39;)) {</span></div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;<span class="stringliteral">                    $my_option_id = ( $params !== true ) ? $params : $my_option_id;</span></div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;<span class="stringliteral">                }</span></div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;<span class="stringliteral">        return $my_option_id;</span></div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;<span class="stringliteral">    }</span></div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;<span class="stringliteral">    /************************************************************************************//**</span></div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;<span class="stringliteral">    *   \brief  Process the given string.                                                   *</span></div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;<span class="stringliteral">    *           NOTE: A good start has been given, but there&#39;</span>s a very good chance <span class="keyword">this</span> will *</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    *           need to be overridden.                                                      *</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    *                                                                                       *</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    *   This allows easier translation of displayed strings. All strings displayed by the   *</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    *   plugin should go through <span class="keyword">this</span> <span class="keyword">function</span>.                                             *</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    *                                                                                       *</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    *   \returns a <span class="keywordtype">string</span>, processed by the CMS.                                            *</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    ****************************************************************************************/</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03528"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8"> 3528</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> process_text($in_string) <span class="comment">///&lt; The string to be processed.</span></div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;<span class="comment"></span>    {</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;        <span class="keywordflow">return</span> htmlspecialchars($in_string);</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    }</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;    </div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;<span class="comment">    *   \brief  Return an HTTP path to the AJAX callback target.                            *</span></div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;<span class="comment">    *           NOTE: A good start has been given, but there&#39;s a very good chance this will *</span></div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;<span class="comment">    *           need to be overridden.                                                      *</span></div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;<span class="comment">    *   \returns a string, containing the path.                                             *</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03542"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2ec9128b33a7be56796daf9626f730b1"> 3542</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a2ec9128b33a7be56796daf9626f730b1">get_ajax_base_uri</a>()</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    {</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;        <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;        <span class="comment">// We try to account for SSL and unusual TCP ports.</span></div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;        $port = <span class="keyword">null</span>;</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;        $https = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;        $from_proxy = array_key_exists(<span class="stringliteral">&quot;HTTP_X_FORWARDED_PROTO&quot;</span>, $_SERVER);</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;        <span class="keywordflow">if</span> ($from_proxy) {</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;            <span class="comment">// If the port is specified in the header, use it. If not, default to 80</span></div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;            <span class="comment">// for http and 443 for https. We can&#39;t trust what&#39;s in $_SERVER[&#39;SERVER_PORT&#39;]</span></div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;            <span class="comment">// because something in front of the server is fielding the request.</span></div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;            $https = $_SERVER[<span class="stringliteral">&#39;HTTP_X_FORWARDED_PROTO&#39;</span>] == <span class="stringliteral">&#39;https&#39;</span>;</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;            <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&quot;HTTP_X_FORWARDED_PORT&quot;</span>, $_SERVER)) {</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;                $port = intval($_SERVER[<span class="stringliteral">&#39;HTTP_X_FORWARDED_PORT&#39;</span>]);</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;            } elseif ($https) {</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;                $port = 443;</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;                $port = 80;</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;            }</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;            $port = $_SERVER[<span class="stringliteral">&#39;SERVER_PORT&#39;</span>];</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;            <span class="comment">// IIS puts &quot;off&quot; in the HTTPS field, so we need to test for that.</span></div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;            $https = (!empty($_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>]) &amp;&amp; (($_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] !== <span class="stringliteral">&#39;off&#39;</span>) || ($port == 443)));</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;        }</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160; </div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;        <span class="comment">// This implements an &quot;emergency&quot; override&quot; of the standard port system.</span></div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;        <span class="comment">// In some servers, a misconfiguration could report an improper port for HTTPS.</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;        <span class="comment">// In this case, the server admin could define BMLT_HTTPS_PORT to be the integer TCP port to use for HTTPS.</span></div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        <span class="comment">// If specified, it would be used instead of whatever port is being reported by the server.</span></div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        <span class="comment">// Example:</span></div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;        <span class="comment">// define ( &#39;BMLT_HTTPS_PORT&#39;, 443 );</span></div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;        <span class="comment">// in the wp-config file.</span></div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;        $port = ($https &amp;&amp; defined(BMLT_HTTPS_PORT) &amp;&amp; BMLT_HTTPS_PORT) ? BMLT_HTTPS_PORT : $port;</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160; </div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        $server_path = $_SERVER[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>];</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;        $my_path = $_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>];</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;        $server_path .= trim((($https &amp;&amp; ($port != 443)) || (!$https &amp;&amp; ($port != 80))) ? <span class="charliteral">&#39;:&#39;</span>.$port : <span class="stringliteral">&#39;&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;        $server_path = <span class="stringliteral">&#39;http&#39;</span>.($https ? <span class="charliteral">&#39;s&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;://&#39;</span>.$server_path.$my_path;</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        <span class="keywordflow">return</span> $server_path;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;    }</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160; </div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;<span class="comment">    *   \brief  Sets up the admin and handler callbacks. Override this for your CMS.        *</span></div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;<span class="comment">    *           NOTE: This may be ignored, but most CMSes have a system of callbacks, and   *</span></div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;<span class="comment">    *           this function is a good place to establish those callbacks.                 *</span></div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;<span class="comment">    *           It is called at the end of the base class constructor.                      *</span></div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03590"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a1eaa95952cb44563404135e5094cbe59"> 3590</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a1eaa95952cb44563404135e5094cbe59">set_callbacks</a>()</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;    {</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;    }</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;    <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;<span class="comment">    *   \brief Return an HTTP path to the AJAX callback target for the mobile handler.      *</span></div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;<span class="comment">    *   \returns a string, containing the path. Defaults to the base URI.                   *</span></div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03600"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab4db9c2bb0aff632596417f80ccb7913"> 3600</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ab4db9c2bb0aff632596417f80ccb7913">get_ajax_mobile_base_uri</a>()</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    {</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;        <span class="keywordflow">return</span> $this-&gt;get_ajax_base_uri();</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;    }</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;    <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;<span class="comment">    *   \brief Return an HTTP path to the AJAX callback target.                             *</span></div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;<span class="comment">    *   \returns a string, containing the path.                                             *</span></div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03611"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#adafc10def2d2eda57f61c7e0dcda4ec0"> 3611</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#adafc10def2d2eda57f61c7e0dcda4ec0">get_admin_ajax_base_uri</a>()</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;    {</div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;        <span class="keywordflow">return</span> $this-&gt;get_ajax_base_uri();</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;    }</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;    <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;<span class="comment">    *   \brief Return an HTTP path to the basic admin form submit (action) URI              *</span></div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="comment">    *   \returns a string, containing the path.                                             *</span></div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03622"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#ace02e9ba01513e74e7c6e6f261534a6a"> 3622</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#ace02e9ba01513e74e7c6e6f261534a6a">get_admin_form_uri</a>()</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;    {</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;        <span class="keywordflow">return</span> $this-&gt;get_ajax_base_uri();</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;    }</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;    <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;<span class="comment">    *   \brief  Return an HTTP path to the plugin directory.                                *</span></div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;<span class="comment">    *           NOTE: A good start has been given, but there&#39;s a very good chance this will *</span></div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;<span class="comment">    *           need to be overridden.                                                      *</span></div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;<span class="comment">    *   \returns a string, containing the path.                                             *</span></div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03635"></a><span class="lineno"><a class="line" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4005e57d7b24559e6731ed4108cfff46"> 3635</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#a4005e57d7b24559e6731ed4108cfff46">get_plugin_path</a>()</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    {</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;        <span class="keywordflow">return</span> dirname($this-&gt;get_ajax_base_uri());</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;    }</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;<span class="comment">    *                      ABSTRACT (REQUIRED OVERRIDE) FUNCTIONS                           *</span></div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160; </div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;<span class="comment">    *   \brief This gets the admin options from the database (allows CMS abstraction).      *</span></div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;<span class="comment">    *                                                                                       *</span></div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;<span class="comment">    *   \returns an associative array, with the option settings.                            *</span></div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> cms_get_option($in_option_key); <span class="comment">///&lt; The key for the option</span></div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;<span class="comment"></span>    <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;<span class="comment">    *   \brief This gets the admin options from the database (allows CMS abstraction).      *</span></div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;    <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> cms_set_option(</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;        $in_option_key,   <span class="comment">///&lt; The name of the option</span></div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;<span class="comment"></span>        $in_option_value  <span class="comment">///&lt; the values to be set (associative array)</span></div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;<span class="comment"></span>    );</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;    <span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;<span class="comment">    /************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;<span class="comment">    *   \brief Deletes a stored option (allows CMS abstraction).                            *</span></div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;<span class="comment">    ****************************************************************************************/</span></div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;    <span class="comment">// phpcs:disable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> cms_delete_option($in_option_key); <span class="comment">///&lt; The key for the option</span></div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;<span class="comment"></span>}</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;<span class="comment">// phpcs:enable PSR1.Methods.CamelCapsMethodName.NotCamelCaps</span></div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;<span class="comment">/***********************************************************************/</span><span class="comment"></span></div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;<span class="comment">/** \brief  This is an open-source JSON encoder that allows us to support</span></div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;<span class="comment">    older versions of PHP (before the &lt;a href=&quot;http://us3.php.net/json_encode&quot;&gt;json_encode()&lt;/a&gt; function</span></div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;<span class="comment">    was implemented). It uses json_encode() if that function is available.</span></div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;<span class="comment">    This is from &lt;a href=&quot;http://www.bin-co.com/php/scripts/array2json/&quot;&gt;Bin-Co.com&lt;/a&gt;.</span></div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;<span class="comment">    This crap needs to be included to be aboveboard and legal. You can still re-use the code, but</span></div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;<span class="comment">    you need to make sure that the comments below this are included:</span></div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;<span class="comment">    Copyright (c) 2004-2007, Binny V Abraham</span></div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;<span class="comment">    All rights reserved.</span></div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;<span class="comment">    Redistribution and use in source and binary forms, with or without modification, are permitted provided</span></div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;<span class="comment">    that the following conditions are met:</span></div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;<span class="comment">    *   Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;<span class="comment">    *   Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer</span></div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;<span class="comment">        in the documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;<span class="comment">    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,</span></div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="comment">    BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;<span class="comment">    IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,</span></div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;<span class="comment">    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;<span class="comment">    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span></div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;<span class="comment">    OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,</span></div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="comment">    EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l03698"></a><span class="lineno"><a class="line" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a4f3b79fa543abc31ad742043cde753cc"> 3698</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a4f3b79fa543abc31ad742043cde753cc">array2json</a>(</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;    $arr    <span class="comment">///&lt; An associative string, to be encoded as JSON.</span></div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="comment"></span>) {</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;    <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;json_encode&#39;</span>)) {</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;        <span class="keywordflow">return</span> json_encode($arr); <span class="comment">//Lastest versions of PHP already has this functionality.</span></div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;    }</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;    </div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;    $parts = array();</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;    $is_list = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160; </div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    <span class="comment">//Find out if the given array is a numerical array</span></div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;    $keys = array_keys($arr);</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;    $max_length = count($arr)-1;</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;    <span class="keywordflow">if</span> (($keys[0] == 0) and ($keys[$max_length] == $max_length)) {<span class="comment">//See if the first key is 0 and last key is length - 1</span></div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;        $is_list = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;        <span class="keywordflow">for</span> ($i=0; $i&lt;count($keys); $i++) { <span class="comment">//See if each key correspondes to its position</span></div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;            <span class="keywordflow">if</span> ($i != $keys[$i]) { <span class="comment">//A key fails at position check.</span></div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;                $is_list = <span class="keyword">false</span>; <span class="comment">//It is an associative array.</span></div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;            }</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;        }</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;    }</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160; </div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;    <span class="keywordflow">foreach</span> ($arr as $key =&gt; $value) {</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;        <span class="keywordflow">if</span> (is_array($value)) { <span class="comment">//Custom handling for arrays</span></div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;            <span class="keywordflow">if</span> ($is_list) {</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                $parts[] = <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a4f3b79fa543abc31ad742043cde753cc">array2json</a>($value); <span class="comment">/* :RECURSION: */</span></div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;                $parts[] = <span class="charliteral">&#39;&quot;&#39;</span> . $key . <span class="stringliteral">&#39;&quot;:&#39;</span> . <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a4f3b79fa543abc31ad742043cde753cc">array2json</a>($value); <span class="comment">/* :RECURSION: */</span></div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;            }</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;            $str = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;            <span class="keywordflow">if</span> (!$is_list) {</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;                $str = <span class="charliteral">&#39;&quot;&#39;</span> . $key . <span class="stringliteral">&#39;&quot;:&#39;</span>;</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;            }</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160; </div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;            <span class="comment">//Custom handling for multiple data types</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;            <span class="keywordflow">if</span> (is_numeric($value)) {</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;                $str .= $value; <span class="comment">//Numbers</span></div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;            } elseif ($value === <span class="keyword">false</span>) {</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;                $str .= <span class="stringliteral">&#39;false&#39;</span>; <span class="comment">//The booleans</span></div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;            } elseif ($value === <span class="keyword">true</span>) {</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;                $str .= <span class="stringliteral">&#39;true&#39;</span>;</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;            } elseif (isset($value) &amp;&amp; $value) {</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;                $str .= <span class="charliteral">&#39;&quot;&#39;</span> . addslashes($value) . <span class="charliteral">&#39;&quot;&#39;</span>; <span class="comment">//All other things</span></div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;            }</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;            <span class="comment">// :TODO: Is there any more datatype we should be in the lookout for? (Object?)</span></div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160; </div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;            $parts[] = $str;</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;        }</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;    }</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;    </div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;    $json = implode(<span class="charliteral">&#39;,&#39;</span>, $parts);</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;    </div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;    <span class="keywordflow">if</span> ($is_list) {</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;        <span class="keywordflow">return</span> <span class="charliteral">&#39;[&#39;</span> . $json . <span class="charliteral">&#39;]&#39;</span>; <span class="comment">//Return numerical JSON</span></div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;        <span class="keywordflow">return</span> <span class="charliteral">&#39;{&#39;</span> . $json . <span class="charliteral">&#39;}&#39;</span>; <span class="comment">//Return associative JSON</span></div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;    }</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;}</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160; </div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;<span class="comment">/************************************************************************************/</span><span class="comment">/**</span></div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="comment">*   \brief Very quick check for mobile client.                                          *</span></div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;<span class="comment">*   \returns a Boolean. TRUE, if the client is mobile.                                  *</span></div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;<span class="comment">****************************************************************************************/</span></div>
<div class="line"><a name="l03763"></a><span class="lineno"><a class="line" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a946f54548ee39cabe67d3b0281f5d570"> 3763</a></span>&#160;<span class="keyword">function</span> <a class="code" href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a946f54548ee39cabe67d3b0281f5d570">BMLTPlugin_weAreMobile</a>($in_http_vars)   <span class="comment">///&lt; The HTTP query variables, as an associative array.</span></div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;<span class="comment"></span>{</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;    $language = <a class="code" href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9692cb961016e56fb3f601358690402">BMLTPlugin::mobile_sniff_ua</a>($in_http_vars);</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;    <span class="keywordflow">return</span> ($language == <span class="stringliteral">&#39;wml&#39;</span>) || ($language == <span class="stringliteral">&#39;xhtml_mp&#39;</span>) || ($language == <span class="stringliteral">&#39;smartphone&#39;</span>);</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a44ffa57befc9aca51db2f32efecc4068"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a44ffa57befc9aca51db2f32efecc4068">BMLTPlugin\$default_time_offset</a></div><div class="ttdeci">static $default_time_offset</div><div class="ttdoc">The default time offset from the main server (in hours).</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00162">bmlt-cms-satellite-plugin.php:162</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ad6f1e854890aefe25d9f444888038526"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ad6f1e854890aefe25d9f444888038526">BMLTPlugin\$default_military_time</a></div><div class="ttdeci">static $default_military_time</div><div class="ttdoc">If this is true, then time displays will be in military time.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00163">bmlt-cms-satellite-plugin.php:163</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a4e59c6b75babaf5435e0629cdcf615a4"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a4e59c6b75babaf5435e0629cdcf615a4">BMLTPlugin\getBMLTOptions_by_id</a></div><div class="ttdeci">getBMLTOptions_by_id( $in_option_id, &amp;$out_option_number=null)</div><div class="ttdoc">This gets the admin options from the database, but by using the option id. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00536">bmlt-cms-satellite-plugin.php:536</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_abbe28db42855eeace180661bf40b4918"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#abbe28db42855eeace180661bf40b4918">BMLTPlugin\$default_language</a></div><div class="ttdeci">static $default_language</div><div class="ttdoc">The default language is English, but the root server can override.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00158">bmlt-cms-satellite-plugin.php:158</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ab1fc65da1604c87720d0733db51d3a7d"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ab1fc65da1604c87720d0733db51d3a7d">BMLTPlugin\$my_http_vars</a></div><div class="ttdeci">$my_http_vars</div><div class="ttdoc">This will hold all of the query arguments.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00181">bmlt-cms-satellite-plugin.php:181</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ace02e9ba01513e74e7c6e6f261534a6a"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ace02e9ba01513e74e7c6e6f261534a6a">BMLTPlugin\get_admin_form_uri</a></div><div class="ttdeci">get_admin_form_uri()</div><div class="ttdoc">Return an HTTP path to the basic admin form submit (action) URI * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03622">bmlt-cms-satellite-plugin.php:3622</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_af84d279510d45450853cf8274b5a9093"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#af84d279510d45450853cf8274b5a9093">BMLTPlugin\$default_location_services</a></div><div class="ttdeci">static $default_location_services</div><div class="ttdoc">This tells the new default implementation whether or not location services should be available only f...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00153">bmlt-cms-satellite-plugin.php:153</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a1737248d47e30fd50361ec549cf4e1da"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a1737248d47e30fd50361ec549cf4e1da">BMLTPlugin\BMLTPlugin_map_search_global_javascript_stuff</a></div><div class="ttdeci">BMLTPlugin_map_search_global_javascript_stuff($in_options_id)</div><div class="ttdoc">This returns the global JavaScript stuff for the new map search that only * only needs to be loaded o...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02365">bmlt-cms-satellite-plugin.php:2365</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a161b35c445db3bb7d3ec0a59c592aec3"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a161b35c445db3bb7d3ec0a59c592aec3">BMLTPlugin\BMLTPlugin_map_search_search_options</a></div><div class="ttdeci">BMLTPlugin_map_search_search_options( $in_options_id, $in_uid)</div><div class="ttdoc">This returns a div of search options to be applied to the map search. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02298">bmlt-cms-satellite-plugin.php:2298</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_aa9692cb961016e56fb3f601358690402"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9692cb961016e56fb3f601358690402">BMLTPlugin\mobile_sniff_ua</a></div><div class="ttdeci">static mobile_sniff_ua($in_http_vars)</div><div class="ttdoc">Checks the UA of the caller, to see if it should return XHTML Strict or WML. *NOTE: This is very,...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00324">bmlt-cms-satellite-plugin.php:324</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_aa9d66d0122d728fc8e728a2dba0a1cbb"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#aa9d66d0122d728fc8e728a2dba0a1cbb">BMLTPlugin\get_params</a></div><div class="ttdeci">static get_params($in_array)</div><div class="ttdoc">Loads a parameter list. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00245">bmlt-cms-satellite-plugin.php:245</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_abc2edf681c16556ae82002b2403eaef8"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#abc2edf681c16556ae82002b2403eaef8">BMLTPlugin\process_text</a></div><div class="ttdeci">process_text($in_string)</div><div class="ttdoc">Process the given string. * NOTE: A good start has been given, but there's a very good chance this wi...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03528">bmlt-cms-satellite-plugin.php:3528</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ab93ea4f1aef8490a0021a15e11d04212"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ab93ea4f1aef8490a0021a15e11d04212">BMLTPlugin\delete_options_by_id</a></div><div class="ttdeci">delete_options_by_id($in_option_id)</div><div class="ttdoc">Deletes the options by ID. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00749">bmlt-cms-satellite-plugin.php:749</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a16a306c8ecefdcda1d43b018b5e1a22f"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a16a306c8ecefdcda1d43b018b5e1a22f">BMLTPlugin\$my_params</a></div><div class="ttdeci">$my_params</div><div class="ttdoc">This will contain the $this-&gt;my_http_vars and $_POST query variables.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00180">bmlt-cms-satellite-plugin.php:180</a></div></div>
<div class="ttc" id="abmlt-cms-satellite-plugin_8php_html_a946f54548ee39cabe67d3b0281f5d570"><div class="ttname"><a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a946f54548ee39cabe67d3b0281f5d570">BMLTPlugin_weAreMobile</a></div><div class="ttdeci">BMLTPlugin_weAreMobile($in_http_vars)</div><div class="ttdoc">Very quick check for mobile client. *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03763">bmlt-cms-satellite-plugin.php:3763</a></div></div>
<div class="ttc" id="abmlt-cms-satellite-plugin_8php_html_af8c5c5b860fc4c8825693dbc0f14a6c8"><div class="ttname"><a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#af8c5c5b860fc4c8825693dbc0f14a6c8">$tmp_local</a></div><div class="ttdeci">$tmp_local</div><div class="ttdoc">This will hold the selected language as we test for an explicit one.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00075">bmlt-cms-satellite-plugin.php:75</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a1eaa95952cb44563404135e5094cbe59"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a1eaa95952cb44563404135e5094cbe59">BMLTPlugin\set_callbacks</a></div><div class="ttdeci">set_callbacks()</div><div class="ttdoc">Sets up the admin and handler callbacks. Override this for your CMS. * NOTE: This may be ignored,...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03590">bmlt-cms-satellite-plugin.php:3590</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_adafc10def2d2eda57f61c7e0dcda4ec0"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#adafc10def2d2eda57f61c7e0dcda4ec0">BMLTPlugin\get_admin_ajax_base_uri</a></div><div class="ttdeci">get_admin_ajax_base_uri()</div><div class="ttdoc">Return an HTTP path to the AJAX callback target. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03611">bmlt-cms-satellite-plugin.php:3611</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ac232691e99baa691396dc46376d092ac"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ac232691e99baa691396dc46376d092ac">BMLTPlugin\$admin2OptionsName</a></div><div class="ttdeci">static $admin2OptionsName</div><div class="ttdoc">These options are for version 2.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00144">bmlt-cms-satellite-plugin.php:144</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a9c75c6f237da7458797afc5fdb813ae9"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a9c75c6f237da7458797afc5fdb813ae9">BMLTPlugin\cms_delete_option</a></div><div class="ttdeci">cms_delete_option($in_option_key)</div><div class="ttdoc">Deletes a stored option (allows CMS abstraction). *.</div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_aa388869ead7009a0a1dcc9695ebaf5c7"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#aa388869ead7009a0a1dcc9695ebaf5c7">BMLTPlugin\setAdmin2Options</a></div><div class="ttdeci">setAdmin2Options($in_options)</div><div class="ttdoc">This updates the database with the given options (Admin2 options). * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00687">bmlt-cms-satellite-plugin.php:687</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_aeea1af5c85fa2cadd17c6eda69c1bd97"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#aeea1af5c85fa2cadd17c6eda69c1bd97">BMLTPlugin\display_bmlt_nouveau</a></div><div class="ttdeci">display_bmlt_nouveau($in_content)</div><div class="ttdoc">This function implements the new, Maps API V. 3 version of the &quot;classic&quot; * BMLT search screen....</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l01879">bmlt-cms-satellite-plugin.php:1879</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a4005e57d7b24559e6731ed4108cfff46"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a4005e57d7b24559e6731ed4108cfff46">BMLTPlugin\get_plugin_path</a></div><div class="ttdeci">get_plugin_path()</div><div class="ttdoc">Return an HTTP path to the plugin directory. * NOTE: A good start has been given, but there's a very ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03635">bmlt-cms-satellite-plugin.php:3635</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a2f519fa245aba35e1ed924f788635241"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a2f519fa245aba35e1ed924f788635241">BMLTPlugin\get_num_options</a></div><div class="ttdeci">get_num_options()</div><div class="ttdoc">Gets the number of active options. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00704">bmlt-cms-satellite-plugin.php:704</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a5e19c2b04b24b4aca8024c610a30abed"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a5e19c2b04b24b4aca8024c610a30abed">BMLTPlugin\BMLTPlugin_map_search_location_options</a></div><div class="ttdeci">BMLTPlugin_map_search_location_options( $in_options_id, $in_uid)</div><div class="ttdoc">This returns a div of location options to be applied to the map search. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02250">bmlt-cms-satellite-plugin.php:2250</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a575662eeb5c19e4aa99ae34d5e831f44"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a575662eeb5c19e4aa99ae34d5e831f44">BMLTPlugin\get_shortcode</a></div><div class="ttdeci">static get_shortcode( $in_text_to_parse, $in_code)</div><div class="ttdoc">This will parse the given text, to see if it contains the submitted code. *The code can be contained ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00381">bmlt-cms-satellite-plugin.php:381</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a2398955b048505900af213faad244bbb"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a2398955b048505900af213faad244bbb">BMLTPlugin\load_params</a></div><div class="ttdeci">load_params()</div><div class="ttdoc">Loads the parameter list. *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00233">bmlt-cms-satellite-plugin.php:233</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a8cc64446449a52bb9fc8ff777d0bb501"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a8cc64446449a52bb9fc8ff777d0bb501">BMLTPlugin\process_admin_page</a></div><div class="ttdeci">process_admin_page(&amp;$out_option_number)</div><div class="ttdoc">This does any admin actions necessary. *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00840">bmlt-cms-satellite-plugin.php:840</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html">BMLTPlugin</a></div><div class="ttdoc">This is the class that implements and encapsulates the plugin functionality. * A single instance of t...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00125">bmlt-cms-satellite-plugin.php:125</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a6e6c06884c351fed8cea66c716606141"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a6e6c06884c351fed8cea66c716606141">BMLTPlugin\display_options_sheet</a></div><div class="ttdeci">display_options_sheet( $in_options_index=1, $display_mode='none')</div><div class="ttdoc">This will return the HTML for one sheet of options in the admin page. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l01030">bmlt-cms-satellite-plugin.php:1030</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ae44e562448d334639fc7fa21c8da20f5"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ae44e562448d334639fc7fa21c8da20f5">BMLTPlugin\$local_options_failure_time</a></div><div class="ttdeci">static $local_options_failure_time</div><div class="ttdoc">The number of milliseconds a failure message is displayed.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00173">bmlt-cms-satellite-plugin.php:173</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ae994760bd6b6d4cf6ada2ccf06637211"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ae994760bd6b6d4cf6ada2ccf06637211">BMLTPlugin\BMLTPlugin_fast_mobile_lookup</a></div><div class="ttdeci">BMLTPlugin_fast_mobile_lookup()</div><div class="ttdoc">Runs the lookup. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03072">bmlt-cms-satellite-plugin.php:3072</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ad529626098d05a5d47ec2bcc9bda7249"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ad529626098d05a5d47ec2bcc9bda7249">BMLTPlugin\delete_options</a></div><div class="ttdeci">delete_options($in_option_number)</div><div class="ttdoc">Deletes the indexed options. *This is a bit of a delicate operation, because we need to re-index all ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00780">bmlt-cms-satellite-plugin.php:780</a></div></div>
<div class="ttc" id="abmlt-cms-satellite-plugin_8php_html_a603d46cd049e09c6ded7caf5eb948055"><div class="ttname"><a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a603d46cd049e09c6ded7caf5eb948055">$bmlt_localization</a></div><div class="ttdeci">foreach($dir as $fileinfo) if(!defined('_LANG_COOKIE_NAME')) global $bmlt_localization</div><div class="ttdoc">Use this to control the localization.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00070">bmlt-cms-satellite-plugin.php:70</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a9ad4ced6afcdd55144dc7e527d82293f"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a9ad4ced6afcdd55144dc7e527d82293f">BMLTPlugin\adapt_to_lang</a></div><div class="ttdeci">adapt_to_lang($in_lang=&quot;en&quot;)</div><div class="ttdoc">Adapts all the static data members to the selected language. *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00209">bmlt-cms-satellite-plugin.php:209</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a0ff61c69a2a937d902b7f2d86c92371c"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a0ff61c69a2a937d902b7f2d86c92371c">BMLTPlugin\$default_theme</a></div><div class="ttdeci">static $default_theme</div><div class="ttdoc">This is the default for the &quot;style theme&quot; for the plugin. Different settings can have different theme...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00157">bmlt-cms-satellite-plugin.php:157</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a92b7166c28594f83df9d8087445d7c18"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a92b7166c28594f83df9d8087445d7c18">BMLTPlugin\$default_rootserver</a></div><div class="ttdeci">static $default_rootserver</div><div class="ttdoc">This is the default root BMLT server URI.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00147">bmlt-cms-satellite-plugin.php:147</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a704c863c37fb16b03dcf5ef671e3ff59"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a704c863c37fb16b03dcf5ef671e3ff59">BMLTPlugin\$default_location_checked</a></div><div class="ttdeci">static $default_location_checked</div><div class="ttdoc">If nonzero, then the &quot;This is a location&quot; checkbox will be preselected.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00152">bmlt-cms-satellite-plugin.php:152</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ac237b680337d5b551c03b83ec771adb9"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ac237b680337d5b551c03b83ec771adb9">BMLTPlugin\make_new_options</a></div><div class="ttdeci">make_new_options()</div><div class="ttdoc">Makes a new set of options, set as default. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00726">bmlt-cms-satellite-plugin.php:726</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a66422106cb955d5699c87454c7ed63dc"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a66422106cb955d5699c87454c7ed63dc">BMLTPlugin\$my_current_language</a></div><div class="ttdeci">$my_current_language</div><div class="ttdoc">This contains whatever the current localization object is.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00183">bmlt-cms-satellite-plugin.php:183</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ab86b4e0a45f366c9f847ab6e23ea94fa"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ab86b4e0a45f366c9f847ab6e23ea94fa">BMLTPlugin\BMLTPlugin_render_card</a></div><div class="ttdeci">BMLTPlugin_render_card( $ret, $index, $count, $meeting)</div><div class="ttdoc">Renders one WML card * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02966">bmlt-cms-satellite-plugin.php:2966</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ade39eb0c967443f9f02c911b5ce41435"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ade39eb0c967443f9f02c911b5ce41435">BMLTPlugin\get_my_driver</a></div><div class="ttdeci">&amp; get_my_driver()</div><div class="ttdoc">Accessor: This gets the driver object. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00223">bmlt-cms-satellite-plugin.php:223</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ae57b5388611ba8720d0e096ec9acd5c3"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ae57b5388611ba8720d0e096ec9acd5c3">BMLTPlugin\$default_language_string</a></div><div class="ttdeci">static $default_language_string</div><div class="ttdoc">The default language is English, and the name is spelled out, here.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00159">bmlt-cms-satellite-plugin.php:159</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a698d69a99db18b03a83240d11ce52826"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a698d69a99db18b03a83240d11ce52826">BMLTPlugin\stripFile</a></div><div class="ttdeci">static stripFile( $in_filename, $in_theme_dirname=null)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00297">bmlt-cms-satellite-plugin.php:297</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a0376a866aebbdd84d5e0901cf883ae1b"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a0376a866aebbdd84d5e0901cf883ae1b">BMLTPlugin\get_plugin_object</a></div><div class="ttdeci">static get_plugin_object()</div><div class="ttdoc">Get the instance * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00195">bmlt-cms-satellite-plugin.php:195</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a7c4afb53d27429c6ff4675a810d910da"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a7c4afb53d27429c6ff4675a810d910da">BMLTPlugin\BMLTPlugin_fast_mobile_lookup_javascript_stuff</a></div><div class="ttdeci">BMLTPlugin_fast_mobile_lookup_javascript_stuff()</div><div class="ttdoc">Output the necessary Javascript. This is only called for a &quot;pure javascript&quot; * do_search invocation (...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02702">bmlt-cms-satellite-plugin.php:2702</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a10900bb92ef1b14d0c40e43a5b075f56"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a10900bb92ef1b14d0c40e43a5b075f56">BMLTPlugin\$adminOptionsName</a></div><div class="ttdeci">static $adminOptionsName</div><div class="ttdoc">The name, in the database, for the version 1 options for this plugin.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00143">bmlt-cms-satellite-plugin.php:143</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ae8650a90f37d8edc5dd7c82aed927af8"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ae8650a90f37d8edc5dd7c82aed927af8">BMLTPlugin\return_admin_page</a></div><div class="ttdeci">return_admin_page()</div><div class="ttdoc">Returns the HTML for the admin page. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00896">bmlt-cms-satellite-plugin.php:896</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ac11c829c766953c04c1422d8d050e6e1"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ac11c829c766953c04c1422d8d050e6e1">BMLTPlugin\getBMLTOptions</a></div><div class="ttdeci">getBMLTOptions($in_option_number=null)</div><div class="ttdoc">This gets the admin options from the database. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00490">bmlt-cms-satellite-plugin.php:490</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a367bf4c7007298f8ac943c4ad2c1a380"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a367bf4c7007298f8ac943c4ad2c1a380">BMLTPlugin\$default_map_center_longitude</a></div><div class="ttdeci">static $default_map_center_longitude</div><div class="ttdoc">This is the default basic search map center longitude.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00149">bmlt-cms-satellite-plugin.php:149</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ab03a43680a74b12199b2e02ed4a4b373"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ab03a43680a74b12199b2e02ed4a4b373">BMLTPlugin\$my_table_next_id</a></div><div class="ttdeci">$my_table_next_id</div><div class="ttdoc">The next ID to use for the table.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00182">bmlt-cms-satellite-plugin.php:182</a></div></div>
<div class="ttc" id="abmlt-cms-satellite-plugin_8php_html_a4f3b79fa543abc31ad742043cde753cc"><div class="ttname"><a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php.html#a4f3b79fa543abc31ad742043cde753cc">array2json</a></div><div class="ttdeci">array2json( $arr)</div><div class="ttdoc">This is an open-source JSON encoder that allows us to support older versions of PHP (before the json_...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03698">bmlt-cms-satellite-plugin.php:3698</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a6b8584e1f426f88ac0a3a5eb56093c66"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a6b8584e1f426f88ac0a3a5eb56093c66">BMLTPlugin\display_new_map_search</a></div><div class="ttdeci">display_new_map_search($in_content)</div><div class="ttdoc">This is a function that filters the content, and replaces a portion with the * &quot;new map&quot; search * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02203">bmlt-cms-satellite-plugin.php:2203</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_acd15a5856ff8bc70cdd02b2aa2765f4e"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#acd15a5856ff8bc70cdd02b2aa2765f4e">BMLTPlugin\$default_distance_units</a></div><div class="ttdeci">static $default_distance_units</div><div class="ttdoc">The default distance units are miles.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00160">bmlt-cms-satellite-plugin.php:160</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_af960dde870b3ff53e61d8e73c24deece"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#af960dde870b3ff53e61d8e73c24deece">BMLTPlugin\replace_shortcode</a></div><div class="ttdeci">static replace_shortcode( $in_text_to_parse, $in_code, $in_replacement_text)</div><div class="ttdoc">This will parse the given text, to see if it contains the submitted code. *The code can be contained ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00411">bmlt-cms-satellite-plugin.php:411</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a2ec9128b33a7be56796daf9626f730b1"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a2ec9128b33a7be56796daf9626f730b1">BMLTPlugin\get_ajax_base_uri</a></div><div class="ttdeci">get_ajax_base_uri()</div><div class="ttdoc">Return an HTTP path to the AJAX callback target. * NOTE: A good start has been given,...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03542">bmlt-cms-satellite-plugin.php:3542</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ae4161b2d54a4ce0ba836994425328266"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ae4161b2d54a4ce0ba836994425328266">BMLTPlugin\geDefaultBMLTOptions</a></div><div class="ttdeci">geDefaultBMLTOptions()</div><div class="ttdoc">This gets the default admin options from the object (not the DB). * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00452">bmlt-cms-satellite-plugin.php:452</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a173e10c0a79092e02cdc69d0f0459f38"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a173e10c0a79092e02cdc69d0f0459f38">BMLTPlugin\getAdmin2Options</a></div><div class="ttdeci">getAdmin2Options()</div><div class="ttdoc">This gets the admin 2 options from the database. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00663">bmlt-cms-satellite-plugin.php:663</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ad7b3cc1fba4480fcd2b6b9aa046d72d4"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ad7b3cc1fba4480fcd2b6b9aa046d72d4">BMLTPlugin\$local_options_success_time</a></div><div class="ttdeci">static $local_options_success_time</div><div class="ttdoc">The number of milliseconds a success message is displayed.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00172">bmlt-cms-satellite-plugin.php:172</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a51dfcf21fde4ae106badcf9e07dbc4d5"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a51dfcf21fde4ae106badcf9e07dbc4d5">BMLTPlugin\$default_initial_view</a></div><div class="ttdeci">static $default_initial_view</div><div class="ttdoc">The initial view for old-style BMLT. It can be 'map', 'text', 'advanced', 'advanced map',...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00156">bmlt-cms-satellite-plugin.php:156</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a495f5e900da9c24471eaac9ae9e073d0"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a495f5e900da9c24471eaac9ae9e073d0">BMLTPlugin\$default_gkey</a></div><div class="ttdeci">static $default_gkey</div><div class="ttdoc">This is only necessary for older versions.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00154">bmlt-cms-satellite-plugin.php:154</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a8de1f3b7c89fbff82df72d9d056b3089"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a8de1f3b7c89fbff82df72d9d056b3089">BMLTPlugin\$g_s_there_can_only_be_one</a></div><div class="ttdeci">static $g_s_there_can_only_be_one</div><div class="ttdoc">This is a SINGLETON pattern. There can only be one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00133">bmlt-cms-satellite-plugin.php:133</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a812e94daeb7fb59635668fd8e1219ff2"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a812e94daeb7fb59635668fd8e1219ff2">BMLTPlugin\cms_get_option</a></div><div class="ttdeci">cms_get_option($in_option_key)</div><div class="ttdoc">This gets the admin options from the database (allows CMS abstraction). * *.</div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a6b8e0e4b83ca64047b912500fcd76727"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a6b8e0e4b83ca64047b912500fcd76727">BMLTPlugin\$default_additional_css</a></div><div class="ttdeci">static $default_additional_css</div><div class="ttdoc">This is additional CSS that is inserted inline into the &lt;head&gt; section.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00155">bmlt-cms-satellite-plugin.php:155</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a34254745fa910e8b8fbff0a2059e8108"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a34254745fa910e8b8fbff0a2059e8108">BMLTPlugin\setBMLTOptions</a></div><div class="ttdeci">setBMLTOptions( $in_options, $in_option_number=1)</div><div class="ttdoc">This updates the database with the given options. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00604">bmlt-cms-satellite-plugin.php:604</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a82bcc59f466ed90f8c5de413018d114c"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a82bcc59f466ed90f8c5de413018d114c">BMLTPlugin\$default_duration</a></div><div class="ttdeci">static $default_duration</div><div class="ttdoc">The default duration of meetings.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00165">bmlt-cms-satellite-plugin.php:165</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_af66d0e99ae2f2dc3a23859f7d3d86e98"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#af66d0e99ae2f2dc3a23859f7d3d86e98">BMLTPlugin\$default_map_center_latitude</a></div><div class="ttdeci">static $default_map_center_latitude</div><div class="ttdoc">This is the default basic search map center latitude.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00148">bmlt-cms-satellite-plugin.php:148</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a0b9dcf50920c5faf3f4570ff3f8f8612"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a0b9dcf50920c5faf3f4570ff3f8f8612">BMLTPlugin\BMLTPlugin_map_search_local_javascript_stuff</a></div><div class="ttdeci">BMLTPlugin_map_search_local_javascript_stuff( $in_options_id, $in_uid)</div><div class="ttdoc">This returns the JavaScript stuff that needs to be loaded into each of the * new map search instances...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02451">bmlt-cms-satellite-plugin.php:2451</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a0594123d2924125ecf24e8b49ce91852"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a0594123d2924125ecf24e8b49ce91852">BMLTPlugin\$default_details_map_zoom</a></div><div class="ttdeci">static $default_details_map_zoom</div><div class="ttdoc">This is the default basic search map zoom level.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00151">bmlt-cms-satellite-plugin.php:151</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ab13712314eec9bd961712f438a82f9d7"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ab13712314eec9bd961712f438a82f9d7">BMLTPlugin\$default_geo_width</a></div><div class="ttdeci">static $default_geo_width</div><div class="ttdoc">The default geo width for searches.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00166">bmlt-cms-satellite-plugin.php:166</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_af5b28d05c383c066153fadc62067bc74"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#af5b28d05c383c066153fadc62067bc74">BMLTPlugin\$default_grace_period</a></div><div class="ttdeci">static $default_grace_period</div><div class="ttdoc">The default grace period for the mobile search (in minutes).</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00161">bmlt-cms-satellite-plugin.php:161</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a59226d4a32381033c24a4ac15da9f03e"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a59226d4a32381033c24a4ac15da9f03e">BMLTPlugin\$default_startWeekday</a></div><div class="ttdeci">static $default_startWeekday</div><div class="ttdoc">The default starting weekday (Sunday)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00164">bmlt-cms-satellite-plugin.php:164</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a5023e053ca1ef2b5016e50f07c0fed86"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a5023e053ca1ef2b5016e50f07c0fed86">BMLTPlugin\$default_map_zoom</a></div><div class="ttdeci">static $default_map_zoom</div><div class="ttdoc">This is the default basic search map zoom level.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00150">bmlt-cms-satellite-plugin.php:150</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ab4db9c2bb0aff632596417f80ccb7913"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ab4db9c2bb0aff632596417f80ccb7913">BMLTPlugin\get_ajax_mobile_base_uri</a></div><div class="ttdeci">get_ajax_mobile_base_uri()</div><div class="ttdoc">Return an HTTP path to the AJAX callback target for the mobile handler. * *.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l03600">bmlt-cms-satellite-plugin.php:3600</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a7b8aaef06ef3c920173f0a1f6c6d6325"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a7b8aaef06ef3c920173f0a1f6c6d6325">BMLTPlugin\cms_set_option</a></div><div class="ttdeci">cms_set_option( $in_option_key, $in_option_value)</div><div class="ttdoc">This gets the admin options from the database (allows CMS abstraction). *.</div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_a2efe0a0b9e11b85b1b974366b5e4cc79"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#a2efe0a0b9e11b85b1b974366b5e4cc79">BMLTPlugin\BMLTPlugin_nouveau_map_search_global_javascript_stuff</a></div><div class="ttdeci">BMLTPlugin_nouveau_map_search_global_javascript_stuff($in_options_id)</div><div class="ttdoc">This returns the global JavaScript stuff for the new map search that only * only needs to be loaded o...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l02422">bmlt-cms-satellite-plugin.php:2422</a></div></div>
<div class="ttc" id="aclass_b_m_l_t_plugin_html_ae72e9ecced51ac64784d19f38e41e165"><div class="ttname"><a href="../../d5/dc1/class_b_m_l_t_plugin.html#ae72e9ecced51ac64784d19f38e41e165">BMLTPlugin\$my_driver</a></div><div class="ttdeci">$my_driver</div><div class="ttdoc">This will contain an instance of the BMLT satellite driver class.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5a/bmlt-cms-satellite-plugin_8php_source.html#l00179">bmlt-cms-satellite-plugin.php:179</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
